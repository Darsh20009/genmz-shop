==> Cloning from https://github.com/Darsh20009/genmz-shop
==> Checking out commit c8be7c8bf2861cac3cae37945038b2e6a4eb2328 in branch main
==> Using Node.js version 22.16.0 (default)
==> Docs on specifying a Node.js version: https://render.com/docs/node-version
==> Running build command 'npm install; npm run build'...
added 475 packages, and audited 476 packages in 6s
68 packages are looking for funding
  run `npm fund` for details
found 0 vulnerabilities
> rest-express@1.0.0 build
> tsx script/build.ts
building client...
vite v7.3.0 building client environment for production...
transforming...
âœ“ 2112 modules transformed.
rendering chunks...
computing gzip size...
../dist/public/index.html                                                        2.01 kB â”‚ gzip:   0.77 kB
../dist/public/assets/Gen_M_Z_LOGO_1766644527859-B3_1eWd-.png                  170.82 kB
../dist/public/assets/Screenshot_2025-12-25_100724_1766646961782-CQ8lNQfc.png  339.24 kB
../dist/public/assets/Screenshot_2025-12-25_100613_1766646961781-CrtaqZo4.png  377.07 kB
../dist/public/assets/Screenshot_2025-12-25_100641_1766646961781-3rwUMiBC.png  471.85 kB
../dist/public/assets/Screenshot_2025-12-25_100738_1766646961782-e_8DiE7e.png  514.97 kB
../dist/public/assets/Screenshot_2025-12-25_100700_1766646961782-wbdpFn5T.png  547.61 kB
../dist/public/assets/index-D6awpc29.css                                        94.54 kB â”‚ gzip:  14.55 kB
../dist/public/assets/index-CYZIJzg0.js                                        624.82 kB â”‚ gzip: 192.81 kB
(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
âœ“ built in 4.41s
building server...
  dist/index.cjs  2.2mb âš ï¸
âš¡ Done in 362ms
==> Uploading build...
==> Uploaded in 5.2s. Compression took 2.7s
==> Build successful ðŸŽ‰
==> Setting WEB_CONCURRENCY=1 by default, based on available CPUs in the instance
==> Deploying...
==> Running 'npm run start'
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/opt/render/project/src/dist/index.cjs:97
updatePath: '${n.raw.path}'`);n.trace.add(t);let i=Object.keys(t||{}),s=i.length;r=r||{},e=e?e+".":"";for(let o=0;o<s;++o){let a=i[o],u=t[a],c=e+a;r[c]=!0,!Buffer.isBuffer(u)&&eH(u)&&(u=u.toObject({transform:!1,virtuals:!1})),nH(u)&&rH(u,e+a,r,n)}return n.trace.delete(t),r}function nH(t){return t&&typeof t=="object"&&!(t instanceof Date)&&!XW(t,"ObjectId")&&(!Array.isArray(t)||t.length!==0)&&!(t instanceof Buffer)&&!XW(t,"Decimal128")&&!(t instanceof PSe)}});var Xt=y((Qqe,iH)=>{"use strict";iH.exports=function(e,r,n){let i,s=!1;if(typeof r=="string"){if(r.indexOf(".")===-1){let u=YO(e,r);return u??n}i=r.split(".")}else if(s=!0,i=r,i.length===1){let u=YO(e,i[0]);return u??n}let o=r,a=e;for(let u of i){if(a==null)return n;if(!s&&a[o]!=null)return a[o];a=YO(a,u),s||(o=o.substr(u.length+1))}return a??n};function YO(t,e){return t==null?t:t instanceof Map?t.get(e):t[e]}});var JO=y((Zqe,oH)=>{"use strict";var sH=Zr();oH.exports=function(e,r){return typeof e=="string"&&typeof r=="string"||typeof e=="number"&&typeof r=="number"?e===r:sH(e,"ObjectId")&&sH(r,"ObjectId")?e.toString()===r.toString():!1}});var iE=y((Xqe,aH)=>{"use strict";var FSe=JO();aH.exports=function(e,r){if(e==null||e.discriminators==null)return null;for(let n of Object.keys(e.discriminators)){let i=e.discriminators[n];if(i.discriminatorMapping!=null&&FSe(i.discriminatorMapping.value,r))return i}return null}});var cH=y((eje,uH)=>{"use strict";var ISe=Xt(),NSe=iE();uH.exports=function t(e,r,n){n=n||{};let i=n.typeOnly,s=Array.isArray(r)?r:r.indexOf(".")===-1?[r]:r.split("."),o=null,a="adhocOrUndefined",u=NSe(e.schema,e.get(e.schema.options.discriminatorKey))||e.schema;for(let c=0;c<s.length;++c){let l=s.slice(0,c+1).join(".");if(o=u.path(l),o==null){a="adhocOrUndefined";continue}if(o.instance==="Mixed")return i?"real":o;if(a=u.pathType(l),(o.$isSingleNested||o.$isMongooseDocumentArrayElement)&&o.schema.discriminators!=null){let p=o.schema.discriminators,f=e.get(l+"."+ISe(o,"schema.options.discriminatorKey"));if(f==null||p[f]==null)continue;let d=s.slice(c+1).join(".");return t(e.get(l),d,n)}}return i?a:o}});var pH=y((tje,lH)=>{"use strict";var RSe=Xt();lH.exports=function(e,r,n){let i=n!=null?Object.keys(RSe(e.tree,n,{})):Object.keys(e.tree),s=new Set(Object.keys(r)),o;if(s.size>1){o=new Set;for(let a of i)s.has(a)&&o.add(a);for(let a of s)o.has(a)||o.add(a);o=Array.from(o)}else o=Array.from(s);return o}});var dH=y((rje,fH)=>{"use strict";fH.exports=function(e,r){if(r.length===1)return;let n=r[0],i;for(let s=0;s<r.length-1;++s){let o=e.path(n);o&&o.schema?(i=o.schema.options.strict,e=o.schema,n=o.$isMongooseDocumentArray&&!isNaN(r[s+1])?"":r[s+1]):n+=n.length?"."+r[s+1]:r[s+1]}return i}});var sE=y((nje,hH)=>{"use strict";var $Se=ge(),qSe=new Set(["__index","__parentArray","_doc"]);hH.exports=function(e,r){if($Se.isPOJO(e)&&e.$__!=null&&e._doc!=null){if(r){let n={};for(let i of Object.keys(e))typeof i!="symbol"&&i[0]!=="$"&&(qSe.has(i)||(n[i]=e[i]));return{...e._doc,...n}}return e._doc}return e}});var vf=y((ije,mH)=>{"use strict";mH.exports=function(e){return e==null?!0:typeof e=="object"?!("$meta"in e)&&!("$slice"in e):!0}});var wf=y((sje,yH)=>{"use strict";var jSe=vf(),LSe=hf();yH.exports=function t(e){if(e==null)return null;let r=Object.keys(e),n=null;if(r.length===1&&r[0]==="_id")n=!e._id;else for(let i=0;i<r.length;++i){let s=r[i];if(s!=="_id"&&jSe(e[s])&&(n=LSe(e[s])?t(e[s])??n:!e[s],n!=null))break}return n}});var QO=y((oje,gH)=>{"use strict";var USe=vf();gH.exports=function(e,r){if(e==null)return!1;if(r==="_id")return e._id===0;let n=Object.keys(e),i=null;for(let s of n)if(USe(e[s])){i=e[r]===1?"inclusive":"exclusive";break}return i==="inclusive"?e[r]!==1:i==="exclusive"?e[r]===0:!1}});var ZO=y((aje,bH)=>{"use strict";var zSe=ge();bH.exports=function(e,r){if(e._doc._id==null||r==null||r.length===0)return;let n=String(e._doc._id);for(let i of r){if(i.isVirtual)continue;let o=i.path.split(".");for(let a=0;a<o.length-1;++a){let u=o.slice(0,a+1).join("."),c=o.slice(a+1).join("."),l=e.get(u);if(l!=null&&zSe.isMongooseDocumentArray(l)){for(let p=0;p<l.length;++p)l[p]&&l[p].populated(c,i._docs[n]==null?void 0:i._docs[n][p],i);break}}}}});var XO=y((uje,_H)=>{"use strict";var{isPOJO:VSe}=ge();_H.exports=EH;function EH(t){let e=Object.keys(t),r=e.length,n,i,s;for(;r--;){if(i=e[r],s=t[i],VSe(s)&&(t[i]=EH(s)),t[i]===void 0){delete t[i];continue}n=!0}return n?t:void 0}});var ex=y((cje,vH)=>{"use strict";var WSe=/\./g;vH.exports=function(e){if(e.indexOf(".")===-1)return[e];let r=e.split(WSe),n=r.length,i=new Array(n),s="";for(let o=0;o<n;++o)s+=s.length!==0?"."+r[o]:r[o],i[o]=s;return i}});var AH=y((lje,wH)=>{"use strict";wH.exports=function(e,r,n,i,s){let o=Object.keys(e).reduce((u,c)=>u||c.startsWith(r+"."),!1),a=r+"."+n.options.discriminatorKey;!o&&s.length===1&&s[0]===a&&i.splice(i.indexOf(a),1)}});var ts=y((pje,SH)=>{"use strict";var HSe=JO();SH.exports=function(e,r){if(e==null)return null;for(let n of Object.keys(e)){let i=e[n];if(i.schema&&i.schema.discriminatorMapping&&HSe(i.schema.discriminatorMapping.value,r))return i}return null}});var oE=y((fje,OH)=>{"use strict";OH.exports=function(e,r){let n=r.split("."),i="",s,o,a;for(let u=0;u<n.length;++u)if(i+=i.length?".":""+n[u],e[i]){for(o=Object.keys(e),a=o.length,s=0;s<a;++s)o[u].indexOf(i+".")===0&&o[u].indexOf(r);return!0}return!1}});var Ih=y(Pc=>{"use strict";var xH=UO(),GSe=AH(),CH=Xt(),KSe=ts(),YSe=vf(),JSe=zt(),QSe=oE();Pc.preparePopulationOptionsMQ=function(e,r){let n=e._mongooseOptions.populate,i=Object.keys(n).reduce((a,u)=>a.concat([n[u]]),[]);r.lean!=null&&i.filter(a=>(a&&a.options&&a.options.lean)==null).forEach(ZSe(r.lean));let s=e&&e.options&&e.options.session||null;s!=null&&i.forEach(a=>{if(a.options==null){a.options={session:s};return}"session"in a.options||(a.options.session=s)});let o=e._fieldsForExec();for(let a=0;a<i.length;++a)i[a]instanceof xH?i[a]=new xH({...i[a],_queryProjection:o,_localModel:e.model}):(i[a]._queryProjection=o,i[a]._localModel=e.model);return i};Pc.createModel=function(e,r,n,i,s){e.hooks.execPreSync("createModel",r);let o=e.schema?e.schema.discriminatorMapping:null,a=o&&o.isRoot?o.key:null,u=r[a];if(a&&u&&e.discriminators){let l=e.discriminators[u]||KSe(e.discriminators,u);if(l){let p=JSe(i);return Pc.applyPaths(p,l.schema),new l(void 0,p,{skipId:!0})}}let c={skipId:!0,isNew:!1,willInit:!0};return s!=null&&"defaults"in s&&(c.defaults=s.defaults),new e(void 0,n,c)};Pc.createModelAndInit=function(e,r,n,i,s,o,a){let u=o?{populated:o}:void 0,c=Pc.createModel(e,r,n,i,s);try{c.$init(r,u,a)}catch(l){a(l,c)}};Pc.applyPaths=function(e,r,n){let i,s,o=new Set;if(e){s=Object.keys(e);let f=[];for(let d=0;d<s.length;++d){let h=s[d];s[d][0]==="-"&&(delete e[h],h==="-_id"?e._id=0:f.push(h.slice(1)))}s=Object.keys(e);for(let d=0;d<s.length;++d){if(s[d][0]==="+")continue;let h=e[s[d]];if(YSe(h)&&!(s[d]==="_id"&&s.length>1)&&!(s[d]===r.options.discriminatorKey&&s.length>1&&h!=null&&!h)){i=!h;break}}for(let d of f){let h=r.path(d);!h||!h.selected||i!==!1?(e[d]=0,i=!0):h&&h.selected&&i===!1&&o.add(d)}}let a=[],u=[],c=[];switch(l(r),i){case!0:for(let f of u)e[f]=0;break;case!1:r&&r.paths._id&&r.paths._id.options&&r.paths._id.options.select===!1&&(e._id=0);for(let f of a)o.has(f)||QSe(e,f)||(e[f]=e[f]||1);break;case void 0:if(e==null)break;for(let f of Object.keys(e||{}))f.startsWith("+")&&delete e[f];for(let f of u)e[f]==null&&(e[f]=0);break}function l(f,d){if(d||(d=""),c.indexOf(f)!==-1)return[];c.push(f);let h=[];return f.eachPath(function(m,g){if(d&&(m=d+"."+m),g.$isSchemaMap||m.endsWith(".$*")){let _="+"+m,w=e&&_ in e;g.options&&g.options.select===!1&&!w&&u.push(m);return}let b=p(m,g);if(b==null&&!Array.isArray(g)&&g.$isMongooseArray&&!g.$isMongooseDocumentArray&&(b=p(m,g.embeddedSchemaType)),b!=null&&h.push(b),g.schema){let _=l(g.schema,m);i===!1&&GSe(e,m,g.schema,a,_)}}),c.pop(),h}function p(f,d){if(e==null||typeof d.selected!="boolean")return;if(d.selected===!1&&e[f]){n&&(e[f]=0);return}if(!i&&d.selected&&f===r.options.discriminatorKey&&e[f]!=null&&!e[f]){delete e[f];return}if(i===!1&&d.selected&&e[f]!=null&&!e[f]){delete e[f];return}let h="+"+f;if(e&&h in e){delete e[h],i===!1&&s.length>1&&!~s.indexOf(f)&&!n?e[f]=1:i==null&&n&&d.selected===!1&&(e[f]=0);return}let g=f.split("."),b="";for(let _=0;_<g.length;++_)if(b+=b.length?"."+g[_]:g[_],u.indexOf(b)!==-1)return;if(!i&&(d&&d.options&&d.options.$skipDiscriminatorCheck)){let _="";for(let w=0;w<g.length;++w){_+=(_.length===0?"":".")+g[w];let E=CH(e,_,!1)||CH(e,_+".$",!1);if(E&&typeof E!="object")return}}return(d.selected?a:u).push(f),f}};function ZSe(t){return function(e){e.options||(e.options={}),t!=null&&Array.isArray(t.virtuals)&&(t=Object.assign({},t),t.virtuals=t.virtuals.filter(r=>typeof r=="string"&&r.startsWith(e.path+".")).map(r=>r.slice(e.path.length+1))),e.options.lean=t}}});var tx=y((hje,TH)=>{"use strict";function XSe(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}TH.exports=XSe});var MH=y((mje,DH)=>{"use strict";DH.exports=function(e,r,n){let i=r[0],s=n,o=e;for(let a=0;a<r.length-1;++a){let u=s.path(i);if(u&&u.schema){let c=o.get(i);if(s=u.schema,i=r[a+1],Array.isArray(c)&&!isNaN(i)&&(c=c[i],i=""),c==null)break;o=c}else i+=i.length?"."+r[a+1]:r[a+1]}return o}});var aE=y((yje,BH)=>{"use strict";var Go=po(),e9e=Fs().internalToObjectOptions,PH=require("util"),t9e=ge();BH.exports=_t;function _t(t,e,r,n){if(r!=null){let s={isNew:r.isNew};"defaults"in r.$__&&(s.defaults=r.$__.defaults),n=Object.assign(s,n)}n!=null&&n.path!=null&&(this.$basePath=n.path),n!=null&&n.pathRelativeToParent!=null&&(this.$pathRelativeToParent=n.pathRelativeToParent);let i=n;n!=null&&n.path!=null&&(i=Object.assign({},n),delete i.path),Go.call(this,t,e,i),delete this.$__.priorDoc}_t.prototype=Object.create(Go.prototype);Object.defineProperty(_t.prototype,"$isSubdocument",{configurable:!1,writable:!1,value:!0});Object.defineProperty(_t.prototype,"$isSingleNested",{configurable:!1,writable:!1,value:!0});_t.prototype.toBSON=function(){return this.toObject(e9e)};_t.prototype.save=async function(e){return e=e||{},e.suppressWarning||t9e.warn("mongoose: calling `save()` on a subdoc does **not** save the document to MongoDB, it only runs save middleware. Use `subdoc.save({ suppressWarning: true })` to hide this warning if you're sure this behavior is right for your app."),await this.$__save()};_t.prototype.$__fullPath=function(t){return this.$__.fullPath||this.ownerDocument(),t?this.$__.fullPath+"."+t:this.$__.fullPath};_t.prototype.$__pathRelativeToParent=function(t){return this.$pathRelativeToParent!=null?t==null?this.$pathRelativeToParent:this.$pathRelativeToParent+"."+t:t==null?this.$basePath:this.$basePath?[this.$basePath,t].join("."):t};_t.prototype.$__save=async function(){try{await this._execDocumentPreHooks("save")}catch(e){await this._execDocumentPostHooks("save",e);return}await this._execDocumentPostHooks("save")};_t.prototype.$isValid=function(t){let e=this.$parent(),r=this.$__pathRelativeToParent(t);return e!=null&&r!=null?e.$isValid(r):Go.prototype.$isValid.call(this,t)};_t.prototype.markModified=function(t){Go.prototype.markModified.call(this,t);let e=this.$parent();if(e==null)return;let r=this.$__pathRelativeToParent(t);if(r==null)return;let n=this.$__pathRelativeToParent().replace(/\.$/,"");e.isDirectModified(n)||this.isNew||this.$__parent.markModified(r,this)};_t.prototype.isModified=function(t,e,r){let n=this.$parent();return n!=null?(Array.isArray(t)||typeof t=="string"?(t=Array.isArray(t)?t:t.split(" "),t=t.map(i=>this.$__pathRelativeToParent(i)).filter(i=>i!=null)):t||(t=this.$__pathRelativeToParent()),n.$isModified(t,e,r)):Go.prototype.isModified.call(this,t,e,r)};_t.prototype.$markValid=function(t){Go.prototype.$markValid.call(this,t);let e=this.$parent(),r=this.$__pathRelativeToParent(t);e!=null&&r!=null&&e.$markValid(r)};_t.prototype.invalidate=function(t,e,r){Go.prototype.invalidate.call(this,t,e,r);let n=this.$parent(),i=this.$__pathRelativeToParent(t);if(n!=null&&i!=null)n.invalidate(i,e,r);else if(e.kind==="cast"||e.name==="CastError"||i==null)throw e;return this.ownerDocument().$__.validationError};_t.prototype.$ignore=function(t){Go.prototype.$ignore.call(this,t);let e=this.$parent(),r=this.$__pathRelativeToParent(t);e!=null&&r!=null&&e.$ignore(r)};_t.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;let t=this,e=[],r=new Set([t]);for(;typeof t.$__pathRelativeToParent=="function";){e.unshift(t.$__pathRelativeToParent(void 0,!0));let n=t.$parent();if(n==null)break;if(t=n,r.has(t))throw new Error("Infinite subdocument loop: subdoc with _id "+t._id+" is a parent of itself");r.add(t)}return this.$__.fullPath=e.join("."),this.$__.ownerDocument=t,this.$__.ownerDocument};_t.prototype.$__fullPathWithIndexes=function(){let t=this,e=[],r=new Set([t]);for(;typeof t.$__pathRelativeToParent=="function";){e.unshift(t.$__pathRelativeToParent(void 0,!1));let n=t.$parent();if(n==null)break;if(t=n,r.has(t))throw new Error("Infinite subdocument loop: subdoc with _id "+t._id+" is a parent of itself");r.add(t)}return e.join(".")};_t.prototype.parent=function(){return this.$__parent};_t.prototype.$parent=_t.prototype.parent;_t.prototype.$__removeFromParent=function(){this.$__parent.set(this.$basePath,null)};_t.prototype.deleteOne=function(e){if(r9e(this),!e||!e.noop){this.$__removeFromParent();let r=this.ownerDocument();r.$__.removedSubdocs=r.$__.removedSubdocs||[],r.$__.removedSubdocs.push(this)}};_t.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.nested.populate("path")`, use `doc.populate("nested.path")`')};_t.prototype.inspect=function(){return this.toObject()};PH.inspect.custom&&(_t.prototype[PH.inspect.custom]=_t.prototype.inspect);_t.prototype.$toObject=function(e,r){let n=Go.prototype.$toObject.call(this,e,r);if(!(Object.keys(n).length===0&&e?._calledWithOptions!=null&&(e._calledWithOptions?.minimize??this?.$__schemaTypeOptions?.minimize??e.minimize)&&!this.constructor.$__required))return n};function r9e(t){let e=t.ownerDocument();function r(){e.$removeListener("save",r),e.$removeListener("deleteOne",r),t.emit("deleteOne",t),t.constructor.emit("deleteOne",t)}e.$on("save",r),e.$on("deleteOne",r)}});var Af=y((gje,IH)=>{"use strict";var kH=require("events").EventEmitter,FH=aE(),n9e=ge(),Nh=oe().documentArrayParent;function ri(t,e,r,n,i){n9e.isMongooseDocumentArray(e)?(this.__parentArray=e,this[Nh]=e.$parent()):(this.__parentArray=void 0,this[Nh]=void 0),this.$setIndex(i),this.$__parent=this[Nh];let s;typeof r=="object"&&r!=null?(s={isNew:!0,...r},r=void 0):s={isNew:!0},FH.call(this,t,n,this[Nh],s)}ri.prototype=Object.create(FH.prototype);ri.prototype.constructor=ri;Object.defineProperty(ri.prototype,"$isSingleNested",{configurable:!1,writable:!1,value:!1});Object.defineProperty(ri.prototype,"$isDocumentArrayElement",{configurable:!1,writable:!1,value:!0});for(let t in kH.prototype)ri[t]=kH.prototype[t];ri.prototype.$setIndex=function(t){if(this.__index=t,this.$__!=null&&this.$__.validationError!=null){let e=Object.keys(this.$__.validationError.errors);for(let r of e)this.invalidate(r,this.$__.validationError.errors[r])}};ri.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.arr[0].populate("path")`, use `doc.populate("arr.0.path")`')};ri.prototype.$__removeFromParent=function(){let t=this._doc._id;if(!t)throw new Error("For your own good, Mongoose does not know how to remove an ArraySubdocument that has no _id");this.__parentArray.pull({_id:t})};ri.prototype.$__fullPath=function(t,e){return this.__index==null?null:(this.$__.fullPath||this.ownerDocument(),e?t?this.$__.fullPath+"."+t:this.$__.fullPath:t?this.$__.fullPath+"."+this.__index+"."+t:this.$__.fullPath+"."+this.__index)};ri.prototype.$__pathRelativeToParent=function(t,e){return this.__index==null||!this.__parentArray||!this.__parentArray.$path?null:e?t==null?this.__parentArray.$path():this.__parentArray.$path()+"."+t:t==null?this.__parentArray.$path()+"."+this.__index:this.__parentArray.$path()+"."+this.__index+"."+t};ri.prototype.$parent=function(){return this[Nh]};ri.prototype.parentArray=function(){return this.__parentArray};IH.exports=ri});var lE=y((bje,zH)=>{"use strict";var ix=po(),rx=Af(),i9e=Ce(),NH=eE(),s9e=zt(),RH=Fs().internalToObjectOptions,jH=Ti(),gn=ge(),nx=Zr(),Ko=oe().arrayAtomicsSymbol,au=oe().arrayParentSymbol,uu=oe().arrayPathSymbol,Yo=oe().arraySchemaSymbol,LH=oe().populateModelSymbol,o9e=Symbol("mongoose#Array#sliced"),$H=Array.prototype.push;var cE={$__getAtomics(){let t=[],e=Object.keys(this[Ko]||{}),r=e.length,n=Object.assign({},RH,{_isNested:!0});if(r===0)return t[0]=["$set",this.toObject(n)],t;for(;r--;){let i=e[r],s=this[Ko][i];gn.isMongooseObject(s)?s=s.toObject(n):Array.isArray(s)?s=this.toObject.call(s,n):s!=null&&Array.isArray(s.$each)?s.$each=this.toObject.call(s.$each,n):s!=null&&typeof s.valueOf=="function"&&(s=s.valueOf()),i==="$addToSet"&&(s={$each:s}),t.push([i,s])}return t},$atomics(){return this[Ko]},$parent(){return this[au]},$path(){return this[uu]},$schemaType(){return this[Yo]},$shift(){this._registerAtomic("$pop",-1),this._markModified();let t=this.__array;if(!t._shifted)return t._shifted=!0,[].shift.call(t)},$pop(){if(this._registerAtomic("$pop",1),this._markModified(),!this._popped)return this._popped=!0,[].pop.call(this)},$schema(){return this[Yo]},_cast(t){let e=!1,r,n=this[au];if(n&&(e=n.$populated(this[uu],!0)),e&&t!==null&&t!==void 0){if(r=e.options[LH],r==null)throw new i9e("No populated model found for path `"+this[uu]+"`. This is likely a bug in Mongoose, please report an issue on github.com/Automattic/mongoose.");return(Buffer.isBuffer(t)||nx(t,"ObjectId")||!gn.isObject(t))&&(t={_id:t}),t.schema&&t.schema.discriminatorMapping&&t.schema.discriminatorMapping.key!==void 0||(t=new r(t)),this[Yo].embeddedSchemaType.applySetters(t,n,!0)}return this[Yo].embeddedSchemaType.applySetters(t,n,!1)},_mapCast(t,e){return this._cast(t,this.length+e)},_markModified(t){let e=this[au],r;if(e){if(r=this[uu],arguments.length&&(r=r+"."+t),r!=null&&r.endsWith(".$"))return this;e.markModified(r,arguments.length!==0?t:e)}return this},_registerAtomic(t,e){if(this[o9e])return;if(t==="$set")return this[Ko]={$set:e},NH(this[au],this[uu]),this._markModified(),this;let r=this[Ko];if(t==="$pop"&&!("$pop"in r)){let i=this;this[au].once("save",function(){i._popped=i._shifted=null})}if(r.$set||Object.keys(r).length&&!(t in r))return this[Ko]={$set:this},this;let n;if(t==="$pullAll"||t==="$addToSet")r[t]||(r[t]=[]),r[t]=r[t].concat(e);else if(t==="$pullDocs"){let i=r.$pull||(r.$pull={});e[0]instanceof rx?(n=i.$or||(i.$or=[]),Array.prototype.push.apply(n,e.map(s=>s.toObject({transform:(o,a)=>(s==null||s.$__==null||Object.keys(s.$__.activePaths.getStatePaths("default")).forEach(u=>{jH.unset(u,a),UH(a,u)}),a),virtuals:!1})))):(n=i._id||(i._id={$in:[]}),n.$in=n.$in.concat(e))}else if(t==="$push")if(r.$push=r.$push||{$each:[]},e!=null&&gn.hasUserDefinedProperty(e,"$each"))r.$push=e;else if(e.length===1)r.$push.$each.push(e[0]);else if(e.length<1e4)r.$push.$each.push(...e);else for(let i of e)r.$push.$each.push(i);else r[t]=e;return this},addToSet(){uE(this,arguments),qH(this,arguments);let t=[].map.call(arguments,this._mapCast,this),e=[],r="";t[0]instanceof rx?r="doc":t[0]instanceof Date?r="date":nx(t[0],"ObjectId")&&(r="ObjectId");let n=gn.isMongooseArray(t)?t.__array:t,i=gn.isMongooseArray(this)?this.__array:this;return n.forEach(function(s){let o,a=+s;switch(r){case"doc":o=this.some(function(u){return u.equals(s)});break;case"date":o=this.some(function(u){return+u===a});break;case"ObjectId":o=this.find(u=>u.toString()===s.toString());break;default:o=~this.indexOf(s);break}o||(this._markModified(),i.push(s),this._registerAtomic("$addToSet",s),[].push.call(e,s))},this),e},hasAtomics(){return gn.isPOJO(this[Ko])?Object.keys(this[Ko]).length:0},includes(t,e){return this.indexOf(t,e)!==-1},indexOf(t,e){nx(t,"ObjectId")&&(t=t.toString()),e=e??0;let r=this.length;for(let n=e;n<r;++n)if(t==this[n])return n;return-1},inspect(){return JSON.stringify(this)},nonAtomicPush(){let t=[].map.call(arguments,this._mapCast,this);this._markModified();let e=[].push.apply(this,t);return this._registerAtomic("$set",this),e},pop(){this._markModified();let t=[].pop.call(this);return this._registerAtomic("$set",this),t},pull(){let t=[].map.call(arguments,(i,s)=>this._cast(i,s,{defaults:!1}),this),e=this;gn.isMongooseArray(e)&&(e=e.__array);let r=e.length,n;for(this._markModified();r--;)n=e[r],n instanceof ix?t.some(function(s){return n.equals(s)})&&e.splice(r,1):~this.indexOf.call(t,n)&&e.splice(r,1);return t[0]instanceof rx?this._registerAtomic("$pullDocs",t.map(function(i){let s=i.$__getValue("_id");return s===void 0||i.$isDefault("_id")?i:s})):this._registerAtomic("$pullAll",t),NH(this[au],this[uu])>0&&this._registerAtomic("$set",this),this},push(){let t=arguments,e=t,r=t[0]!=null&&gn.hasUserDefinedProperty(t[0],"$each"),n=gn.isMongooseArray(this)?this.__array:this;if(r&&(e=t[0],t=t[0].$each),this[Yo]==null)return $H.apply(this,t);uE(this,t),qH(this,t),t=[].map.call(t,this._mapCast,this);let i,s=this[Ko];return this._markModified(),r?(e.$each=t,(s.$push&&s.$push.$each&&s.$push.$each.length||0)!==0&&s.$push.$position!=e.$position?(e.$position!=null?([].splice.apply(n,[e.$position,0].concat(t)),i=n.length):i=[].push.apply(n,t),this._registerAtomic("$set",this)):e.$position!=null?([].splice.apply(n,[e.$position,0].concat(t)),i=this.length):i=[].push.apply(n,t)):(e=t,i=$H.apply(n,t)),this._registerAtomic("$push",e),i},remove(){return this.pull.apply(this,arguments)},set(t,e,r){let n=this.__array;if(r)return n[t]=e,this;let i=cE._cast.call(this,e,t);return cE._markModified.call(this,t),n[t]=i,this},shift(){let t=gn.isMongooseArray(this)?this.__array:this;this._markModified();let e=[].shift.call(t);return this._registerAtomic("$set",this),e},sort(){let t=gn.isMongooseArray(this)?this.__array:this,e=[].sort.apply(t,arguments);return this._registerAtomic("$set",this),e},splice(){let t,e=gn.isMongooseArray(this)?this.__array:this;if(this._markModified(),uE(this,Array.prototype.slice.call(arguments,2)),arguments.length){let r;if(this[Yo]==null)r=arguments;else{r=[];for(let n=0;n<arguments.length;++n)r[n]=n<2?arguments[n]:this._cast(arguments[n],arguments[0]+(n-2))}t=[].splice.apply(e,r),this._registerAtomic("$set",this)}return t},toBSON(){return this.toObject(RH)},toObject(t){let e=gn.isMongooseArray(this)?this.__array:this;return t&&t.depopulate?(t=s9e(t),t._isNested=!0,[].concat(e).map(function(r){return r instanceof ix?r.toObject(t):r})):[].concat(e)},$toObject(){return this.constructor.prototype.toObject.apply(this,arguments)},unshift(){uE(this,arguments);let t;this[Yo]==null?t=arguments:t=[].map.call(arguments,this._cast,this);let e=gn.isMongooseArray(this)?this.__array:this;return this._markModified(),[].unshift.apply(e,t),this._registerAtomic("$set",this),this.length}};function a9e(t,e){if(!e)return!1;for(let r of t){if(r==null)return!1;let n=r.constructor;if(!(r instanceof ix)||n.modelName!==e&&n.baseModelName!==e)return!1}return!0}function UH(t,e,r){if(typeof e=="string"){if(e.indexOf(".")===-1)return;e=jH.stringToParts(e)}r=r||0,!(r>=e.length)&&(t==null||typeof t!="object"||(UH(t[e[0]],e,r+1),t[e[0]]!=null&&typeof t[e[0]]=="object"&&Object.keys(t[e[0]]).length===0&&delete t[e[0]]))}function uE(t,e){let r=t==null?null:t[Yo]?.embeddedSchemaType?.options?.ref||null;t.length===0&&e.length!==0&&a9e(e,r)&&t[au].$populated(t[uu],[],{[LH]:e[0].constructor})}function qH(t,e){let r=t==null?null:t[Yo]?.embeddedSchemaType?.options?.ref||null,n=t[au],i=t[uu];if(!(!r||!n.populated(i))){for(let s of e)if(s!=null&&(typeof s!="object"||s instanceof String||s instanceof Number||s instanceof Buffer||gn.isMongooseType(s))){n.depopulate(i);break}}}var u9e=["filter","flat","flatMap","map","slice"];for(let t of u9e)Array.prototype[t]!=null&&(cE[t]=function(){let e=gn.isMongooseArray(this)?this.__array:this,r=[].concat(e);return r[t].apply(r,arguments)});zH.exports=cE});var ox=y((KH,YH)=>{"use strict";var sx=lE(),pE=oe().arrayAtomicsSymbol,c9e=oe().arrayAtomicsBackupSymbol,VH=oe().arrayParentSymbol,l9e=oe().arrayPathSymbol,WH=oe().arraySchemaSymbol,HH=Array.prototype.push,GH=/^\d+$/;function p9e(t,e,r,n){let i;if(Array.isArray(t)){let a=t.length;if(a===0)i=new Array;else if(a===1)i=new Array(1),i[0]=t[0];else if(a<1e4)i=new Array,HH.apply(i,t);else{i=new Array;for(let u=0;u<a;++u)HH.call(i,t[u])}}else i=[];let s={[pE]:{},[c9e]:void 0,[l9e]:e,[WH]:n,[VH]:void 0,isMongooseArray:!0,isMongooseArrayProxy:!0,__array:i};t&&t[pE]!=null&&(s[pE]=t[pE]),r!=null&&r.$__&&(s[VH]=r,s[WH]=n||r.schema.path(e));let o=new Proxy(i,{get:function(a,u){return Object.hasOwn(s,u)?s[u]:Object.hasOwn(sx,u)?sx[u]:n&&n.virtuals&&Object.hasOwn(n.virtuals,u)?n.virtuals[u].applyGetters(void 0,a):typeof u=="string"&&GH.test(u)&&n?.embeddedSchemaType!=null?n.embeddedSchemaType.applyGetters(i[u],r):i[u]},set:function(a,u,c){return typeof u=="string"&&GH.test(u)?sx.set.call(o,u,c,!1):Object.hasOwn(s,u)?s[u]=c:n?.virtuals&&Object.hasOwn(n.virtuals,u)?n.virtuals[u].applySetters(c,a):i[u]=c,!0}});return o}YH.exports=KH=p9e});var XH=y((Eje,ZH)=>{"use strict";var fE=lE(),f9e=po(),JH=ts(),d9e=Fs().internalToObjectOptions,Bc=ge(),h9e=Zr(),hE=oe().arrayParentSymbol,ax=oe().arrayPathSymbol,Rh=oe().arraySchemaSymbol,QH=oe().documentArrayParent,m9e=Array.prototype.toString,ux={toBSON(){return this.toObject(d9e)},toString(){return m9e.call(this.__array.map(t=>t!=null&&t.$__!=null?t.toString():t))},getArrayParent(){return this[hE]},$schemaType(){return this[Rh]},_cast(t,e,r){if(this[Rh]==null)return t;let n=this[Rh].Constructor;if((n.$isMongooseDocumentArray?Bc.isMongooseDocumentArray(t):t instanceof n)||t&&t.constructor&&t.constructor.baseCasterConstructor===n)return t[QH]&&t.__parentArray||(t[QH]=this[hE],t.__parentArray=this),t.$setIndex(e),t;if(t==null)return null;if((Buffer.isBuffer(t)||h9e(t,"ObjectId")||!Bc.isObject(t))&&(t={_id:t}),t&&n.discriminators&&n.schema&&n.schema.options&&n.schema.options.discriminatorKey)if(typeof t[n.schema.options.discriminatorKey]=="string"&&n.discriminators[t[n.schema.options.discriminatorKey]])n=n.discriminators[t[n.schema.options.discriminatorKey]];else{let o=JH(n.discriminators,t[n.schema.options.discriminatorKey]);o&&(n=o)}if(n.$isMongooseDocumentArray)return n.cast(t,this,void 0,void 0,e);let s=new n(t,this,r,void 0,e);return s.isNew=!0,s},id(t){if(t==null)return null;let e=this[Rh],r=null;e&&e.schema?r=e.schema.path("_id"):e&&e.casterConstructor&&e.casterConstructor.schema&&(r=e.casterConstructor.schema.path("_id"));let n=null;if(r)try{n=r.cast(t)}catch{}let i;for(let s of this)if(s&&(i=s.get("_id"),i!=null))if(i instanceof f9e){if(i=i.get("_id"),n!=null&&Bc.deepEqual(n,i))return s;if(n==null&&(t==i||Bc.deepEqual(t,i)))return s}else{if(n!=null&&Bc.deepEqual(n,i))return s;if(n==null&&(i==t||Bc.deepEqual(t,i)))return s}return null},toObject(t){return[].concat(this.map(function(e){return e==null?null:typeof e.toObject!="function"?e:e.toObject(t)}))},$toObject(){return this.constructor.prototype.toObject.apply(this,arguments)},push(){let t=fE.push.apply(this,arguments);return dE(this),t},pull(){let t=fE.pull.apply(this,arguments);return dE(this),t},shift(){let t=fE.shift.apply(this,arguments);return dE(this),t},splice(){let t=fE.splice.apply(this,arguments);return dE(this),t},inspect(){return this.toObject()},create(t){let e=this[Rh].Constructor;if(t&&e.discriminators&&e.schema&&e.schema.options&&e.schema.options.discriminatorKey)if(typeof t[e.schema.options.discriminatorKey]=="string"&&e.discriminators[t[e.schema.options.discriminatorKey]])e=e.discriminators[t[e.schema.options.discriminatorKey]];else{let r=JH(e.discriminators,t[e.schema.options.discriminatorKey]);r&&(e=r)}return new e(t,this)},notify(t){let e=this;return function r(n,i){i=i||e;let s=i.length;for(;s--;)if(i[s]!=null){switch(t){case"save":n=e[s];break;default:break}Bc.isMongooseArray(i[s])?r(n,i[s]):i[s]&&i[s].emit(t,n)}}},set(t,e,r){let n=this.__array;if(r)return n[t]=e,this;let i=ux._cast.call(this,e,t);return ux._markModified.call(this,t),n[t]=i,this},_markModified(t,e){let r=this[hE],n;if(r){if(n=this[ax],arguments.length)if(e!=null){let i=t.__index;n=n+"."+i+"."+e}else n=n+"."+t;if(n!=null&&n.endsWith(".$"))return this;r.markModified(n,arguments.length!==0?t:r)}return this}};ZH.exports=ux;function dE(t){let e=t[hE];if(!e||e.$__.populated==null)return;let r=Object.keys(e.$__.populated).filter(n=>n.startsWith(t[ax]+"."));for(let n of r){let i=n.slice((t[ax]+".").length);Array.isArray(e.$__.populated[n].value)&&(e.$__.populated[n].value=t.map(s=>s.$populated(i)))}}});var Fc=y((_je,tG)=>{"use strict";var eG=lE(),cx=XH(),lx=oe().arrayAtomicsSymbol,y9e=oe().arrayAtomicsBackupSymbol,px=oe().arrayParentSymbol,fx=oe().arrayPathSymbol,kc=oe().arraySchemaSymbol,g9e=Array.prototype.push,b9e=/^\d+$/;function E9e(t,e,r,n){let i=[],s={[lx]:{},[y9e]:void 0,[fx]:e,[kc]:void 0,[px]:void 0};if(Array.isArray(t)&&(t[fx]===e&&t[px]===r&&(s[lx]=Object.assign({},t[lx])),t.forEach(a=>{g9e.call(i,a)})),s[fx]=e,s.__array=i,r&&r.$__)for(s[px]=r,s[kc]=r.$__schema.path(e);s[kc]!=null&&s[kc].$isMongooseArray&&!s[kc].$isMongooseDocumentArray;)s[kc]=s[kc].embeddedSchemaType;let o=new Proxy(i,{get:function(a,u){return u==="isMongooseArray"||u==="isMongooseArrayProxy"||u==="isMongooseDocumentArray"||u==="isMongooseDocumentArrayProxy"?!0:Object.hasOwn(s,u)?s[u]:Object.hasOwn(cx,u)?cx[u]:n&&n.virtuals&&Object.hasOwn(n.virtuals,u)?n.virtuals[u].applyGetters(void 0,a):Object.hasOwn(eG,u)?eG[u]:i[u]},set:function(a,u,c){return typeof u=="string"&&b9e.test(u)?cx.set.call(o,u,c,!1):Object.hasOwn(s,u)?s[u]=c:n?.virtuals&&Object.hasOwn(n.virtuals,u)?n.virtuals[u].applySetters(c,a):i[u]=c,!0}});return o}tG.exports=E9e});var po=y((EG,_G)=>{"use strict";var _9e=$O(),hx=require("events").EventEmitter,v9e=PW(),w9e=Hb(),ni=xi(),rG=Ef(),A9e=RW(),cG=Yb(),bx=Qb(),S9e=LW(),O9e=Nc(),mx=ou(),EE=Dc(),lG=BO(),pG=WO(),yx=Xb(),mE=eE(),Ns=zt(),x9e=rE().compile,C9e=rE().defineKey,T9e=ZW(),D9e=nE().flatten,dx=cH(),nG=pH(),M9e=dH(),P9e=sE(),iG=Zr(),fG=vf(),B9e=wf(),sG=QO(),gx=require("util").inspect,dG=Fs().internalToObjectOptions,k9e=ZO(),F9e=XO(),I9e=Ti(),Ex=ex(),N9e=Ih(),Ae=ge(),R9e=tx(),gE=Ae.deepEqual,$9e=Ae.isMongooseObject,qh=oe().arrayAtomicsBackupSymbol,Rn=oe().arrayAtomicsSymbol,q9e=oe().documentArrayParent,j9e=oe().documentIsModified,hG=oe().documentModifiedPaths,L9e=oe().documentSchemaSymbol,U9e=oe().getSymbol,z9e=oe().modelSymbol,oG=oe().populateModelSymbol,V9e=oe().scopeSymbol,W9e=Mc().schemaMixedSymbol,H9e=MH(),yE=oe().sessionNewDocuments,bE,aG,$h,mG=Ae.specialProperties,jh=1,Ic=2,Jo=jh|Ic;function R(t,e,r){if(typeof r=="boolean")throw new Error("The skipId parameter has been removed. Use { skipId: true } in the options parameter instead.");r=Object.assign({},r);let n=r.skipId;if(this.$__=new v9e,this.$__schema==null){let c=Ae.isObject(e)&&!e.instanceOfSchema?new O9e(e):e;this.$__setSchema(c),e=r,n=r.skipId}if(r.isNew!=null&&r.isNew!==!0&&(this.$isNew=r.isNew),r.priorDoc!=null&&(this.$__.priorDoc=r.priorDoc),n&&(this.$__.skipId=n),t!=null&&typeof t!="object")throw new bx(t,"obj","Document");let i=!0;r.defaults!==void 0&&(this.$__.defaults=r.defaults,i=r.defaults);let s=this.$__schema;typeof e=="boolean"||e==="throw"?(e!==!0&&(this.$__.strictMode=e),e=void 0):s.options.strict!==!0&&(this.$__.strictMode=s.options.strict);let o=s.requiredPaths(!0);for(let c of o)this.$__.activePaths.require(c);let a=null;Ae.isPOJO(e)&&Object.keys(e).length>0&&(a=B9e(e),this.$__.selected=e,this.$__.exclude=a);let u=a===!1&&e?pG(e):null;if(this._doc==null&&(this.$__buildDoc(t,e,n,a,u,!1),i&&yx(this,e,a,u,!0,null,{skipParentChangeTracking:!0})),t&&(this.$__original_set?this.$__original_set(t,void 0,!0,r):this.$set(t,void 0,!0,r),t instanceof R&&(this.$isNew=t.$isNew)),r.willInit&&i?r.skipDefaults&&(this.$__.skipDefaults=r.skipDefaults):i&&yx(this,e,a,u,!1,r.skipDefaults),!this.$__.strictMode&&t){let c=this;Object.keys(this._doc).forEach(function(p){!(p in s.tree)&&!(p in s.methods)&&!(p in s.virtuals)&&!p.startsWith("$")&&C9e({prop:p,subprops:null,prototype:c})})}tOe(this)}R.prototype.$isMongooseDocumentPrototype=!0;Object.defineProperty(R.prototype,"isNew",{get:function(){return this.$isNew},set:function(t){this.$isNew=t}});Object.defineProperty(R.prototype,"errors",{get:function(){return this.$errors},set:function(t){this.$errors=t}});R.prototype.$isNew=!0;Ae.each(["on","once","emit","listeners","removeListener","setMaxListeners","removeAllListeners","addListener"],function(t){R.prototype[t]=function(){if(!this.$__.emitter){if(t==="emit")return;this.$__.emitter=new hx,this.$__.emitter.setMaxListeners(0)}return this.$__.emitter[t].apply(this.$__.emitter,arguments)},R.prototype[`$${t}`]=R.prototype[t]});R.prototype.constructor=R;for(let t in hx.prototype)R[t]=hx.prototype[t];R.prototype.$__schema;R.prototype.schema;Object.defineProperty(R.prototype,"$locals",{configurable:!1,enumerable:!1,get:function(){return this.$__.locals==null&&(this.$__.locals={}),this.$__.locals},set:function(t){this.$__.locals=t}});R.prototype.isNew;Object.defineProperty(R.prototype,"$where",{configurable:!1,enumerable:!1,writable:!0});R.prototype.id;R.prototype.$errors;Object.defineProperty(R.prototype,"$op",{get:function(){return this.$__.op||null},set:function(t){this.$__.op=t}});function G9e(t,e,r){if(t==null)return;let n=Object.keys(r.$__schema.paths),i=n.length,s=e.indexOf(".")===-1?[e]:e.split(".");for(let o=0;o<i;++o){let a="",u=n[o];if(!u.startsWith(e+"."))continue;let c=r.$__schema.paths[u],l=c.splitPath().slice(s.length),p=l.length;if(c.defaultValue===void 0)continue;let f=t;for(let d=0;d<p&&f!=null;++d){let h=l[d];if(d===p-1){if(f[h]!==void 0)break;try{let m=c.getDefault(r,!1);m!==void 0&&(f[h]=m)}catch(m){r.invalidate(e+"."+a,m);break}break}a+=(a.length?".":"")+h,f[h]=f[h]||{},f=f[h]}}}R.prototype.$__buildDoc=function(t,e,r,n,i){let s={},o=Object.keys(this.$__schema.paths).filter(c=>!c.includes("$*")),a=o.length,u=0;for(;u<a;++u){let c=o[u];if(c==="_id"&&(r||t&&"_id"in t))continue;let l=this.$__schema.paths[c].splitPath(),p=l.length,f=p-1,d="",h=s,m=!1;for(let g=0;g<p;++g){let b=l[g];if(d.length?d+="."+b:d=b,n===!0){if(d in e)break}else if(n===!1&&e&&!m){if(d in e)m=!0;else if(!i[d])break}g<f&&(h=h[b]||(h[b]={}))}}this._doc=s};R.prototype.toBSON=function(){return this.toObject(dG)};R.prototype.init=function(t,e,r){if(typeof e=="function"&&(r=e,e=null),t==null)throw new bx(t,"doc","init");return this.$__init(t,e),r&&r(null,this),this};R.prototype.$init=function(){return this.constructor.prototype.init.apply(this,arguments)};R.prototype.$__init=function(t,e){if(t==null)throw new bx(t,"doc","init");if(this.$isNew=!1,e=e||{},t._id!=null&&e.populated&&e.populated.length){let n=String(t._id);for(let i of e.populated)if(i.isVirtual?this.$populated(i.path,Ae.getValue(i.path,t),i):this.$populated(i.path,i._docs[n],i),i._childDocs!=null){for(let s of i._childDocs)s==null||s.$__==null||(s.$__.parent=this);i._childDocs=[]}}yG(this,t,this._doc,e),k9e(this,e.populated),this.$emit("init",this),this.constructor.emit("init",this);let r=this.$__.exclude===!1&&this.$__.selected?pG(this.$__.selected):null;return yx(this,this.$__.selected,this.$__.exclude,r,!1,this.$__.skipDefaults),this};function yG(t,e,r,n,i){if(i=i||"",typeof e!="object"||Array.isArray(e))throw new cG(t.$basePath,e);e.$__!=null&&(e=e._doc);let s=Object.keys(e),o=s.length,a,u,c,l=t.$__.strictMode,p=t.$__schema;for(let f=0;f<o;++f){if(c=s[f],mG.has(c)||(u=i?i+c:c,a=p.path(u),p.$isRootDiscriminator&&!t.$__isSelected(u)))continue;let d=e[c];if(!a&&Ae.isPOJO(d))r[c]||(r[c]={},(!l&&!(c in p.tree)&&!(c in p.methods)&&!(c in p.virtuals)||n?.virtuals&&c in p.virtuals)&&(t[c]=r[c])),yG(t,d,r[c],n,u+".");else if(!a)r[c]=d,(!l&&!i||n?.virtuals&&c in p.virtuals)&&(t[c]=d);else{if(Object.hasOwn(r,c)&&d!==void 0&&!n.hydratedPopulatedDocs&&delete r[c],d===null)r[c]=a._castNullish(null);else if(d!==void 0){let h=d.$__==null?null:d.$__.wasPopulated;if(a&&!h&&!n.hydratedPopulatedDocs)try{n&&n.setters?r[c]=a.applySetters(d,t,!1,null,n):r[c]=a.cast(d,t,!0,void 0,n)}catch(m){t.invalidate(m.path,new lG({path:m.path,message:m.message,type:"cast",value:m.value,reason:m}))}else a&&n.hydratedPopulatedDocs?(r[c]=a.cast(d,t,!0,void 0,{hydratedPopulatedDocs:!0}),r[c]&&r[c].$__&&r[c].$__.wasPopulated?t.$populated(u,r[c].$__.wasPopulated.value,r[c].$__.wasPopulated.options):Array.isArray(r[c])&&r[c].length&&r[c][0]?.$__?.wasPopulated&&t.$populated(u,r[c].map(m=>m?.$__?.wasPopulated?.value).filter(m=>m!=null),r[c][0].$__.wasPopulated.options)):r[c]=d}t.$isModified(u)||t.$__.activePaths.init(u)}}}R.prototype.updateOne=function(e,r){let n=this.constructor.updateOne({_id:this._doc._id},e,r),i=this;return n.pre(async function(){let o=await i._execDocumentPreHooks("updateOne",i);if(o?.length!==1||o[0]!==i)throw new Error("Document updateOne pre hooks cannot overwrite arguments");return i.$where!=null&&this.where(i.$where),o}),n.post(function(){return i._execDocumentPostHooks("updateOne")}),this.$session()!=null&&("session"in n.options||(n.options.session=this.$session())),n};R.prototype.replaceOne=function(){let e=[...arguments];return e.unshift({_id:this._doc._id}),this.constructor.replaceOne.apply(this.constructor,e)};R.prototype.$session=function(e){if(arguments.length===0)return this.$__.session!=null&&this.$__.session.hasEnded?(this.$__.session=null,null):this.$__.session;if(e!=null&&e.hasEnded)throw new ni("Cannot set a document's session to a session that has ended. Make sure you haven't called `endSession()` on the session you are passing to `$session()`.");if(!(e==null&&this.$__.session==null)){if(this.$__.session=e,!this.$isSubdocument){let r=this.$getAllSubdocs();for(let n of r)n.$session(e)}return e}};R.prototype.$timestamps=function(e){if(arguments.length===0)return this.$__.timestamps!=null?this.$__.timestamps:this.$__schema?this.$__schema.options.timestamps:void 0;let r=this.$timestamps();return e!==r&&(this.$__.timestamps=e),this};R.prototype.overwrite=function(e){let r=Array.from(new Set(Object.keys(this._doc).concat(Object.keys(e))));for(let n of r)n!=="_id"&&(this.$__schema.options.versionKey&&n===this.$__schema.options.versionKey||this.$__schema.options.discriminatorKey&&n===this.$__schema.options.discriminatorKey||this.$set(n,e[n]));return this};R.prototype.$set=function(e,r,n,i){Ae.isPOJO(n)&&(i=n,n=void 0);let s=i&&i.merge,o=n&&n!==!0,a=n===!0,u,c,l=0,p,f,d,h=i&&"strict"in i,m=h?i.strict:this.$__.strictMode;if(o&&(u=this.$__.adhocPaths||(this.$__.adhocPaths={}),u[e]=this.$__schema.interpretAsType(e,n,this.$__schema.options)),e==null)[e,r]=[r,e];else if(typeof e!="string"){e instanceof R&&(e.$__isNested?e=e.toObject():e=e.$__schema===this.$__schema?_x(e,{...e._doc}):e._doc),e==null&&([e,r]=[r,e]),d=r?r+".":"",c=nG(this.$__schema,e);let k=c.length,D=i&&i._skipMinimizeTopLevel||!1;if(k===0&&D)return delete i._skipMinimizeTopLevel,r&&this.$set(r,{}),this;i=Object.assign({},i,{_skipMinimizeTopLevel:!1});for(let L=0;L<k;++L){f=c[L];let J=d?d+f:f;p=this.$__schema.pathType(J);let re=e[f];if(n===!0&&!d&&re!=null&&p==="nested"&&this._doc[f]!=null&&delete this._doc[f],Ae.isNonBuiltinObject(re)&&p==="nested"){this.$set(J,re,a,i),G9e(this.$get(J),J,this);continue}else if(m){if(a&&re===void 0&&this.$get(J)!==void 0)continue;if(p==="adhocOrUndefined"&&(p=dx(this,J,{typeOnly:!0})),p==="real"||p==="virtual")this.$set(J,re,a,i);else if(p==="nested"&&re instanceof R)this.$set(J,re.toObject({transform:!1}),a,i);else{if(m==="throw")throw p==="nested"?new cG(f,re):new mx(f);p==="nested"&&re==null&&this.$set(J,re,a,i)}}else this.$set(J,re,a,i)}let B={},$=Object.keys(this.$__schema.tree);for(let L=0,J=$.length;L<J;++L)(f=$[L])&&Object.hasOwn(this._doc,f)&&(B[f]=void 0);return this._doc=Object.assign(B,this._doc),this}let g=this.$__schema.pathType(e),b=null;if(g==="adhocOrUndefined"&&(b=e.indexOf(".")===-1?[e]:e.split("."),g=dx(this,b,{typeOnly:!0})),g==="adhocOrUndefined"&&!h){b==null&&(b=e.indexOf(".")===-1?[e]:e.split("."));let k=M9e(this.$__schema,b);k!==void 0&&(m=k)}r=P9e(r,!0);let _=(()=>{if(this.$__.priorDoc!=null)return this.$__.priorDoc.$__getValue(e);if(!a)return this.$__getValue(e)})();if(g==="nested"&&r){if(typeof r=="object"&&r!=null){if(r.$__!=null&&(r=r.toObject(dG)),r==null)return this.invalidate(e,new ni.CastError("Object",r,e)),this;let k=this.$isModified(e),D=this.$__.savedState!=null&&Object.hasOwn(this.$__.savedState,e);if(this.$__.savedState!=null&&!this.$isNew&&!Object.hasOwn(this.$__.savedState,e)){let $=this.$__getValue(e);this.$__.savedState[e]=$;let L=Object.keys($||{});for(let J of L)this.$__.savedState[e+"."+J]=$[J]}if(!s)this.$__setValue(e,null),mE(this,e);else return this.$set(r,e,a,i);let B=nG(this.$__schema,r,e);this.$__setValue(e,{});for(let $ of B)this.$set(e+"."+$,r[$],a,{...i,_skipMarkModified:!0});return _!=null&&(!k||D)&&Ae.deepEqual(D?this.$__.savedState[e]:_,r)?this.unmarkModified(e):this.markModified(e),this}return this.invalidate(e,new ni.CastError("Object",r,e)),this}let w;if(b==null&&(b=e.indexOf(".")===-1?[e]:e.split(".")),typeof this.$__schema.aliases[b[0]]=="string"&&(b[0]=this.$__schema.aliases[b[0]]),g==="adhocOrUndefined"&&m){let k;for(l=0;l<b.length;++l){let D=b.slice(0,l+1).join(".");if(l+1<b.length&&this.$__schema.pathType(D)==="virtual")return I9e.set(e,r,this),this;if(w=this.$__schema.path(D),w!=null){if(w instanceof rG){k=!0;break}else if(w.$isSchemaMap&&w.$__schemaType instanceof rG&&l<b.length-1){k=!0,w=w.$__schemaType;break}}}if(w==null&&(w=dx(this,e)),!k&&!w){if(m==="throw")throw new mx(e);return this}}else{if(g==="virtual")return w=this.$__schema.virtualpath(e),w.applySetters(r,this),this;w=this.$__path(e)}let E=this._doc,A="";for(l=0;l<b.length-1;++l)E=E instanceof Map?E.get(b[l]):E[b[l]],A+=(A.length!==0?".":"")+b[l],E||(this.$set(A,{}),this.$__isSelected(A)||this.unmarkModified(A),E=this.$__getValue(A));let O;if(b.length<=1)O=e;else{let k=b.length;for(l=0;l<k;++l){let D=b.slice(0,l+1).join(".");if(this.$get(D,null,{getters:!1})===null){O=D;break}}O||(O=e)}if(!w)return this.$__set(O,e,i,a,b,w,r,_),g==="nested"&&r==null&&mE(this,e),this;if((w.$isSingleNested||w.$isMongooseArray)&&X9e(this,e),r!=null&&s&&w.$isSingleNested){r instanceof R&&(r=r.toObject({virtuals:!1,transform:!1}));let k=Object.keys(r);for(let D of k)this.$set(e+"."+D,r[D],a,i);return this}let C=!0;try{let k=(()=>{if(w.options==null||!(r instanceof R))return!1;let L=r.constructor,J=typeof w.options.ref=="function"&&!w.options.ref[z9e]?w.options.ref.call(this,this):w.options.ref,re=J?.modelName||J;if(re!=null&&(re===L.modelName||re===L.baseModelName))return!0;let Qe=w.options.refPath;if(Qe==null)return!1;let mr=r.get(Qe);return mr===L.modelName||mr===L.baseModelName})(),D=!1;if(k&&r instanceof R&&(!r.$__.wasPopulated||Ae.deepEqual(r.$__.wasPopulated.value,r._doc._id))){let L=w&&w.$isSingleNested?w.cast(r,this):r._doc._id;this.$populated(e,L,{[oG]:r.constructor}),r.$__.wasPopulated={value:L},D=!0}let B,$=this.$__schema.options.typeKey;if(w.options&&Array.isArray(w.options[$])&&w.options[$].length&&w.options[$][0]&&w.options[$][0].ref&&K9e(r,w.options[$][0].ref)){B={[oG]:r[0].constructor},this.$populated(e,r.map(function(L){return L._doc._id}),B);for(let L of r)L.$__.wasPopulated={value:L._doc._id};D=!0}if(!k||!w.$isSingleNested||!r.$__){let L=this;this.$__schema.singleNestedPaths[e]!=null&&b.length>1&&(L=H9e(this,b,this.schema)),i!=null&&i.overwriteImmutable?r=w.applySetters(r,L,!1,_,{path:e,overwriteImmutable:!0}):r=w.applySetters(r,L,!1,_,{path:e})}if(Array.isArray(r)&&!Array.isArray(w)&&w.$isMongooseDocumentArray&&r.length!==0&&r[0]!=null&&r[0].$__!=null&&r[0].$__.populated!=null){let L=Object.keys(r[0].$__.populated);for(let J of L)this.$populated(e+"."+J,r.map(re=>re.$populated(J)),r[0].$__.populated[J].options);D=!0}if(!D&&this.$__.populated){if(Array.isArray(r)&&this.$__.populated[e])for(let L=0;L<r.length;++L)r[L]instanceof R&&r.set(L,r[L]._doc._id,!0);delete this.$__.populated[e]}r!=null&&w.$isSingleNested&&eOe(r,w,_),this.$markValid(e)}catch(k){k instanceof ni.StrictModeError&&k.isImmutableError?this.invalidate(e,k):k instanceof ni.CastError?(this.invalidate(k.path,k),k.$originalErrorPath&&this.invalidate(e,new ni.CastError(w.instance,r,e,k.$originalErrorPath))):this.invalidate(e,new ni.CastError(w.instance,r,e,k)),C=!1}if(C){let k=null,D=null;if(!a){let L=this.$isSubdocument?this.ownerDocument():this;k=L.$__.savedState,D=this.$isSubdocument?this.$__.fullPath+"."+e:e,L.$__saveInitialState(D)}this.$__set(O,e,i,a,b,w,r,_);let B=!!this.$__.session?.transaction,$=this.$__.session&&this.$__.session[yE]&&this.$__.session[yE].has(this)&&this.$__.session[yE].get(this).modifiedPaths&&!this.$__.session[yE].get(this).modifiedPaths.has(D);k!=null&&Object.hasOwn(k,D)&&(!B||$)&&Ae.deepEqual(r,k[D])&&this.unmarkModified(e)}return w.$isSingleNested&&(this.isDirectModified(e)||r==null)?mE(this,e):w.$isSchemaMap&&r==null&&mE(this,e),this};function K9e(t,e){if(!Array.isArray(t)||t.length===0)return!1;for(let r of t)if(!(r instanceof R)||r.constructor.modelName==null||r.constructor.modelName!=e&&r.constructor.baseModelName!=e)return!1;return!0}R.prototype.set=R.prototype.$set;R.prototype.$__shouldModify=function(t,e,r,n,i,s,o,a){return r&&r._skipMarkModified?!1:this.$isNew||e in this.$__.activePaths.getStatePaths("modify")||o===void 0&&!this.$__isSelected(e)?!0:o===void 0&&e in this.$__.activePaths.getStatePaths("default")||this.$populated(e)&&o instanceof R&&gE(o._doc._id,a)?!1:!!(!gE(o,a!==void 0?a:Ae.getValue(e,this))||!n&&o!==null&&o!==void 0&&e in this.$__.activePaths.getStatePaths("default")&&gE(o,s.getDefault(this,n)))};R.prototype.$__set=function(t,e,r,n,i,s,o,a){$h=$h||Af();let u=this.$__shouldModify(t,e,r,n,i,s,o,a);u?(this.$__.primitiveAtomics&&this.$__.primitiveAtomics[e]&&(delete this.$__.primitiveAtomics[e],Object.keys(this.$__.primitiveAtomics).length===0&&delete this.$__.primitiveAtomics),this.markModified(t),aG||(aG=ox()),o&&Ae.isMongooseArray(o)&&(o._registerAtomic("$set",o),Ae.isMongooseDocumentArray(o)&&o.forEach(function(d){d&&d.__parentArray&&(d.__parentArray=o)}))):Array.isArray(o)&&Array.isArray(a)&&Ae.isMongooseArray(o)&&Ae.isMongooseArray(a)&&(o[Rn]=a[Rn],o[qh]=a[qh],Ae.isMongooseDocumentArray(o)&&o.forEach(d=>{d!=null&&(d.$isNew=!1)}));let c=this._doc,l=0,p=i.length,f="";for(;l<p;l++){let h=l+1===p;if(f+=f?"."+i[l]:i[l],!mG.has(i[l]))if(h)c instanceof Map?c.set(i[l],o):c.$isSingleNested?(i[l]in c||(c[i[l]]=o),c._doc[i[l]]=o,u&&c.markModified(i[l])):c[i[l]]=o;else{let m=c instanceof Map,g=m?c.get(i[l]):c[i[l]];Ae.isPOJO(g)||g&&g instanceof $h||g&&!Array.isArray(g)&&g.$isSingleNested||g&&Array.isArray(g)||g==null&&(g={},m?c.set(i[l],g):c[i[l]]=g),c=g}}};R.prototype.$__getValue=function(t){if(typeof t!="string"&&!Array.isArray(t))throw new TypeError(`Invalid \`path\`. Must be either string or array. Got "${t}" (type ${typeof t})`);return Ae.getValue(t,this._doc)};R.prototype.$inc=function(e,r){if(r==null&&(r=1),Array.isArray(e))return e.forEach(u=>this.$inc(u,r)),this;let n=this.$__path(e);if(n==null){if(this.$__.strictMode==="throw")throw new mx(e);if(this.$__.strictMode===!0)return this}else if(n.instance!=="Number")return this.invalidate(e,new ni.CastError(n.instance,r,e)),this;let i=this.$__getValue(e)||0,s=!1,o=null,a=r;try{r=n.cast(r),o=n.applySetters(i+r,this),a=o-i,s=!0}catch(u){this.invalidate(e,new ni.CastError("number",r,e,u))}return s&&(this.$__.primitiveAtomics=this.$__.primitiveAtomics||{},this.$__.primitiveAtomics[e]==null?this.$__.primitiveAtomics[e]={$inc:a}:this.$__.primitiveAtomics[e].$inc+=a,this.markModified(e),this.$__setValue(e,o)),this};R.prototype.$__setValue=function(t,e){return Ae.setValue(t,e,this._doc),this};R.prototype.get=function(t,e,r){let n;r==null&&(r={}),e&&(n=this.$__schema.interpretAsType(t,e,this.$__schema.options));let i=r.noDottedPath,s=i?this.$__schema.paths[t]:this.$__path(t);if(s==null&&(s=this.$__schema.virtualpath(t),s!=null))return s.applyGetters(void 0,this);if(i){let c=this._doc[t];return n&&(c=n.cast(c)),s!=null&&r.getters!==!1?s.applyGetters(c,this):c}if(s!=null&&s.instance==="Mixed"){let c=this.$__schema.virtualpath(t);c!=null&&(s=c)}let o=t.indexOf(".")!==-1,a=this._doc,u=o?t.split("."):[t];typeof this.$__schema.aliases[u[0]]=="string"&&(u[0]=this.$__schema.aliases[u[0]]);for(let c=0,l=u.length;c<l;c++)a&&a._doc&&(a=a._doc),a==null?a=void 0:a instanceof Map?a=a.get(u[c],{getters:!1}):c===l-1?a=Ae.getValue(u[c],a):a=a[u[c]];if(n&&(a=n.cast(a)),s!=null&&r.getters!==!1)a=s.applyGetters(a,this);else if(this.$__schema.nested[t]&&r.virtuals)return _x(this,Ns(a)||{},{path:t});return a};R.prototype[U9e]=R.prototype.get;R.prototype.$get=R.prototype.get;R.prototype.$__path=function(t){let e=this.$__.adhocPaths,r=e&&Object.hasOwn(e,t)?e[t]:null;return r||this.$__schema.path(t)};R.prototype.markModified=function(t,e){this.$__saveInitialState(t),this.$__.activePaths.modify(t),e!=null&&!this.$isSubdocument&&(this.$__.pathsToScopes=this.$__pathsToScopes||{},this.$__.pathsToScopes[t]=e)};R.prototype.$__saveInitialState=function(e){let r=this.$__.savedState,n=e;if(r!=null){let i=n.indexOf("."),s=i===-1?n:n.slice(0,i);Object.hasOwn(r,s)||(r[s]=Ns(this.$__getValue(s)))}};R.prototype.unmarkModified=function(t){this.$__.activePaths.init(t),this.$__.pathsToScopes!=null&&delete this.$__.pathsToScopes[t]};R.prototype.$ignore=function(t){this.$__.activePaths.ignore(t)};R.prototype.directModifiedPaths=function(){return Object.keys(this.$__.activePaths.getStatePaths("modify"))};R.prototype.$isEmpty=function(t){let e={minimize:!0,virtuals:!1,getters:!1,transform:!1};if(arguments.length!==0){let r=this.$get(t);return r==null?!0:typeof r!="object"?!1:Ae.isPOJO(r)?gG(r):Object.keys(r.toObject(e)).length===0}return Object.keys(this.toObject(e)).length===0};function gG(t){if(t==null)return!0;if(typeof t!="object"||Array.isArray(t))return!1;for(let e of Object.keys(t))if(!gG(t[e]))return!1;return!0}R.prototype.modifiedPaths=function(t){t=t||{};let e=Object.keys(this.$__.activePaths.getStatePaths("modify")),r=new Set,n=0,i=0,s=e.length;for(n=0;n<s;++n){let o=e[n],a=Ex(o),u=a.length;for(i=0;i<u;++i)r.add(a[i]);if(!t.includeChildren)continue;let c=0,l=this.$get(o);if(typeof l=="object"&&l!==null){l._doc&&(l=l._doc);let p=l.length;if(Array.isArray(l))for(c=0;c<p;++c){let f=o+"."+c;if(!r.has(f)&&(r.add(f),l[c]!=null&&l[c].$__)){let d=l[c].modifiedPaths(),h=0,m=d.length;for(h=0;h<m;++h)r.add(f+"."+d[h])}}else{let f=Object.keys(l),d=0,h=f.length;for(d=0;d<h;++d)r.add(o+"."+f[d])}}}return Array.from(r)};R.prototype[hG]=R.prototype.modifiedPaths;R.prototype.isModified=function(t,e,r){if(t){let n=e&&e.ignoreAtomics,i=this.$__.activePaths.states.modify;if(i==null)return!1;typeof t=="string"&&(t=t.indexOf(" ")===-1?[t]:t.split(" "));for(let u of t)if(i[u]!=null)return!0;let s=r||this[hG](),o=t.some(function(u){return!!~s.indexOf(u)}),a=Object.keys(i);return n&&(a=a.filter(u=>{let c=this.$__getValue(u);return!(c!=null&&c[Rn]!=null&&c[Rn].$set===void 0)})),o||t.some(function(u){return a.some(function(c){return c===u||u.startsWith(c+".")})})}return this.$__.activePaths.some("modify")};R.prototype.$isModified=R.prototype.isModified;R.prototype[j9e]=R.prototype.isModified;R.prototype.$isDefault=function(t){if(t==null)return this.$__.activePaths.some("default");if(typeof t=="string"&&t.indexOf(" ")===-1)return Object.hasOwn(this.$__.activePaths.getStatePaths("default"),t);let e=t;return Array.isArray(e)||(e=e.split(" ")),e.some(r=>Object.hasOwn(this.$__.activePaths.getStatePaths("default"),r))};R.prototype.$isDeleted=function(t){return arguments.length===0?!!this.$__.isDeleted:(this.$__.isDeleted=!!t,this)};R.prototype.isDirectModified=function(t){if(t==null)return this.$__.activePaths.some("modify");if(typeof t=="string"&&t.indexOf(" ")===-1){let r=Object.hasOwn(this.$__.activePaths.getStatePaths("modify"),t);if(r||t.indexOf(".")===-1)return r;let n=t.split(".");for(let i=0;i<n.length-1;++i){let s=n.slice(0,i+1).join("."),o=this.$get(s);if(o!=null&&o.$__!=null&&o.isDirectModified(n.slice(i+1).join(".")))return!0}return!1}let e=t;return typeof e=="string"&&(e=e.split(" ")),e.some(r=>this.isDirectModified(r))};R.prototype.isInit=function(t){if(t==null)return this.$__.activePaths.some("init");if(typeof t=="string"&&t.indexOf(" ")===-1)return Object.hasOwn(this.$__.activePaths.getStatePaths("init"),t);let e=t;return Array.isArray(e)||(e=e.split(" ")),e.some(r=>Object.hasOwn(this.$__.activePaths.getStatePaths("init"),r))};R.prototype.isSelected=function(e){if(this.$__.selected==null)return!0;if(!e)return!1;if(e==="_id")return this.$__.selected._id!==0;if(e.indexOf(" ")!==-1&&(e=e.split(" ")),Array.isArray(e))return e.some(s=>this.$__isSelected(s));let r=Object.keys(this.$__.selected),n=null;if(r.length===1&&r[0]==="_id")return this.$__.selected._id===0;for(let s of r)if(s!=="_id"&&fG(this.$__.selected[s])){n=!!this.$__.selected[s];break}if(n===null)return!0;if(e in this.$__.selected)return n;let i=e+".";for(let s of r)if(s!=="_id"){if(s.startsWith(i))return n||s!==i;if(i.startsWith(s+"."))return n}return!n};R.prototype.$__isSelected=R.prototype.isSelected;R.prototype.isDirectSelected=function(e){if(this.$__.selected==null)return!0;if(e==="_id")return this.$__.selected._id!==0;if(e.indexOf(" ")!==-1&&(e=e.split(" ")),Array.isArray(e))return e.some(i=>this.isDirectSelected(i));let r=Object.keys(this.$__.selected),n=null;if(r.length===1&&r[0]==="_id")return this.$__.selected._id===0;for(let i of r)if(i!=="_id"&&fG(this.$__.selected[i])){n=!!this.$__.selected[i];break}return n===null?!0:Object.hasOwn(this.$__.selected,e)?n:!n};R.prototype.validate=async function(e,r){if(typeof e=="function"||typeof r=="function"||typeof arguments[2]=="function")throw new ni("Document.prototype.validate() no longer accepts a callback");if(this.$op="validate",arguments.length===1&&typeof arguments[0]=="object"&&!Array.isArray(arguments[0])&&(r=arguments[0],e=null),r&&typeof r.pathsToSkip=="string"){let i=r.pathsToSkip.indexOf(" ")===-1;r.pathsToSkip=i?[r.pathsToSkip]:r.pathsToSkip.split(" ")}let n=r&&r._skipParallelValidateCheck;if(this.$isSubdocument==null){if(this.$__.validating&&!n)throw new S9e(this);n||(this.$__.validating=!0)}try{await this.$__validate(e,r)}finally{this.$op=null,this.$__.validating=null}};R.prototype.$validate=R.prototype.validate;function Y9e(t){let e=Object.keys(t.$__.activePaths.getStatePaths("require")),r=0,n=e.length;for(r=0;r<n;++r){let i=e[r],s=t.$__schema.path(i);if(s!=null&&typeof s.originalRequiredValue=="function"){t.$__.cachedRequired=t.$__.cachedRequired||{};try{t.$__.cachedRequired[i]=s.originalRequiredValue.call(t,t)}catch(o){t.invalidate(i,o)}}}}function bG(t,e,r,n){let i={};Y9e(t);let s=new Set(Object.keys(t.$__.activePaths.getStatePaths("require")).filter(function(u){return!t.$__isSelected(u)&&!t.$isModified(u)||u.endsWith(".$*")?!1:t.$__.cachedRequired!=null&&u in t.$__.cachedRequired?t.$__.cachedRequired[u]:!0}));Object.keys(t.$__.activePaths.getStatePaths("init")).forEach(o),Object.keys(t.$__.activePaths.getStatePaths("modify")).forEach(o),Object.keys(t.$__.activePaths.getStatePaths("default")).forEach(o);function o(u){u.endsWith(".$*")||s.add(u)}if(!n){let u=[];for(let l of Object.keys(t.$__schema.paths)){let p=t.$__schema.path(l);if(p.$isSingleNested){let f=t.$get(l);f&&u.push(f)}else if(p.$isMongooseDocumentArray){let f=t.$get(l);if(f&&f.length)for(let d of f)d&&u.push(d)}}let c=t.modifiedPaths();for(let l of u)if(l.$basePath){let p=l.$__pathRelativeToParent();for(let d of l.modifiedPaths())s.delete(p+"."+d);let f=l.$parent();if(f==null)throw new Error("Cannot validate subdocument that does not have a parent");t.$isModified(p,null,c)&&!Object.hasOwn(f.$__.activePaths.getStatePaths("modify"),p)&&!f.$isDefault(p)&&(s.add(p),t.$__.pathsToScopes==null&&(t.$__.pathsToScopes={}),t.$__.pathsToScopes[p]=l.$isDocumentArrayElement?l.__parentArray:l.$parent(),i[p]={skipSchemaValidators:!0},l.$isDocumentArrayElement&&l.__index!=null&&(i[p].index=l.__index))}}for(let u of s){let c=t.$__schema.path(u);if(c){if(c.$isMongooseDocumentArray)for(let l of s)(l==null||l.startsWith(c.path+"."))&&s.delete(l);(!c.schema&&!c.embeddedSchemaType&&c.validators.length===0&&!c.$parentSchemaDocArray||c.$isMongooseArray&&!c.$isMongooseDocumentArray&&!c.embeddedSchemaType.$isMongooseArray&&c.validators.length===0&&c.embeddedSchemaType.validators.length===0)&&s.delete(u)}}Array.isArray(e)?s=Q9e(s,e):Array.isArray(r)&&(s=Z9e(s,r)),J9e(t,s);let a={skipArrays:!0};for(let u of s)if(t.$__schema.nested[u]){let c=t.$__getValue(u);$9e(c)&&(c=c.toObject({transform:!1}));let l=D9e(c,u,a,t.$__schema),p=t.$__schema.singleNestedPaths;for(let f of Object.keys(l))Object.hasOwn(p,f)||o(f)}for(let u of s){let c=t.$__schema.path(u);if(!c||(c.$parentSchemaDocArray&&typeof c.$parentSchemaDocArray.path=="string"&&s.add(c.$parentSchemaDocArray.path),!c.$isSchemaMap))continue;let l=t.$__getValue(u);if(l!=null)for(let p of l.keys())s.add(u+"."+p)}return s=Array.from(s),[s,i]}function J9e(t,e){for(let r of e){let n=t.$__schema.path(r);if(!n||!n.$isMongooseArray||!Array.isArray(n)&&n.$isMongooseDocumentArray&&!(n&&n.schemaOptions&&n.schemaOptions.required)||n.$isMongooseArray&&!n.$isMongooseDocumentArray&&!n.embeddedSchemaType.$isMongooseArray&&n.embeddedSchemaType.validators.length===0)continue;let i=t.$__getValue(r);_E(i,e,r)}}function _E(t,e,r){if(t!=null){let n=t.length;for(let i=0;i<n;++i)Array.isArray(t[i])?_E(t[i],e,r+"."+i):e.add(r+"."+i)}}R.prototype._execDocumentPreHooks=async function(e,...r){return this.$__middleware.execPre(e,this,[...r])};R.prototype._execDocumentPostHooks=async function(e,r){return this.$__middleware.execPost(e,this,[this],{error:r})};R.prototype.$__validate=async function(e,r){try{[r]=await this._execDocumentPreHooks("validate",r)}catch(g){await this._execDocumentPostHooks("validate",g);return}this.$__.saveOptions&&this.$__.saveOptions.pathsToSave&&!e&&(e=[...this.$__.saveOptions.pathsToSave]);let n=r&&typeof r=="object"&&"validateModifiedOnly"in r,i=r&&r.pathsToSkip||null,s;n?s=!!r.validateModifiedOnly:s=this.$__schema.options.validateModifiedOnly;let o=r&&r.validateAllPaths;if(o){if(i)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToSkip`");if(e)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToValidate`");if(n&&s)throw new TypeError("Cannot set both `validateAllPaths` and `validateModifiedOnly`")}let a=this,u=()=>{let g=this.$__.validationError;if(this.$__.validationError=null,this.$__.validating=null,s&&g!=null){let b=Object.keys(g.errors);for(let _ of b)this.$isModified(_)||delete g.errors[_];Object.keys(g.errors).length===0&&(g=void 0)}if(this.$__.cachedRequired={},this.$emit("validate",a),this.constructor.emit("validate",a),g){for(let b in g.errors)!this[q9e]&&g.errors[b]instanceof ni.CastError&&this.invalidate(b,g.errors[b]);return g}},c,l;if(o){c=new Set(Object.keys(this.$__schema.paths));for(let g of c){let b=this.$__schema.path(g);if(!b||!b.$isMongooseArray)continue;let _=this.$__getValue(g);_&&_E(_,c,g)}c=[...c],l={}}else{let g=bG(this,e,i,r&&r._nestedValidate);c=s?g[0].filter(b=>this.$isModified(b)):g[0],l=g[1]}if(typeof e=="string"&&(e=e.split(" ")),c.length===0){let g=u();await this._execDocumentPostHooks("validate",g);return}let p={},f=this.$__.saveOptions?.pathsToSave,d=[];if(Array.isArray(f)){f=new Set(f);for(let g of c)f.has(g)&&d.push(m(g))}else for(let g of c)d.push(m(g));await Promise.all(d);let h=u();await this._execDocumentPostHooks("validate",h);async function m(g){if(g==null||p[g])return;p[g]=!0;let b=a.$__schema.path(g);if(!b||!a.$isValid(g)||b[W9e]!=null&&g!==b.path)return;let _=a.$__getValue(g),w;(w=a.$populated(g))?_=w:_!=null&&_.$__!=null&&_.$__.wasPopulated&&(_=_._doc._id);let E=a.$__.pathsToScopes!=null&&g in a.$__.pathsToScopes?a.$__.pathsToScopes[g]:a,A={...l[g],path:g,validateAllPaths:o,_nestedValidate:!0};try{await b.doValidate(_,E,A)}catch(O){if((b.$isSingleNested||b.$isArraySubdocument||b.$isMongooseDocumentArray)&&O instanceof EE)return;a.invalidate(g,O,void 0,!0)}}};function Q9e(t,e){let r=new Set(e),n=new Map([]);for(let s of e){if(s.indexOf(".")===-1)continue;let o=s.split("."),a=o[0];for(let u=1;u<o.length;++u)n.set(a,s),a=a+"."+o[u]}let i=new Set;for(let s of t)r.has(s)?i.add(s):n.has(s)&&i.add(n.get(s));return i}function Z9e(t,e){return e=new Set(e),t=Array.from(t).filter(r=>!e.has(r)),new Set(t)}R.prototype.validateSync=function(t,e){let r=this;arguments.length===1&&typeof arguments[0]=="object"&&!Array.isArray(arguments[0])&&(e=arguments[0],t=null);let n=e&&typeof e=="object"&&"validateModifiedOnly"in e,i;n?i=!!e.validateModifiedOnly:i=this.$__schema.options.validateModifiedOnly;let s=e&&e.pathsToSkip,o=e&&e.validateAllPaths;if(o){if(s)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToSkip`");if(t)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToValidate`")}typeof t=="string"?t=t.indexOf(" ")===-1?[t]:t.split(" "):typeof s=="string"&&s.indexOf(" ")!==-1&&(s=s.split(" "));let a,u;if(o){a=new Set(Object.keys(this.$__schema.paths));for(let p of a){let f=this.$__schema.path(p);if(!f||!f.$isMongooseArray)continue;let d=this.$__getValue(p);d&&_E(d,a,p)}a=[...a],u={}}else{let p=bG(this,t,s);a=i?p[0].filter(f=>this.$isModified(f)):p[0],u=p[1]}let c={};for(let p=0,f=a.length;p<f;++p){let d=a[p];if(c[d])continue;c[d]=!0;let h=r.$__schema.path(d);if(!h||!r.$isValid(d))continue;let m=r.$__getValue(d),g=h.doValidateSync(m,r,{skipSchemaValidators:u[d],path:d,validateModifiedOnly:i,validateAllPaths:o});if(g){if((h.$isSingleNested||h.$isArraySubdocument||h.$isMongooseDocumentArray)&&g instanceof EE)continue;r.invalidate(d,g,void 0,!0)}}let l=r.$__.validationError;if(r.$__.validationError=void 0,r.$emit("validate",r),r.constructor.emit("validate",r),l)for(let p in l.errors)l.errors[p]instanceof ni.CastError&&r.invalidate(p,l.errors[p]);return l};R.prototype.invalidate=function(t,e,r,n){if(this.$__.validationError||(this.$__.validationError=new EE(this)),!this.$__.validationError.errors[t])return(!e||typeof e=="string")&&(e=new lG({path:t,message:e,type:n||"user defined",value:r})),this.$__.validationError===e?this.$__.validationError:(this.$__.validationError.addError(t,e),this.$__.validationError)};R.prototype.$markValid=function(t){!this.$__.validationError||!this.$__.validationError.errors[t]||(delete this.$__.validationError.errors[t],Object.keys(this.$__.validationError.errors).length===0&&(this.$__.validationError=null))};function X9e(t,e){if(!t.$__.validationError)return;let r=Object.keys(t.$__.validationError.errors);for(let n of r)n.startsWith(e+".")&&delete t.$__.validationError.errors[n];Object.keys(t.$__.validationError.errors).length===0&&(t.$__.validationError=null)}function eOe(t,e,r){let n=e.schema;if(n!=null)for(let i of Object.keys(n.paths)){let s=n.paths[i];if(s.$immutableSetter==null)continue;let o=r?.$__getValue(i);s.$immutableSetter.call(t,o)}}R.prototype.$isValid=function(t){return this.$__.validationError==null||Object.keys(this.$__.validationError.errors).length===0?!0:t==null?!1:(t.indexOf(" ")!==-1&&(t=t.split(" ")),Array.isArray(t)?t.some(e=>this.$__.validationError.errors[e]==null):this.$__.validationError.errors[t]==null)};R.prototype.$__reset=function(){let e=this,r=this.$isSubdocument?null:this.$getAllSubdocs({useCache:!0});if(r&&r.length>0)for(let n of r)n.$__reset();return this.$__dirty().forEach(function(n){let i=n.value;i&&i[Rn]&&(i[qh]=i[Rn],i[Rn]={})}),this.$__.backup={},this.$__.backup.activePaths={modify:Object.assign({},this.$__.activePaths.getStatePaths("modify")),default:Object.assign({},this.$__.activePaths.getStatePaths("default"))},this.$__.backup.validationError=this.$__.validationError,this.$__.backup.errors=this.$errors,this.$__.activePaths.clear("modify"),this.$__.activePaths.clear("default"),this.$__.validationError=void 0,this.$errors=void 0,e=this,this.$__schema.requiredPaths().forEach(function(n){e.$__.activePaths.require(n)}),this};R.prototype.$__undoReset=function(){if(!(this.$__.backup==null||this.$__.backup.activePaths==null)){this.$__.activePaths.states.modify=this.$__.backup.activePaths.modify,this.$__.activePaths.states.default=this.$__.backup.activePaths.default,this.$__.validationError=this.$__.backup.validationError,this.$errors=this.$__.backup.errors;for(let e of this.$__dirty()){let r=e.value;r&&r[Rn]&&r[qh]&&(r[Rn]=r[qh])}if(!this.$isSubdocument)for(let e of this.$getAllSubdocs())e.$__undoReset()}};R.prototype.$__dirty=function(){let t=this,e=this.$__.activePaths.map("modify",function(i){return{path:i,value:t.$__getValue(i),schema:t.$__path(i)}});e=e.concat(this.$__.activePaths.map("default",function(i){if(!(i==="_id"||t.$__getValue(i)==null))return{path:i,value:t.$__getValue(i),schema:t.$__path(i)}}));let r=new Map(e.filter(i=>i!=null).map(i=>[i.path,i.value])),n=[];return e.forEach(function(i){if(!i)return;let s=null,o=Ex(i.path);for(let a=0;a<o.length-1;a++)if(r.has(o[a])){s=r.get(o[a]);break}s==null?n.push(i):s!=null&&s[Rn]!=null&&s.hasAtomics()&&(s[Rn]={},s[Rn].$set=s)}),n};R.prototype.$__setSchema=function(t){x9e(t.tree,this,void 0,t.options);for(let e of Object.keys(t.virtuals))t.virtuals[e]._applyDefaultGetters();t.path("schema")==null&&(this.schema=t),this.$__schema=t,this.$__middleware=t._getDocumentMiddleware(),this[L9e]=t};R.prototype.$__getArrayPathsToValidate=function(){return bE||(bE=Fc()),this.$__.activePaths.map("init","modify",function(t){return this.$__getValue(t)}.bind(this)).filter(function(t){return t&&Array.isArray(t)&&Ae.isMongooseDocumentArray(t)&&t.length}).reduce(function(t,e){return t.concat(e)},[]).filter(function(t){return t})};R.prototype.$getAllSubdocs=function(t){if(t?.useCache&&this.$__.saveOptions?.__subdocs)return this.$__.saveOptions.__subdocs;bE||(bE=Fc()),$h=$h||Af();let e=[];function r(n){let i=[];for(let{model:s}of n.$__schema.childSchemas){let o=n.$__getValue(s.path);if(o!=null){if(o.$__&&i.push(o),Array.isArray(o))for(let a of o)a!=null&&a.$__&&i.push(a);if(o instanceof Map)for(let a of o.values())a!=null&&a.$__&&i.push(a)}}for(let s of i)r(s);e.push(...i)}return r(this),this.$__.saveOptions&&(this.$__.saveOptions.__subdocs=e),e};function tOe(t){let e=t.$__schema&&t.$__schema.callQueue;if(e.length)for(let r of e)r[0]!=="pre"&&r[0]!=="post"&&r[0]!=="on"&&t[r[0]].apply(t,r[1])}R.prototype.$__handleReject=function(e){this.$listeners("error").length?this.$emit("error",e):this.constructor.listeners&&this.constructor.listeners("error").length&&this.constructor.emit("error",e)};R.prototype.$toObject=function(t,e){let r=this.$__schema._defaultToObjectOptions(e),n=this.$__hasOnlyPrimitiveValues();t=Ae.isPOJO(t)?{...t}:{},t._calledWithOptions=t._calledWithOptions||{...t};let i;t._calledWithOptions.minimize!=null?i=t.minimize:this.$__schemaTypeOptions?.minimize!=null?i=this.$__schemaTypeOptions.minimize:r!=null&&r.minimize!=null?i=r.minimize:i=this.$__schema.options.minimize,t.minimize=i,n||(t._seen=t._seen||new Map);let s=t._calledWithOptions.depopulate??r?.depopulate??t.depopulate??!1;if(s&&t._isNested&&this.$__.wasPopulated)return Ns(this.$__.wasPopulated.value||this._doc._id,t);if(s&&(t.depopulate=!0),r!=null)for(let d of Object.keys(r))t[d]==null&&(t[d]=r[d]);t._isNested=!0,t.json=e,t.minimize=i;let o=t._parentOptions;t._parentOptions=this.$isSubdocument?t:null;let a=t._calledWithOptions.schemaFieldsOnly??t.schemaFieldsOnly??r.schemaFieldsOnly??!1,u;if(n&&!t.flattenObjectIds)u=this.$__toObjectShallow(a);else if(a){u={};for(let d of Object.keys(this.$__schema.paths)){let h=this.$__getValue(d);if(h===void 0)continue;let m=d,g=u;if(d.indexOf(".")!==-1){let b=d.split(".");m=b[b.length-1];for(let _=0;_<b.length-1;++_)g[b[_]]=g[b[_]]??{},g=g[b[_]]}if(h===null){g[m]=null;continue}g[m]=Ns(h,t)}}else u=Ns(this._doc,t)||{};let c=t._calledWithOptions.getters??t.getters??r.getters??!1;c&&(rOe(this,u),t.minimize&&(u=F9e(u)||{}));let l=t._calledWithOptions.virtuals??r.virtuals??o?.virtuals??void 0;(l||c&&l!==!1)&&_x(this,u,t,t),t.versionKey===!1&&this.$__schema.options.versionKey&&delete u[this.$__schema.options.versionKey];let p=t._calledWithOptions.transform??!0,f;if(p===!0?f=r.transform:typeof p=="function"&&(f=p),p&&nOe(this,u),t.useProjection&&iOe(this,u),typeof f=="function"){let d=f(this,u,t);typeof d<"u"&&(u=d)}return u};R.prototype.$__toObjectShallow=function(e){let r={};if(this._doc!=null){let n=Object.keys(e?this.$__schema.paths:this._doc);for(let i of n){let s=this._doc[i];s instanceof Date?r[i]=new Date(s):s!==void 0&&(r[i]=s)}}return r};R.prototype.toObject=function(t){return this.$toObject(t)};function _x(t,e,r,n){let i=t.$__schema,s=i.virtuals,o=Object.keys(s),a=o.length,u=a,c,l,p=t._doc,f,d=typeof(n&&n.aliases)=="boolean"?n.aliases:!0;r=r||{};let h=null;if(Array.isArray(r.virtuals))h=new Set(r.virtuals);else if(r.virtuals&&r.virtuals.pathsToSkip){h=new Set(o);for(let m=0;m<r.virtuals.pathsToSkip.length;m++)h.has(r.virtuals.pathsToSkip[m])&&h.delete(r.virtuals.pathsToSkip[m])}if(!p)return e;for(a=0;a<u;++a){if(c=o[a],h!=null&&!h.has(c)||!d&&Object.hasOwn(i.aliases,c))continue;if(l=c,r.path!=null){if(!c.startsWith(r.path+"."))continue;l=c.substring(r.path.length+1)}if(l.indexOf(".")===-1&&l===c){if(f=s[c].applyGetters(void 0,t),f===void 0)continue;f=Ns(f,r),e[l]=f;continue}let m=l.split(".");if(f=Ns(t.get(c),r),f===void 0)continue;let g=m.length;p=e;for(let b=0;b<g-1;++b)p[m[b]]=p[m[b]]
==> Exited with status 1
==> Common ways to troubleshoot your deploy: https://render.com/docs/troubleshooting-deploys
==> Running 'npm run start'
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.cjs
/opt/render/project/src/dist/index.cjs:97
updatePath: '${n.raw.path}'`);n.trace.add(t);let i=Object.keys(t||{}),s=i.length;r=r||{},e=e?e+".":"";for(let o=0;o<s;++o){let a=i[o],u=t[a],c=e+a;r[c]=!0,!Buffer.isBuffer(u)&&eH(u)&&(u=u.toObject({transform:!1,virtuals:!1})),nH(u)&&rH(u,e+a,r,n)}return n.trace.delete(t),r}function nH(t){return t&&typeof t=="object"&&!(t instanceof Date)&&!XW(t,"ObjectId")&&(!Array.isArray(t)||t.length!==0)&&!(t instanceof Buffer)&&!XW(t,"Decimal128")&&!(t instanceof PSe)}});var Xt=y((Qqe,iH)=>{"use strict";iH.exports=function(e,r,n){let i,s=!1;if(typeof r=="string"){if(r.indexOf(".")===-1){let u=YO(e,r);return u??n}i=r.split(".")}else if(s=!0,i=r,i.length===1){let u=YO(e,i[0]);return u??n}let o=r,a=e;for(let u of i){if(a==null)return n;if(!s&&a[o]!=null)return a[o];a=YO(a,u),s||(o=o.substr(u.length+1))}return a??n};function YO(t,e){return t==null?t:t instanceof Map?t.get(e):t[e]}});var JO=y((Zqe,oH)=>{"use strict";var sH=Zr();oH.exports=function(e,r){return typeof e=="string"&&typeof r=="string"||typeof e=="number"&&typeof r=="number"?e===r:sH(e,"ObjectId")&&sH(r,"ObjectId")?e.toString()===r.toString():!1}});var iE=y((Xqe,aH)=>{"use strict";var FSe=JO();aH.exports=function(e,r){if(e==null||e.discriminators==null)return null;for(let n of Object.keys(e.discriminators)){let i=e.discriminators[n];if(i.discriminatorMapping!=null&&FSe(i.discriminatorMapping.value,r))return i}return null}});var cH=y((eje,uH)=>{"use strict";var ISe=Xt(),NSe=iE();uH.exports=function t(e,r,n){n=n||{};let i=n.typeOnly,s=Array.isArray(r)?r:r.indexOf(".")===-1?[r]:r.split("."),o=null,a="adhocOrUndefined",u=NSe(e.schema,e.get(e.schema.options.discriminatorKey))||e.schema;for(let c=0;c<s.length;++c){let l=s.slice(0,c+1).join(".");if(o=u.path(l),o==null){a="adhocOrUndefined";continue}if(o.instance==="Mixed")return i?"real":o;if(a=u.pathType(l),(o.$isSingleNested||o.$isMongooseDocumentArrayElement)&&o.schema.discriminators!=null){let p=o.schema.discriminators,f=e.get(l+"."+ISe(o,"schema.options.discriminatorKey"));if(f==null||p[f]==null)continue;let d=s.slice(c+1).join(".");return t(e.get(l),d,n)}}return i?a:o}});var pH=y((tje,lH)=>{"use strict";var RSe=Xt();lH.exports=function(e,r,n){let i=n!=null?Object.keys(RSe(e.tree,n,{})):Object.keys(e.tree),s=new Set(Object.keys(r)),o;if(s.size>1){o=new Set;for(let a of i)s.has(a)&&o.add(a);for(let a of s)o.has(a)||o.add(a);o=Array.from(o)}else o=Array.from(s);return o}});var dH=y((rje,fH)=>{"use strict";fH.exports=function(e,r){if(r.length===1)return;let n=r[0],i;for(let s=0;s<r.length-1;++s){let o=e.path(n);o&&o.schema?(i=o.schema.options.strict,e=o.schema,n=o.$isMongooseDocumentArray&&!isNaN(r[s+1])?"":r[s+1]):n+=n.length?"."+r[s+1]:r[s+1]}return i}});var sE=y((nje,hH)=>{"use strict";var $Se=ge(),qSe=new Set(["__index","__parentArray","_doc"]);hH.exports=function(e,r){if($Se.isPOJO(e)&&e.$__!=null&&e._doc!=null){if(r){let n={};for(let i of Object.keys(e))typeof i!="symbol"&&i[0]!=="$"&&(qSe.has(i)||(n[i]=e[i]));return{...e._doc,...n}}return e._doc}return e}});var vf=y((ije,mH)=>{"use strict";mH.exports=function(e){return e==null?!0:typeof e=="object"?!("$meta"in e)&&!("$slice"in e):!0}});var wf=y((sje,yH)=>{"use strict";var jSe=vf(),LSe=hf();yH.exports=function t(e){if(e==null)return null;let r=Object.keys(e),n=null;if(r.length===1&&r[0]==="_id")n=!e._id;else for(let i=0;i<r.length;++i){let s=r[i];if(s!=="_id"&&jSe(e[s])&&(n=LSe(e[s])?t(e[s])??n:!e[s],n!=null))break}return n}});var QO=y((oje,gH)=>{"use strict";var USe=vf();gH.exports=function(e,r){if(e==null)return!1;if(r==="_id")return e._id===0;let n=Object.keys(e),i=null;for(let s of n)if(USe(e[s])){i=e[r]===1?"inclusive":"exclusive";break}return i==="inclusive"?e[r]!==1:i==="exclusive"?e[r]===0:!1}});var ZO=y((aje,bH)=>{"use strict";var zSe=ge();bH.exports=function(e,r){if(e._doc._id==null||r==null||r.length===0)return;let n=String(e._doc._id);for(let i of r){if(i.isVirtual)continue;let o=i.path.split(".");for(let a=0;a<o.length-1;++a){let u=o.slice(0,a+1).join("."),c=o.slice(a+1).join("."),l=e.get(u);if(l!=null&&zSe.isMongooseDocumentArray(l)){for(let p=0;p<l.length;++p)l[p]&&l[p].populated(c,i._docs[n]==null?void 0:i._docs[n][p],i);break}}}}});var XO=y((uje,_H)=>{"use strict";var{isPOJO:VSe}=ge();_H.exports=EH;function EH(t){let e=Object.keys(t),r=e.length,n,i,s;for(;r--;){if(i=e[r],s=t[i],VSe(s)&&(t[i]=EH(s)),t[i]===void 0){delete t[i];continue}n=!0}return n?t:void 0}});var ex=y((cje,vH)=>{"use strict";var WSe=/\./g;vH.exports=function(e){if(e.indexOf(".")===-1)return[e];let r=e.split(WSe),n=r.length,i=new Array(n),s="";for(let o=0;o<n;++o)s+=s.length!==0?"."+r[o]:r[o],i[o]=s;return i}});var AH=y((lje,wH)=>{"use strict";wH.exports=function(e,r,n,i,s){let o=Object.keys(e).reduce((u,c)=>u||c.startsWith(r+"."),!1),a=r+"."+n.options.discriminatorKey;!o&&s.length===1&&s[0]===a&&i.splice(i.indexOf(a),1)}});var ts=y((pje,SH)=>{"use strict";var HSe=JO();SH.exports=function(e,r){if(e==null)return null;for(let n of Object.keys(e)){let i=e[n];if(i.schema&&i.schema.discriminatorMapping&&HSe(i.schema.discriminatorMapping.value,r))return i}return null}});var oE=y((fje,OH)=>{"use strict";OH.exports=function(e,r){let n=r.split("."),i="",s,o,a;for(let u=0;u<n.length;++u)if(i+=i.length?".":""+n[u],e[i]){for(o=Object.keys(e),a=o.length,s=0;s<a;++s)o[u].indexOf(i+".")===0&&o[u].indexOf(r);return!0}return!1}});var Ih=y(Pc=>{"use strict";var xH=UO(),GSe=AH(),CH=Xt(),KSe=ts(),YSe=vf(),JSe=zt(),QSe=oE();Pc.preparePopulationOptionsMQ=function(e,r){let n=e._mongooseOptions.populate,i=Object.keys(n).reduce((a,u)=>a.concat([n[u]]),[]);r.lean!=null&&i.filter(a=>(a&&a.options&&a.options.lean)==null).forEach(ZSe(r.lean));let s=e&&e.options&&e.options.session||null;s!=null&&i.forEach(a=>{if(a.options==null){a.options={session:s};return}"session"in a.options||(a.options.session=s)});let o=e._fieldsForExec();for(let a=0;a<i.length;++a)i[a]instanceof xH?i[a]=new xH({...i[a],_queryProjection:o,_localModel:e.model}):(i[a]._queryProjection=o,i[a]._localModel=e.model);return i};Pc.createModel=function(e,r,n,i,s){e.hooks.execPreSync("createModel",r);let o=e.schema?e.schema.discriminatorMapping:null,a=o&&o.isRoot?o.key:null,u=r[a];if(a&&u&&e.discriminators){let l=e.discriminators[u]||KSe(e.discriminators,u);if(l){let p=JSe(i);return Pc.applyPaths(p,l.schema),new l(void 0,p,{skipId:!0})}}let c={skipId:!0,isNew:!1,willInit:!0};return s!=null&&"defaults"in s&&(c.defaults=s.defaults),new e(void 0,n,c)};Pc.createModelAndInit=function(e,r,n,i,s,o,a){let u=o?{populated:o}:void 0,c=Pc.createModel(e,r,n,i,s);try{c.$init(r,u,a)}catch(l){a(l,c)}};Pc.applyPaths=function(e,r,n){let i,s,o=new Set;if(e){s=Object.keys(e);let f=[];for(let d=0;d<s.length;++d){let h=s[d];s[d][0]==="-"&&(delete e[h],h==="-_id"?e._id=0:f.push(h.slice(1)))}s=Object.keys(e);for(let d=0;d<s.length;++d){if(s[d][0]==="+")continue;let h=e[s[d]];if(YSe(h)&&!(s[d]==="_id"&&s.length>1)&&!(s[d]===r.options.discriminatorKey&&s.length>1&&h!=null&&!h)){i=!h;break}}for(let d of f){let h=r.path(d);!h||!h.selected||i!==!1?(e[d]=0,i=!0):h&&h.selected&&i===!1&&o.add(d)}}let a=[],u=[],c=[];switch(l(r),i){case!0:for(let f of u)e[f]=0;break;case!1:r&&r.paths._id&&r.paths._id.options&&r.paths._id.options.select===!1&&(e._id=0);for(let f of a)o.has(f)||QSe(e,f)||(e[f]=e[f]||1);break;case void 0:if(e==null)break;for(let f of Object.keys(e||{}))f.startsWith("+")&&delete e[f];for(let f of u)e[f]==null&&(e[f]=0);break}function l(f,d){if(d||(d=""),c.indexOf(f)!==-1)return[];c.push(f);let h=[];return f.eachPath(function(m,g){if(d&&(m=d+"."+m),g.$isSchemaMap||m.endsWith(".$*")){let _="+"+m,w=e&&_ in e;g.options&&g.options.select===!1&&!w&&u.push(m);return}let b=p(m,g);if(b==null&&!Array.isArray(g)&&g.$isMongooseArray&&!g.$isMongooseDocumentArray&&(b=p(m,g.embeddedSchemaType)),b!=null&&h.push(b),g.schema){let _=l(g.schema,m);i===!1&&GSe(e,m,g.schema,a,_)}}),c.pop(),h}function p(f,d){if(e==null||typeof d.selected!="boolean")return;if(d.selected===!1&&e[f]){n&&(e[f]=0);return}if(!i&&d.selected&&f===r.options.discriminatorKey&&e[f]!=null&&!e[f]){delete e[f];return}if(i===!1&&d.selected&&e[f]!=null&&!e[f]){delete e[f];return}let h="+"+f;if(e&&h in e){delete e[h],i===!1&&s.length>1&&!~s.indexOf(f)&&!n?e[f]=1:i==null&&n&&d.selected===!1&&(e[f]=0);return}let g=f.split("."),b="";for(let _=0;_<g.length;++_)if(b+=b.length?"."+g[_]:g[_],u.indexOf(b)!==-1)return;if(!i&&(d&&d.options&&d.options.$skipDiscriminatorCheck)){let _="";for(let w=0;w<g.length;++w){_+=(_.length===0?"":".")+g[w];let E=CH(e,_,!1)||CH(e,_+".$",!1);if(E&&typeof E!="object")return}}return(d.selected?a:u).push(f),f}};function ZSe(t){return function(e){e.options||(e.options={}),t!=null&&Array.isArray(t.virtuals)&&(t=Object.assign({},t),t.virtuals=t.virtuals.filter(r=>typeof r=="string"&&r.startsWith(e.path+".")).map(r=>r.slice(e.path.length+1))),e.options.lean=t}}});var tx=y((hje,TH)=>{"use strict";function XSe(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}TH.exports=XSe});var MH=y((mje,DH)=>{"use strict";DH.exports=function(e,r,n){let i=r[0],s=n,o=e;for(let a=0;a<r.length-1;++a){let u=s.path(i);if(u&&u.schema){let c=o.get(i);if(s=u.schema,i=r[a+1],Array.isArray(c)&&!isNaN(i)&&(c=c[i],i=""),c==null)break;o=c}else i+=i.length?"."+r[a+1]:r[a+1]}return o}});var aE=y((yje,BH)=>{"use strict";var Go=po(),e9e=Fs().internalToObjectOptions,PH=require("util"),t9e=ge();BH.exports=_t;function _t(t,e,r,n){if(r!=null){let s={isNew:r.isNew};"defaults"in r.$__&&(s.defaults=r.$__.defaults),n=Object.assign(s,n)}n!=null&&n.path!=null&&(this.$basePath=n.path),n!=null&&n.pathRelativeToParent!=null&&(this.$pathRelativeToParent=n.pathRelativeToParent);let i=n;n!=null&&n.path!=null&&(i=Object.assign({},n),delete i.path),Go.call(this,t,e,i),delete this.$__.priorDoc}_t.prototype=Object.create(Go.prototype);Object.defineProperty(_t.prototype,"$isSubdocument",{configurable:!1,writable:!1,value:!0});Object.defineProperty(_t.prototype,"$isSingleNested",{configurable:!1,writable:!1,value:!0});_t.prototype.toBSON=function(){return this.toObject(e9e)};_t.prototype.save=async function(e){return e=e||{},e.suppressWarning||t9e.warn("mongoose: calling `save()` on a subdoc does **not** save the document to MongoDB, it only runs save middleware. Use `subdoc.save({ suppressWarning: true })` to hide this warning if you're sure this behavior is right for your app."),await this.$__save()};_t.prototype.$__fullPath=function(t){return this.$__.fullPath||this.ownerDocument(),t?this.$__.fullPath+"."+t:this.$__.fullPath};_t.prototype.$__pathRelativeToParent=function(t){return this.$pathRelativeToParent!=null?t==null?this.$pathRelativeToParent:this.$pathRelativeToParent+"."+t:t==null?this.$basePath:this.$basePath?[this.$basePath,t].join("."):t};_t.prototype.$__save=async function(){try{await this._execDocumentPreHooks("save")}catch(e){await this._execDocumentPostHooks("save",e);return}await this._execDocumentPostHooks("save")};_t.prototype.$isValid=function(t){let e=this.$parent(),r=this.$__pathRelativeToParent(t);return e!=null&&r!=null?e.$isValid(r):Go.prototype.$isValid.call(this,t)};_t.prototype.markModified=function(t){Go.prototype.markModified.call(this,t);let e=this.$parent();if(e==null)return;let r=this.$__pathRelativeToParent(t);if(r==null)return;let n=this.$__pathRelativeToParent().replace(/\.$/,"");e.isDirectModified(n)||this.isNew||this.$__parent.markModified(r,this)};_t.prototype.isModified=function(t,e,r){let n=this.$parent();return n!=null?(Array.isArray(t)||typeof t=="string"?(t=Array.isArray(t)?t:t.split(" "),t=t.map(i=>this.$__pathRelativeToParent(i)).filter(i=>i!=null)):t||(t=this.$__pathRelativeToParent()),n.$isModified(t,e,r)):Go.prototype.isModified.call(this,t,e,r)};_t.prototype.$markValid=function(t){Go.prototype.$markValid.call(this,t);let e=this.$parent(),r=this.$__pathRelativeToParent(t);e!=null&&r!=null&&e.$markValid(r)};_t.prototype.invalidate=function(t,e,r){Go.prototype.invalidate.call(this,t,e,r);let n=this.$parent(),i=this.$__pathRelativeToParent(t);if(n!=null&&i!=null)n.invalidate(i,e,r);else if(e.kind==="cast"||e.name==="CastError"||i==null)throw e;return this.ownerDocument().$__.validationError};_t.prototype.$ignore=function(t){Go.prototype.$ignore.call(this,t);let e=this.$parent(),r=this.$__pathRelativeToParent(t);e!=null&&r!=null&&e.$ignore(r)};_t.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;let t=this,e=[],r=new Set([t]);for(;typeof t.$__pathRelativeToParent=="function";){e.unshift(t.$__pathRelativeToParent(void 0,!0));let n=t.$parent();if(n==null)break;if(t=n,r.has(t))throw new Error("Infinite subdocument loop: subdoc with _id "+t._id+" is a parent of itself");r.add(t)}return this.$__.fullPath=e.join("."),this.$__.ownerDocument=t,this.$__.ownerDocument};_t.prototype.$__fullPathWithIndexes=function(){let t=this,e=[],r=new Set([t]);for(;typeof t.$__pathRelativeToParent=="function";){e.unshift(t.$__pathRelativeToParent(void 0,!1));let n=t.$parent();if(n==null)break;if(t=n,r.has(t))throw new Error("Infinite subdocument loop: subdoc with _id "+t._id+" is a parent of itself");r.add(t)}return e.join(".")};_t.prototype.parent=function(){return this.$__parent};_t.prototype.$parent=_t.prototype.parent;_t.prototype.$__removeFromParent=function(){this.$__parent.set(this.$basePath,null)};_t.prototype.deleteOne=function(e){if(r9e(this),!e||!e.noop){this.$__removeFromParent();let r=this.ownerDocument();r.$__.removedSubdocs=r.$__.removedSubdocs||[],r.$__.removedSubdocs.push(this)}};_t.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.nested.populate("path")`, use `doc.populate("nested.path")`')};_t.prototype.inspect=function(){return this.toObject()};PH.inspect.custom&&(_t.prototype[PH.inspect.custom]=_t.prototype.inspect);_t.prototype.$toObject=function(e,r){let n=Go.prototype.$toObject.call(this,e,r);if(!(Object.keys(n).length===0&&e?._calledWithOptions!=null&&(e._calledWithOptions?.minimize??this?.$__schemaTypeOptions?.minimize??e.minimize)&&!this.constructor.$__required))return n};function r9e(t){let e=t.ownerDocument();function r(){e.$removeListener("save",r),e.$removeListener("deleteOne",r),t.emit("deleteOne",t),t.constructor.emit("deleteOne",t)}e.$on("save",r),e.$on("deleteOne",r)}});var Af=y((gje,IH)=>{"use strict";var kH=require("events").EventEmitter,FH=aE(),n9e=ge(),Nh=oe().documentArrayParent;function ri(t,e,r,n,i){n9e.isMongooseDocumentArray(e)?(this.__parentArray=e,this[Nh]=e.$parent()):(this.__parentArray=void 0,this[Nh]=void 0),this.$setIndex(i),this.$__parent=this[Nh];let s;typeof r=="object"&&r!=null?(s={isNew:!0,...r},r=void 0):s={isNew:!0},FH.call(this,t,n,this[Nh],s)}ri.prototype=Object.create(FH.prototype);ri.prototype.constructor=ri;Object.defineProperty(ri.prototype,"$isSingleNested",{configurable:!1,writable:!1,value:!1});Object.defineProperty(ri.prototype,"$isDocumentArrayElement",{configurable:!1,writable:!1,value:!0});for(let t in kH.prototype)ri[t]=kH.prototype[t];ri.prototype.$setIndex=function(t){if(this.__index=t,this.$__!=null&&this.$__.validationError!=null){let e=Object.keys(this.$__.validationError.errors);for(let r of e)this.invalidate(r,this.$__.validationError.errors[r])}};ri.prototype.populate=function(){throw new Error('Mongoose does not support calling populate() on nested docs. Instead of `doc.arr[0].populate("path")`, use `doc.populate("arr.0.path")`')};ri.prototype.$__removeFromParent=function(){let t=this._doc._id;if(!t)throw new Error("For your own good, Mongoose does not know how to remove an ArraySubdocument that has no _id");this.__parentArray.pull({_id:t})};ri.prototype.$__fullPath=function(t,e){return this.__index==null?null:(this.$__.fullPath||this.ownerDocument(),e?t?this.$__.fullPath+"."+t:this.$__.fullPath:t?this.$__.fullPath+"."+this.__index+"."+t:this.$__.fullPath+"."+this.__index)};ri.prototype.$__pathRelativeToParent=function(t,e){return this.__index==null||!this.__parentArray||!this.__parentArray.$path?null:e?t==null?this.__parentArray.$path():this.__parentArray.$path()+"."+t:t==null?this.__parentArray.$path()+"."+this.__index:this.__parentArray.$path()+"."+this.__index+"."+t};ri.prototype.$parent=function(){return this[Nh]};ri.prototype.parentArray=function(){return this.__parentArray};IH.exports=ri});var lE=y((bje,zH)=>{"use strict";var ix=po(),rx=Af(),i9e=Ce(),NH=eE(),s9e=zt(),RH=Fs().internalToObjectOptions,jH=Ti(),gn=ge(),nx=Zr(),Ko=oe().arrayAtomicsSymbol,au=oe().arrayParentSymbol,uu=oe().arrayPathSymbol,Yo=oe().arraySchemaSymbol,LH=oe().populateModelSymbol,o9e=Symbol("mongoose#Array#sliced"),$H=Array.prototype.push;var cE={$__getAtomics(){let t=[],e=Object.keys(this[Ko]||{}),r=e.length,n=Object.assign({},RH,{_isNested:!0});if(r===0)return t[0]=["$set",this.toObject(n)],t;for(;r--;){let i=e[r],s=this[Ko][i];gn.isMongooseObject(s)?s=s.toObject(n):Array.isArray(s)?s=this.toObject.call(s,n):s!=null&&Array.isArray(s.$each)?s.$each=this.toObject.call(s.$each,n):s!=null&&typeof s.valueOf=="function"&&(s=s.valueOf()),i==="$addToSet"&&(s={$each:s}),t.push([i,s])}return t},$atomics(){return this[Ko]},$parent(){return this[au]},$path(){return this[uu]},$schemaType(){return this[Yo]},$shift(){this._registerAtomic("$pop",-1),this._markModified();let t=this.__array;if(!t._shifted)return t._shifted=!0,[].shift.call(t)},$pop(){if(this._registerAtomic("$pop",1),this._markModified(),!this._popped)return this._popped=!0,[].pop.call(this)},$schema(){return this[Yo]},_cast(t){let e=!1,r,n=this[au];if(n&&(e=n.$populated(this[uu],!0)),e&&t!==null&&t!==void 0){if(r=e.options[LH],r==null)throw new i9e("No populated model found for path `"+this[uu]+"`. This is likely a bug in Mongoose, please report an issue on github.com/Automattic/mongoose.");return(Buffer.isBuffer(t)||nx(t,"ObjectId")||!gn.isObject(t))&&(t={_id:t}),t.schema&&t.schema.discriminatorMapping&&t.schema.discriminatorMapping.key!==void 0||(t=new r(t)),this[Yo].embeddedSchemaType.applySetters(t,n,!0)}return this[Yo].embeddedSchemaType.applySetters(t,n,!1)},_mapCast(t,e){return this._cast(t,this.length+e)},_markModified(t){let e=this[au],r;if(e){if(r=this[uu],arguments.length&&(r=r+"."+t),r!=null&&r.endsWith(".$"))return this;e.markModified(r,arguments.length!==0?t:e)}return this},_registerAtomic(t,e){if(this[o9e])return;if(t==="$set")return this[Ko]={$set:e},NH(this[au],this[uu]),this._markModified(),this;let r=this[Ko];if(t==="$pop"&&!("$pop"in r)){let i=this;this[au].once("save",function(){i._popped=i._shifted=null})}if(r.$set||Object.keys(r).length&&!(t in r))return this[Ko]={$set:this},this;let n;if(t==="$pullAll"||t==="$addToSet")r[t]||(r[t]=[]),r[t]=r[t].concat(e);else if(t==="$pullDocs"){let i=r.$pull||(r.$pull={});e[0]instanceof rx?(n=i.$or||(i.$or=[]),Array.prototype.push.apply(n,e.map(s=>s.toObject({transform:(o,a)=>(s==null||s.$__==null||Object.keys(s.$__.activePaths.getStatePaths("default")).forEach(u=>{jH.unset(u,a),UH(a,u)}),a),virtuals:!1})))):(n=i._id||(i._id={$in:[]}),n.$in=n.$in.concat(e))}else if(t==="$push")if(r.$push=r.$push||{$each:[]},e!=null&&gn.hasUserDefinedProperty(e,"$each"))r.$push=e;else if(e.length===1)r.$push.$each.push(e[0]);else if(e.length<1e4)r.$push.$each.push(...e);else for(let i of e)r.$push.$each.push(i);else r[t]=e;return this},addToSet(){uE(this,arguments),qH(this,arguments);let t=[].map.call(arguments,this._mapCast,this),e=[],r="";t[0]instanceof rx?r="doc":t[0]instanceof Date?r="date":nx(t[0],"ObjectId")&&(r="ObjectId");let n=gn.isMongooseArray(t)?t.__array:t,i=gn.isMongooseArray(this)?this.__array:this;return n.forEach(function(s){let o,a=+s;switch(r){case"doc":o=this.some(function(u){return u.equals(s)});break;case"date":o=this.some(function(u){return+u===a});break;case"ObjectId":o=this.find(u=>u.toString()===s.toString());break;default:o=~this.indexOf(s);break}o||(this._markModified(),i.push(s),this._registerAtomic("$addToSet",s),[].push.call(e,s))},this),e},hasAtomics(){return gn.isPOJO(this[Ko])?Object.keys(this[Ko]).length:0},includes(t,e){return this.indexOf(t,e)!==-1},indexOf(t,e){nx(t,"ObjectId")&&(t=t.toString()),e=e??0;let r=this.length;for(let n=e;n<r;++n)if(t==this[n])return n;return-1},inspect(){return JSON.stringify(this)},nonAtomicPush(){let t=[].map.call(arguments,this._mapCast,this);this._markModified();let e=[].push.apply(this,t);return this._registerAtomic("$set",this),e},pop(){this._markModified();let t=[].pop.call(this);return this._registerAtomic("$set",this),t},pull(){let t=[].map.call(arguments,(i,s)=>this._cast(i,s,{defaults:!1}),this),e=this;gn.isMongooseArray(e)&&(e=e.__array);let r=e.length,n;for(this._markModified();r--;)n=e[r],n instanceof ix?t.some(function(s){return n.equals(s)})&&e.splice(r,1):~this.indexOf.call(t,n)&&e.splice(r,1);return t[0]instanceof rx?this._registerAtomic("$pullDocs",t.map(function(i){let s=i.$__getValue("_id");return s===void 0||i.$isDefault("_id")?i:s})):this._registerAtomic("$pullAll",t),NH(this[au],this[uu])>0&&this._registerAtomic("$set",this),this},push(){let t=arguments,e=t,r=t[0]!=null&&gn.hasUserDefinedProperty(t[0],"$each"),n=gn.isMongooseArray(this)?this.__array:this;if(r&&(e=t[0],t=t[0].$each),this[Yo]==null)return $H.apply(this,t);uE(this,t),qH(this,t),t=[].map.call(t,this._mapCast,this);let i,s=this[Ko];return this._markModified(),r?(e.$each=t,(s.$push&&s.$push.$each&&s.$push.$each.length||0)!==0&&s.$push.$position!=e.$position?(e.$position!=null?([].splice.apply(n,[e.$position,0].concat(t)),i=n.length):i=[].push.apply(n,t),this._registerAtomic("$set",this)):e.$position!=null?([].splice.apply(n,[e.$position,0].concat(t)),i=this.length):i=[].push.apply(n,t)):(e=t,i=$H.apply(n,t)),this._registerAtomic("$push",e),i},remove(){return this.pull.apply(this,arguments)},set(t,e,r){let n=this.__array;if(r)return n[t]=e,this;let i=cE._cast.call(this,e,t);return cE._markModified.call(this,t),n[t]=i,this},shift(){let t=gn.isMongooseArray(this)?this.__array:this;this._markModified();let e=[].shift.call(t);return this._registerAtomic("$set",this),e},sort(){let t=gn.isMongooseArray(this)?this.__array:this,e=[].sort.apply(t,arguments);return this._registerAtomic("$set",this),e},splice(){let t,e=gn.isMongooseArray(this)?this.__array:this;if(this._markModified(),uE(this,Array.prototype.slice.call(arguments,2)),arguments.length){let r;if(this[Yo]==null)r=arguments;else{r=[];for(let n=0;n<arguments.length;++n)r[n]=n<2?arguments[n]:this._cast(arguments[n],arguments[0]+(n-2))}t=[].splice.apply(e,r),this._registerAtomic("$set",this)}return t},toBSON(){return this.toObject(RH)},toObject(t){let e=gn.isMongooseArray(this)?this.__array:this;return t&&t.depopulate?(t=s9e(t),t._isNested=!0,[].concat(e).map(function(r){return r instanceof ix?r.toObject(t):r})):[].concat(e)},$toObject(){return this.constructor.prototype.toObject.apply(this,arguments)},unshift(){uE(this,arguments);let t;this[Yo]==null?t=arguments:t=[].map.call(arguments,this._cast,this);let e=gn.isMongooseArray(this)?this.__array:this;return this._markModified(),[].unshift.apply(e,t),this._registerAtomic("$set",this),this.length}};function a9e(t,e){if(!e)return!1;for(let r of t){if(r==null)return!1;let n=r.constructor;if(!(r instanceof ix)||n.modelName!==e&&n.baseModelName!==e)return!1}return!0}function UH(t,e,r){if(typeof e=="string"){if(e.indexOf(".")===-1)return;e=jH.stringToParts(e)}r=r||0,!(r>=e.length)&&(t==null||typeof t!="object"||(UH(t[e[0]],e,r+1),t[e[0]]!=null&&typeof t[e[0]]=="object"&&Object.keys(t[e[0]]).length===0&&delete t[e[0]]))}function uE(t,e){let r=t==null?null:t[Yo]?.embeddedSchemaType?.options?.ref||null;t.length===0&&e.length!==0&&a9e(e,r)&&t[au].$populated(t[uu],[],{[LH]:e[0].constructor})}function qH(t,e){let r=t==null?null:t[Yo]?.embeddedSchemaType?.options?.ref||null,n=t[au],i=t[uu];if(!(!r||!n.populated(i))){for(let s of e)if(s!=null&&(typeof s!="object"||s instanceof String||s instanceof Number||s instanceof Buffer||gn.isMongooseType(s))){n.depopulate(i);break}}}var u9e=["filter","flat","flatMap","map","slice"];for(let t of u9e)Array.prototype[t]!=null&&(cE[t]=function(){let e=gn.isMongooseArray(this)?this.__array:this,r=[].concat(e);return r[t].apply(r,arguments)});zH.exports=cE});var ox=y((KH,YH)=>{"use strict";var sx=lE(),pE=oe().arrayAtomicsSymbol,c9e=oe().arrayAtomicsBackupSymbol,VH=oe().arrayParentSymbol,l9e=oe().arrayPathSymbol,WH=oe().arraySchemaSymbol,HH=Array.prototype.push,GH=/^\d+$/;function p9e(t,e,r,n){let i;if(Array.isArray(t)){let a=t.length;if(a===0)i=new Array;else if(a===1)i=new Array(1),i[0]=t[0];else if(a<1e4)i=new Array,HH.apply(i,t);else{i=new Array;for(let u=0;u<a;++u)HH.call(i,t[u])}}else i=[];let s={[pE]:{},[c9e]:void 0,[l9e]:e,[WH]:n,[VH]:void 0,isMongooseArray:!0,isMongooseArrayProxy:!0,__array:i};t&&t[pE]!=null&&(s[pE]=t[pE]),r!=null&&r.$__&&(s[VH]=r,s[WH]=n||r.schema.path(e));let o=new Proxy(i,{get:function(a,u){return Object.hasOwn(s,u)?s[u]:Object.hasOwn(sx,u)?sx[u]:n&&n.virtuals&&Object.hasOwn(n.virtuals,u)?n.virtuals[u].applyGetters(void 0,a):typeof u=="string"&&GH.test(u)&&n?.embeddedSchemaType!=null?n.embeddedSchemaType.applyGetters(i[u],r):i[u]},set:function(a,u,c){return typeof u=="string"&&GH.test(u)?sx.set.call(o,u,c,!1):Object.hasOwn(s,u)?s[u]=c:n?.virtuals&&Object.hasOwn(n.virtuals,u)?n.virtuals[u].applySetters(c,a):i[u]=c,!0}});return o}YH.exports=KH=p9e});var XH=y((Eje,ZH)=>{"use strict";var fE=lE(),f9e=po(),JH=ts(),d9e=Fs().internalToObjectOptions,Bc=ge(),h9e=Zr(),hE=oe().arrayParentSymbol,ax=oe().arrayPathSymbol,Rh=oe().arraySchemaSymbol,QH=oe().documentArrayParent,m9e=Array.prototype.toString,ux={toBSON(){return this.toObject(d9e)},toString(){return m9e.call(this.__array.map(t=>t!=null&&t.$__!=null?t.toString():t))},getArrayParent(){return this[hE]},$schemaType(){return this[Rh]},_cast(t,e,r){if(this[Rh]==null)return t;let n=this[Rh].Constructor;if((n.$isMongooseDocumentArray?Bc.isMongooseDocumentArray(t):t instanceof n)||t&&t.constructor&&t.constructor.baseCasterConstructor===n)return t[QH]&&t.__parentArray||(t[QH]=this[hE],t.__parentArray=this),t.$setIndex(e),t;if(t==null)return null;if((Buffer.isBuffer(t)||h9e(t,"ObjectId")||!Bc.isObject(t))&&(t={_id:t}),t&&n.discriminators&&n.schema&&n.schema.options&&n.schema.options.discriminatorKey)if(typeof t[n.schema.options.discriminatorKey]=="string"&&n.discriminators[t[n.schema.options.discriminatorKey]])n=n.discriminators[t[n.schema.options.discriminatorKey]];else{let o=JH(n.discriminators,t[n.schema.options.discriminatorKey]);o&&(n=o)}if(n.$isMongooseDocumentArray)return n.cast(t,this,void 0,void 0,e);let s=new n(t,this,r,void 0,e);return s.isNew=!0,s},id(t){if(t==null)return null;let e=this[Rh],r=null;e&&e.schema?r=e.schema.path("_id"):e&&e.casterConstructor&&e.casterConstructor.schema&&(r=e.casterConstructor.schema.path("_id"));let n=null;if(r)try{n=r.cast(t)}catch{}let i;for(let s of this)if(s&&(i=s.get("_id"),i!=null))if(i instanceof f9e){if(i=i.get("_id"),n!=null&&Bc.deepEqual(n,i))return s;if(n==null&&(t==i||Bc.deepEqual(t,i)))return s}else{if(n!=null&&Bc.deepEqual(n,i))return s;if(n==null&&(i==t||Bc.deepEqual(t,i)))return s}return null},toObject(t){return[].concat(this.map(function(e){return e==null?null:typeof e.toObject!="function"?e:e.toObject(t)}))},$toObject(){return this.constructor.prototype.toObject.apply(this,arguments)},push(){let t=fE.push.apply(this,arguments);return dE(this),t},pull(){let t=fE.pull.apply(this,arguments);return dE(this),t},shift(){let t=fE.shift.apply(this,arguments);return dE(this),t},splice(){let t=fE.splice.apply(this,arguments);return dE(this),t},inspect(){return this.toObject()},create(t){let e=this[Rh].Constructor;if(t&&e.discriminators&&e.schema&&e.schema.options&&e.schema.options.discriminatorKey)if(typeof t[e.schema.options.discriminatorKey]=="string"&&e.discriminators[t[e.schema.options.discriminatorKey]])e=e.discriminators[t[e.schema.options.discriminatorKey]];else{let r=JH(e.discriminators,t[e.schema.options.discriminatorKey]);r&&(e=r)}return new e(t,this)},notify(t){let e=this;return function r(n,i){i=i||e;let s=i.length;for(;s--;)if(i[s]!=null){switch(t){case"save":n=e[s];break;default:break}Bc.isMongooseArray(i[s])?r(n,i[s]):i[s]&&i[s].emit(t,n)}}},set(t,e,r){let n=this.__array;if(r)return n[t]=e,this;let i=ux._cast.call(this,e,t);return ux._markModified.call(this,t),n[t]=i,this},_markModified(t,e){let r=this[hE],n;if(r){if(n=this[ax],arguments.length)if(e!=null){let i=t.__index;n=n+"."+i+"."+e}else n=n+"."+t;if(n!=null&&n.endsWith(".$"))return this;r.markModified(n,arguments.length!==0?t:r)}return this}};ZH.exports=ux;function dE(t){let e=t[hE];if(!e||e.$__.populated==null)return;let r=Object.keys(e.$__.populated).filter(n=>n.startsWith(t[ax]+"."));for(let n of r){let i=n.slice((t[ax]+".").length);Array.isArray(e.$__.populated[n].value)&&(e.$__.populated[n].value=t.map(s=>s.$populated(i)))}}});var Fc=y((_je,tG)=>{"use strict";var eG=lE(),cx=XH(),lx=oe().arrayAtomicsSymbol,y9e=oe().arrayAtomicsBackupSymbol,px=oe().arrayParentSymbol,fx=oe().arrayPathSymbol,kc=oe().arraySchemaSymbol,g9e=Array.prototype.push,b9e=/^\d+$/;function E9e(t,e,r,n){let i=[],s={[lx]:{},[y9e]:void 0,[fx]:e,[kc]:void 0,[px]:void 0};if(Array.isArray(t)&&(t[fx]===e&&t[px]===r&&(s[lx]=Object.assign({},t[lx])),t.forEach(a=>{g9e.call(i,a)})),s[fx]=e,s.__array=i,r&&r.$__)for(s[px]=r,s[kc]=r.$__schema.path(e);s[kc]!=null&&s[kc].$isMongooseArray&&!s[kc].$isMongooseDocumentArray;)s[kc]=s[kc].embeddedSchemaType;let o=new Proxy(i,{get:function(a,u){return u==="isMongooseArray"||u==="isMongooseArrayProxy"||u==="isMongooseDocumentArray"||u==="isMongooseDocumentArrayProxy"?!0:Object.hasOwn(s,u)?s[u]:Object.hasOwn(cx,u)?cx[u]:n&&n.virtuals&&Object.hasOwn(n.virtuals,u)?n.virtuals[u].applyGetters(void 0,a):Object.hasOwn(eG,u)?eG[u]:i[u]},set:function(a,u,c){return typeof u=="string"&&b9e.test(u)?cx.set.call(o,u,c,!1):Object.hasOwn(s,u)?s[u]=c:n?.virtuals&&Object.hasOwn(n.virtuals,u)?n.virtuals[u].applySetters(c,a):i[u]=c,!0}});return o}tG.exports=E9e});var po=y((EG,_G)=>{"use strict";var _9e=$O(),hx=require("events").EventEmitter,v9e=PW(),w9e=Hb(),ni=xi(),rG=Ef(),A9e=RW(),cG=Yb(),bx=Qb(),S9e=LW(),O9e=Nc(),mx=ou(),EE=Dc(),lG=BO(),pG=WO(),yx=Xb(),mE=eE(),Ns=zt(),x9e=rE().compile,C9e=rE().defineKey,T9e=ZW(),D9e=nE().flatten,dx=cH(),nG=pH(),M9e=dH(),P9e=sE(),iG=Zr(),fG=vf(),B9e=wf(),sG=QO(),gx=require("util").inspect,dG=Fs().internalToObjectOptions,k9e=ZO(),F9e=XO(),I9e=Ti(),Ex=ex(),N9e=Ih(),Ae=ge(),R9e=tx(),gE=Ae.deepEqual,$9e=Ae.isMongooseObject,qh=oe().arrayAtomicsBackupSymbol,Rn=oe().arrayAtomicsSymbol,q9e=oe().documentArrayParent,j9e=oe().documentIsModified,hG=oe().documentModifiedPaths,L9e=oe().documentSchemaSymbol,U9e=oe().getSymbol,z9e=oe().modelSymbol,oG=oe().populateModelSymbol,V9e=oe().scopeSymbol,W9e=Mc().schemaMixedSymbol,H9e=MH(),yE=oe().sessionNewDocuments,bE,aG,$h,mG=Ae.specialProperties,jh=1,Ic=2,Jo=jh|Ic;function R(t,e,r){if(typeof r=="boolean")throw new Error("The skipId parameter has been removed. Use { skipId: true } in the options parameter instead.");r=Object.assign({},r);let n=r.skipId;if(this.$__=new v9e,this.$__schema==null){let c=Ae.isObject(e)&&!e.instanceOfSchema?new O9e(e):e;this.$__setSchema(c),e=r,n=r.skipId}if(r.isNew!=null&&r.isNew!==!0&&(this.$isNew=r.isNew),r.priorDoc!=null&&(this.$__.priorDoc=r.priorDoc),n&&(this.$__.skipId=n),t!=null&&typeof t!="object")throw new bx(t,"obj","Document");let i=!0;r.defaults!==void 0&&(this.$__.defaults=r.defaults,i=r.defaults);let s=this.$__schema;typeof e=="boolean"||e==="throw"?(e!==!0&&(this.$__.strictMode=e),e=void 0):s.options.strict!==!0&&(this.$__.strictMode=s.options.strict);let o=s.requiredPaths(!0);for(let c of o)this.$__.activePaths.require(c);let a=null;Ae.isPOJO(e)&&Object.keys(e).length>0&&(a=B9e(e),this.$__.selected=e,this.$__.exclude=a);let u=a===!1&&e?pG(e):null;if(this._doc==null&&(this.$__buildDoc(t,e,n,a,u,!1),i&&yx(this,e,a,u,!0,null,{skipParentChangeTracking:!0})),t&&(this.$__original_set?this.$__original_set(t,void 0,!0,r):this.$set(t,void 0,!0,r),t instanceof R&&(this.$isNew=t.$isNew)),r.willInit&&i?r.skipDefaults&&(this.$__.skipDefaults=r.skipDefaults):i&&yx(this,e,a,u,!1,r.skipDefaults),!this.$__.strictMode&&t){let c=this;Object.keys(this._doc).forEach(function(p){!(p in s.tree)&&!(p in s.methods)&&!(p in s.virtuals)&&!p.startsWith("$")&&C9e({prop:p,subprops:null,prototype:c})})}tOe(this)}R.prototype.$isMongooseDocumentPrototype=!0;Object.defineProperty(R.prototype,"isNew",{get:function(){return this.$isNew},set:function(t){this.$isNew=t}});Object.defineProperty(R.prototype,"errors",{get:function(){return this.$errors},set:function(t){this.$errors=t}});R.prototype.$isNew=!0;Ae.each(["on","once","emit","listeners","removeListener","setMaxListeners","removeAllListeners","addListener"],function(t){R.prototype[t]=function(){if(!this.$__.emitter){if(t==="emit")return;this.$__.emitter=new hx,this.$__.emitter.setMaxListeners(0)}return this.$__.emitter[t].apply(this.$__.emitter,arguments)},R.prototype[`$${t}`]=R.prototype[t]});R.prototype.constructor=R;for(let t in hx.prototype)R[t]=hx.prototype[t];R.prototype.$__schema;R.prototype.schema;Object.defineProperty(R.prototype,"$locals",{configurable:!1,enumerable:!1,get:function(){return this.$__.locals==null&&(this.$__.locals={}),this.$__.locals},set:function(t){this.$__.locals=t}});R.prototype.isNew;Object.defineProperty(R.prototype,"$where",{configurable:!1,enumerable:!1,writable:!0});R.prototype.id;R.prototype.$errors;Object.defineProperty(R.prototype,"$op",{get:function(){return this.$__.op||null},set:function(t){this.$__.op=t}});function G9e(t,e,r){if(t==null)return;let n=Object.keys(r.$__schema.paths),i=n.length,s=e.indexOf(".")===-1?[e]:e.split(".");for(let o=0;o<i;++o){let a="",u=n[o];if(!u.startsWith(e+"."))continue;let c=r.$__schema.paths[u],l=c.splitPath().slice(s.length),p=l.length;if(c.defaultValue===void 0)continue;let f=t;for(let d=0;d<p&&f!=null;++d){let h=l[d];if(d===p-1){if(f[h]!==void 0)break;try{let m=c.getDefault(r,!1);m!==void 0&&(f[h]=m)}catch(m){r.invalidate(e+"."+a,m);break}break}a+=(a.length?".":"")+h,f[h]=f[h]||{},f=f[h]}}}R.prototype.$__buildDoc=function(t,e,r,n,i){let s={},o=Object.keys(this.$__schema.paths).filter(c=>!c.includes("$*")),a=o.length,u=0;for(;u<a;++u){let c=o[u];if(c==="_id"&&(r||t&&"_id"in t))continue;let l=this.$__schema.paths[c].splitPath(),p=l.length,f=p-1,d="",h=s,m=!1;for(let g=0;g<p;++g){let b=l[g];if(d.length?d+="."+b:d=b,n===!0){if(d in e)break}else if(n===!1&&e&&!m){if(d in e)m=!0;else if(!i[d])break}g<f&&(h=h[b]||(h[b]={}))}}this._doc=s};R.prototype.toBSON=function(){return this.toObject(dG)};R.prototype.init=function(t,e,r){if(typeof e=="function"&&(r=e,e=null),t==null)throw new bx(t,"doc","init");return this.$__init(t,e),r&&r(null,this),this};R.prototype.$init=function(){return this.constructor.prototype.init.apply(this,arguments)};R.prototype.$__init=function(t,e){if(t==null)throw new bx(t,"doc","init");if(this.$isNew=!1,e=e||{},t._id!=null&&e.populated&&e.populated.length){let n=String(t._id);for(let i of e.populated)if(i.isVirtual?this.$populated(i.path,Ae.getValue(i.path,t),i):this.$populated(i.path,i._docs[n],i),i._childDocs!=null){for(let s of i._childDocs)s==null||s.$__==null||(s.$__.parent=this);i._childDocs=[]}}yG(this,t,this._doc,e),k9e(this,e.populated),this.$emit("init",this),this.constructor.emit("init",this);let r=this.$__.exclude===!1&&this.$__.selected?pG(this.$__.selected):null;return yx(this,this.$__.selected,this.$__.exclude,r,!1,this.$__.skipDefaults),this};function yG(t,e,r,n,i){if(i=i||"",typeof e!="object"||Array.isArray(e))throw new cG(t.$basePath,e);e.$__!=null&&(e=e._doc);let s=Object.keys(e),o=s.length,a,u,c,l=t.$__.strictMode,p=t.$__schema;for(let f=0;f<o;++f){if(c=s[f],mG.has(c)||(u=i?i+c:c,a=p.path(u),p.$isRootDiscriminator&&!t.$__isSelected(u)))continue;let d=e[c];if(!a&&Ae.isPOJO(d))r[c]||(r[c]={},(!l&&!(c in p.tree)&&!(c in p.methods)&&!(c in p.virtuals)||n?.virtuals&&c in p.virtuals)&&(t[c]=r[c])),yG(t,d,r[c],n,u+".");else if(!a)r[c]=d,(!l&&!i||n?.virtuals&&c in p.virtuals)&&(t[c]=d);else{if(Object.hasOwn(r,c)&&d!==void 0&&!n.hydratedPopulatedDocs&&delete r[c],d===null)r[c]=a._castNullish(null);else if(d!==void 0){let h=d.$__==null?null:d.$__.wasPopulated;if(a&&!h&&!n.hydratedPopulatedDocs)try{n&&n.setters?r[c]=a.applySetters(d,t,!1,null,n):r[c]=a.cast(d,t,!0,void 0,n)}catch(m){t.invalidate(m.path,new lG({path:m.path,message:m.message,type:"cast",value:m.value,reason:m}))}else a&&n.hydratedPopulatedDocs?(r[c]=a.cast(d,t,!0,void 0,{hydratedPopulatedDocs:!0}),r[c]&&r[c].$__&&r[c].$__.wasPopulated?t.$populated(u,r[c].$__.wasPopulated.value,r[c].$__.wasPopulated.options):Array.isArray(r[c])&&r[c].length&&r[c][0]?.$__?.wasPopulated&&t.$populated(u,r[c].map(m=>m?.$__?.wasPopulated?.value).filter(m=>m!=null),r[c][0].$__.wasPopulated.options)):r[c]=d}t.$isModified(u)||t.$__.activePaths.init(u)}}}R.prototype.updateOne=function(e,r){let n=this.constructor.updateOne({_id:this._doc._id},e,r),i=this;return n.pre(async function(){let o=await i._execDocumentPreHooks("updateOne",i);if(o?.length!==1||o[0]!==i)throw new Error("Document updateOne pre hooks cannot overwrite arguments");return i.$where!=null&&this.where(i.$where),o}),n.post(function(){return i._execDocumentPostHooks("updateOne")}),this.$session()!=null&&("session"in n.options||(n.options.session=this.$session())),n};R.prototype.replaceOne=function(){let e=[...arguments];return e.unshift({_id:this._doc._id}),this.constructor.replaceOne.apply(this.constructor,e)};R.prototype.$session=function(e){if(arguments.length===0)return this.$__.session!=null&&this.$__.session.hasEnded?(this.$__.session=null,null):this.$__.session;if(e!=null&&e.hasEnded)throw new ni("Cannot set a document's session to a session that has ended. Make sure you haven't called `endSession()` on the session you are passing to `$session()`.");if(!(e==null&&this.$__.session==null)){if(this.$__.session=e,!this.$isSubdocument){let r=this.$getAllSubdocs();for(let n of r)n.$session(e)}return e}};R.prototype.$timestamps=function(e){if(arguments.length===0)return this.$__.timestamps!=null?this.$__.timestamps:this.$__schema?this.$__schema.options.timestamps:void 0;let r=this.$timestamps();return e!==r&&(this.$__.timestamps=e),this};R.prototype.overwrite=function(e){let r=Array.from(new Set(Object.keys(this._doc).concat(Object.keys(e))));for(let n of r)n!=="_id"&&(this.$__schema.options.versionKey&&n===this.$__schema.options.versionKey||this.$__schema.options.discriminatorKey&&n===this.$__schema.options.discriminatorKey||this.$set(n,e[n]));return this};R.prototype.$set=function(e,r,n,i){Ae.isPOJO(n)&&(i=n,n=void 0);let s=i&&i.merge,o=n&&n!==!0,a=n===!0,u,c,l=0,p,f,d,h=i&&"strict"in i,m=h?i.strict:this.$__.strictMode;if(o&&(u=this.$__.adhocPaths||(this.$__.adhocPaths={}),u[e]=this.$__schema.interpretAsType(e,n,this.$__schema.options)),e==null)[e,r]=[r,e];else if(typeof e!="string"){e instanceof R&&(e.$__isNested?e=e.toObject():e=e.$__schema===this.$__schema?_x(e,{...e._doc}):e._doc),e==null&&([e,r]=[r,e]),d=r?r+".":"",c=nG(this.$__schema,e);let k=c.length,D=i&&i._skipMinimizeTopLevel||!1;if(k===0&&D)return delete i._skipMinimizeTopLevel,r&&this.$set(r,{}),this;i=Object.assign({},i,{_skipMinimizeTopLevel:!1});for(let L=0;L<k;++L){f=c[L];let J=d?d+f:f;p=this.$__schema.pathType(J);let re=e[f];if(n===!0&&!d&&re!=null&&p==="nested"&&this._doc[f]!=null&&delete this._doc[f],Ae.isNonBuiltinObject(re)&&p==="nested"){this.$set(J,re,a,i),G9e(this.$get(J),J,this);continue}else if(m){if(a&&re===void 0&&this.$get(J)!==void 0)continue;if(p==="adhocOrUndefined"&&(p=dx(this,J,{typeOnly:!0})),p==="real"||p==="virtual")this.$set(J,re,a,i);else if(p==="nested"&&re instanceof R)this.$set(J,re.toObject({transform:!1}),a,i);else{if(m==="throw")throw p==="nested"?new cG(f,re):new mx(f);p==="nested"&&re==null&&this.$set(J,re,a,i)}}else this.$set(J,re,a,i)}let B={},$=Object.keys(this.$__schema.tree);for(let L=0,J=$.length;L<J;++L)(f=$[L])&&Object.hasOwn(this._doc,f)&&(B[f]=void 0);return this._doc=Object.assign(B,this._doc),this}let g=this.$__schema.pathType(e),b=null;if(g==="adhocOrUndefined"&&(b=e.indexOf(".")===-1?[e]:e.split("."),g=dx(this,b,{typeOnly:!0})),g==="adhocOrUndefined"&&!h){b==null&&(b=e.indexOf(".")===-1?[e]:e.split("."));let k=M9e(this.$__schema,b);k!==void 0&&(m=k)}r=P9e(r,!0);let _=(()=>{if(this.$__.priorDoc!=null)return this.$__.priorDoc.$__getValue(e);if(!a)return this.$__getValue(e)})();if(g==="nested"&&r){if(typeof r=="object"&&r!=null){if(r.$__!=null&&(r=r.toObject(dG)),r==null)return this.invalidate(e,new ni.CastError("Object",r,e)),this;let k=this.$isModified(e),D=this.$__.savedState!=null&&Object.hasOwn(this.$__.savedState,e);if(this.$__.savedState!=null&&!this.$isNew&&!Object.hasOwn(this.$__.savedState,e)){let $=this.$__getValue(e);this.$__.savedState[e]=$;let L=Object.keys($||{});for(let J of L)this.$__.savedState[e+"."+J]=$[J]}if(!s)this.$__setValue(e,null),mE(this,e);else return this.$set(r,e,a,i);let B=nG(this.$__schema,r,e);this.$__setValue(e,{});for(let $ of B)this.$set(e+"."+$,r[$],a,{...i,_skipMarkModified:!0});return _!=null&&(!k||D)&&Ae.deepEqual(D?this.$__.savedState[e]:_,r)?this.unmarkModified(e):this.markModified(e),this}return this.invalidate(e,new ni.CastError("Object",r,e)),this}let w;if(b==null&&(b=e.indexOf(".")===-1?[e]:e.split(".")),typeof this.$__schema.aliases[b[0]]=="string"&&(b[0]=this.$__schema.aliases[b[0]]),g==="adhocOrUndefined"&&m){let k;for(l=0;l<b.length;++l){let D=b.slice(0,l+1).join(".");if(l+1<b.length&&this.$__schema.pathType(D)==="virtual")return I9e.set(e,r,this),this;if(w=this.$__schema.path(D),w!=null){if(w instanceof rG){k=!0;break}else if(w.$isSchemaMap&&w.$__schemaType instanceof rG&&l<b.length-1){k=!0,w=w.$__schemaType;break}}}if(w==null&&(w=dx(this,e)),!k&&!w){if(m==="throw")throw new mx(e);return this}}else{if(g==="virtual")return w=this.$__schema.virtualpath(e),w.applySetters(r,this),this;w=this.$__path(e)}let E=this._doc,A="";for(l=0;l<b.length-1;++l)E=E instanceof Map?E.get(b[l]):E[b[l]],A+=(A.length!==0?".":"")+b[l],E||(this.$set(A,{}),this.$__isSelected(A)||this.unmarkModified(A),E=this.$__getValue(A));let O;if(b.length<=1)O=e;else{let k=b.length;for(l=0;l<k;++l){let D=b.slice(0,l+1).join(".");if(this.$get(D,null,{getters:!1})===null){O=D;break}}O||(O=e)}if(!w)return this.$__set(O,e,i,a,b,w,r,_),g==="nested"&&r==null&&mE(this,e),this;if((w.$isSingleNested||w.$isMongooseArray)&&X9e(this,e),r!=null&&s&&w.$isSingleNested){r instanceof R&&(r=r.toObject({virtuals:!1,transform:!1}));let k=Object.keys(r);for(let D of k)this.$set(e+"."+D,r[D],a,i);return this}let C=!0;try{let k=(()=>{if(w.options==null||!(r instanceof R))return!1;let L=r.constructor,J=typeof w.options.ref=="function"&&!w.options.ref[z9e]?w.options.ref.call(this,this):w.options.ref,re=J?.modelName||J;if(re!=null&&(re===L.modelName||re===L.baseModelName))return!0;let Qe=w.options.refPath;if(Qe==null)return!1;let mr=r.get(Qe);return mr===L.modelName||mr===L.baseModelName})(),D=!1;if(k&&r instanceof R&&(!r.$__.wasPopulated||Ae.deepEqual(r.$__.wasPopulated.value,r._doc._id))){let L=w&&w.$isSingleNested?w.cast(r,this):r._doc._id;this.$populated(e,L,{[oG]:r.constructor}),r.$__.wasPopulated={value:L},D=!0}let B,$=this.$__schema.options.typeKey;if(w.options&&Array.isArray(w.options[$])&&w.options[$].length&&w.options[$][0]&&w.options[$][0].ref&&K9e(r,w.options[$][0].ref)){B={[oG]:r[0].constructor},this.$populated(e,r.map(function(L){return L._doc._id}),B);for(let L of r)L.$__.wasPopulated={value:L._doc._id};D=!0}if(!k||!w.$isSingleNested||!r.$__){let L=this;this.$__schema.singleNestedPaths[e]!=null&&b.length>1&&(L=H9e(this,b,this.schema)),i!=null&&i.overwriteImmutable?r=w.applySetters(r,L,!1,_,{path:e,overwriteImmutable:!0}):r=w.applySetters(r,L,!1,_,{path:e})}if(Array.isArray(r)&&!Array.isArray(w)&&w.$isMongooseDocumentArray&&r.length!==0&&r[0]!=null&&r[0].$__!=null&&r[0].$__.populated!=null){let L=Object.keys(r[0].$__.populated);for(let J of L)this.$populated(e+"."+J,r.map(re=>re.$populated(J)),r[0].$__.populated[J].options);D=!0}if(!D&&this.$__.populated){if(Array.isArray(r)&&this.$__.populated[e])for(let L=0;L<r.length;++L)r[L]instanceof R&&r.set(L,r[L]._doc._id,!0);delete this.$__.populated[e]}r!=null&&w.$isSingleNested&&eOe(r,w,_),this.$markValid(e)}catch(k){k instanceof ni.StrictModeError&&k.isImmutableError?this.invalidate(e,k):k instanceof ni.CastError?(this.invalidate(k.path,k),k.$originalErrorPath&&this.invalidate(e,new ni.CastError(w.instance,r,e,k.$originalErrorPath))):this.invalidate(e,new ni.CastError(w.instance,r,e,k)),C=!1}if(C){let k=null,D=null;if(!a){let L=this.$isSubdocument?this.ownerDocument():this;k=L.$__.savedState,D=this.$isSubdocument?this.$__.fullPath+"."+e:e,L.$__saveInitialState(D)}this.$__set(O,e,i,a,b,w,r,_);let B=!!this.$__.session?.transaction,$=this.$__.session&&this.$__.session[yE]&&this.$__.session[yE].has(this)&&this.$__.session[yE].get(this).modifiedPaths&&!this.$__.session[yE].get(this).modifiedPaths.has(D);k!=null&&Object.hasOwn(k,D)&&(!B||$)&&Ae.deepEqual(r,k[D])&&this.unmarkModified(e)}return w.$isSingleNested&&(this.isDirectModified(e)||r==null)?mE(this,e):w.$isSchemaMap&&r==null&&mE(this,e),this};function K9e(t,e){if(!Array.isArray(t)||t.length===0)return!1;for(let r of t)if(!(r instanceof R)||r.constructor.modelName==null||r.constructor.modelName!=e&&r.constructor.baseModelName!=e)return!1;return!0}R.prototype.set=R.prototype.$set;R.prototype.$__shouldModify=function(t,e,r,n,i,s,o,a){return r&&r._skipMarkModified?!1:this.$isNew||e in this.$__.activePaths.getStatePaths("modify")||o===void 0&&!this.$__isSelected(e)?!0:o===void 0&&e in this.$__.activePaths.getStatePaths("default")||this.$populated(e)&&o instanceof R&&gE(o._doc._id,a)?!1:!!(!gE(o,a!==void 0?a:Ae.getValue(e,this))||!n&&o!==null&&o!==void 0&&e in this.$__.activePaths.getStatePaths("default")&&gE(o,s.getDefault(this,n)))};R.prototype.$__set=function(t,e,r,n,i,s,o,a){$h=$h||Af();let u=this.$__shouldModify(t,e,r,n,i,s,o,a);u?(this.$__.primitiveAtomics&&this.$__.primitiveAtomics[e]&&(delete this.$__.primitiveAtomics[e],Object.keys(this.$__.primitiveAtomics).length===0&&delete this.$__.primitiveAtomics),this.markModified(t),aG||(aG=ox()),o&&Ae.isMongooseArray(o)&&(o._registerAtomic("$set",o),Ae.isMongooseDocumentArray(o)&&o.forEach(function(d){d&&d.__parentArray&&(d.__parentArray=o)}))):Array.isArray(o)&&Array.isArray(a)&&Ae.isMongooseArray(o)&&Ae.isMongooseArray(a)&&(o[Rn]=a[Rn],o[qh]=a[qh],Ae.isMongooseDocumentArray(o)&&o.forEach(d=>{d!=null&&(d.$isNew=!1)}));let c=this._doc,l=0,p=i.length,f="";for(;l<p;l++){let h=l+1===p;if(f+=f?"."+i[l]:i[l],!mG.has(i[l]))if(h)c instanceof Map?c.set(i[l],o):c.$isSingleNested?(i[l]in c||(c[i[l]]=o),c._doc[i[l]]=o,u&&c.markModified(i[l])):c[i[l]]=o;else{let m=c instanceof Map,g=m?c.get(i[l]):c[i[l]];Ae.isPOJO(g)||g&&g instanceof $h||g&&!Array.isArray(g)&&g.$isSingleNested||g&&Array.isArray(g)||g==null&&(g={},m?c.set(i[l],g):c[i[l]]=g),c=g}}};R.prototype.$__getValue=function(t){if(typeof t!="string"&&!Array.isArray(t))throw new TypeError(`Invalid \`path\`. Must be either string or array. Got "${t}" (type ${typeof t})`);return Ae.getValue(t,this._doc)};R.prototype.$inc=function(e,r){if(r==null&&(r=1),Array.isArray(e))return e.forEach(u=>this.$inc(u,r)),this;let n=this.$__path(e);if(n==null){if(this.$__.strictMode==="throw")throw new mx(e);if(this.$__.strictMode===!0)return this}else if(n.instance!=="Number")return this.invalidate(e,new ni.CastError(n.instance,r,e)),this;let i=this.$__getValue(e)||0,s=!1,o=null,a=r;try{r=n.cast(r),o=n.applySetters(i+r,this),a=o-i,s=!0}catch(u){this.invalidate(e,new ni.CastError("number",r,e,u))}return s&&(this.$__.primitiveAtomics=this.$__.primitiveAtomics||{},this.$__.primitiveAtomics[e]==null?this.$__.primitiveAtomics[e]={$inc:a}:this.$__.primitiveAtomics[e].$inc+=a,this.markModified(e),this.$__setValue(e,o)),this};R.prototype.$__setValue=function(t,e){return Ae.setValue(t,e,this._doc),this};R.prototype.get=function(t,e,r){let n;r==null&&(r={}),e&&(n=this.$__schema.interpretAsType(t,e,this.$__schema.options));let i=r.noDottedPath,s=i?this.$__schema.paths[t]:this.$__path(t);if(s==null&&(s=this.$__schema.virtualpath(t),s!=null))return s.applyGetters(void 0,this);if(i){let c=this._doc[t];return n&&(c=n.cast(c)),s!=null&&r.getters!==!1?s.applyGetters(c,this):c}if(s!=null&&s.instance==="Mixed"){let c=this.$__schema.virtualpath(t);c!=null&&(s=c)}let o=t.indexOf(".")!==-1,a=this._doc,u=o?t.split("."):[t];typeof this.$__schema.aliases[u[0]]=="string"&&(u[0]=this.$__schema.aliases[u[0]]);for(let c=0,l=u.length;c<l;c++)a&&a._doc&&(a=a._doc),a==null?a=void 0:a instanceof Map?a=a.get(u[c],{getters:!1}):c===l-1?a=Ae.getValue(u[c],a):a=a[u[c]];if(n&&(a=n.cast(a)),s!=null&&r.getters!==!1)a=s.applyGetters(a,this);else if(this.$__schema.nested[t]&&r.virtuals)return _x(this,Ns(a)||{},{path:t});return a};R.prototype[U9e]=R.prototype.get;R.prototype.$get=R.prototype.get;R.prototype.$__path=function(t){let e=this.$__.adhocPaths,r=e&&Object.hasOwn(e,t)?e[t]:null;return r||this.$__schema.path(t)};R.prototype.markModified=function(t,e){this.$__saveInitialState(t),this.$__.activePaths.modify(t),e!=null&&!this.$isSubdocument&&(this.$__.pathsToScopes=this.$__pathsToScopes||{},this.$__.pathsToScopes[t]=e)};R.prototype.$__saveInitialState=function(e){let r=this.$__.savedState,n=e;if(r!=null){let i=n.indexOf("."),s=i===-1?n:n.slice(0,i);Object.hasOwn(r,s)||(r[s]=Ns(this.$__getValue(s)))}};R.prototype.unmarkModified=function(t){this.$__.activePaths.init(t),this.$__.pathsToScopes!=null&&delete this.$__.pathsToScopes[t]};R.prototype.$ignore=function(t){this.$__.activePaths.ignore(t)};R.prototype.directModifiedPaths=function(){return Object.keys(this.$__.activePaths.getStatePaths("modify"))};R.prototype.$isEmpty=function(t){let e={minimize:!0,virtuals:!1,getters:!1,transform:!1};if(arguments.length!==0){let r=this.$get(t);return r==null?!0:typeof r!="object"?!1:Ae.isPOJO(r)?gG(r):Object.keys(r.toObject(e)).length===0}return Object.keys(this.toObject(e)).length===0};function gG(t){if(t==null)return!0;if(typeof t!="object"||Array.isArray(t))return!1;for(let e of Object.keys(t))if(!gG(t[e]))return!1;return!0}R.prototype.modifiedPaths=function(t){t=t||{};let e=Object.keys(this.$__.activePaths.getStatePaths("modify")),r=new Set,n=0,i=0,s=e.length;for(n=0;n<s;++n){let o=e[n],a=Ex(o),u=a.length;for(i=0;i<u;++i)r.add(a[i]);if(!t.includeChildren)continue;let c=0,l=this.$get(o);if(typeof l=="object"&&l!==null){l._doc&&(l=l._doc);let p=l.length;if(Array.isArray(l))for(c=0;c<p;++c){let f=o+"."+c;if(!r.has(f)&&(r.add(f),l[c]!=null&&l[c].$__)){let d=l[c].modifiedPaths(),h=0,m=d.length;for(h=0;h<m;++h)r.add(f+"."+d[h])}}else{let f=Object.keys(l),d=0,h=f.length;for(d=0;d<h;++d)r.add(o+"."+f[d])}}}return Array.from(r)};R.prototype[hG]=R.prototype.modifiedPaths;R.prototype.isModified=function(t,e,r){if(t){let n=e&&e.ignoreAtomics,i=this.$__.activePaths.states.modify;if(i==null)return!1;typeof t=="string"&&(t=t.indexOf(" ")===-1?[t]:t.split(" "));for(let u of t)if(i[u]!=null)return!0;let s=r||this[hG](),o=t.some(function(u){return!!~s.indexOf(u)}),a=Object.keys(i);return n&&(a=a.filter(u=>{let c=this.$__getValue(u);return!(c!=null&&c[Rn]!=null&&c[Rn].$set===void 0)})),o||t.some(function(u){return a.some(function(c){return c===u||u.startsWith(c+".")})})}return this.$__.activePaths.some("modify")};R.prototype.$isModified=R.prototype.isModified;R.prototype[j9e]=R.prototype.isModified;R.prototype.$isDefault=function(t){if(t==null)return this.$__.activePaths.some("default");if(typeof t=="string"&&t.indexOf(" ")===-1)return Object.hasOwn(this.$__.activePaths.getStatePaths("default"),t);let e=t;return Array.isArray(e)||(e=e.split(" ")),e.some(r=>Object.hasOwn(this.$__.activePaths.getStatePaths("default"),r))};R.prototype.$isDeleted=function(t){return arguments.length===0?!!this.$__.isDeleted:(this.$__.isDeleted=!!t,this)};R.prototype.isDirectModified=function(t){if(t==null)return this.$__.activePaths.some("modify");if(typeof t=="string"&&t.indexOf(" ")===-1){let r=Object.hasOwn(this.$__.activePaths.getStatePaths("modify"),t);if(r||t.indexOf(".")===-1)return r;let n=t.split(".");for(let i=0;i<n.length-1;++i){let s=n.slice(0,i+1).join("."),o=this.$get(s);if(o!=null&&o.$__!=null&&o.isDirectModified(n.slice(i+1).join(".")))return!0}return!1}let e=t;return typeof e=="string"&&(e=e.split(" ")),e.some(r=>this.isDirectModified(r))};R.prototype.isInit=function(t){if(t==null)return this.$__.activePaths.some("init");if(typeof t=="string"&&t.indexOf(" ")===-1)return Object.hasOwn(this.$__.activePaths.getStatePaths("init"),t);let e=t;return Array.isArray(e)||(e=e.split(" ")),e.some(r=>Object.hasOwn(this.$__.activePaths.getStatePaths("init"),r))};R.prototype.isSelected=function(e){if(this.$__.selected==null)return!0;if(!e)return!1;if(e==="_id")return this.$__.selected._id!==0;if(e.indexOf(" ")!==-1&&(e=e.split(" ")),Array.isArray(e))return e.some(s=>this.$__isSelected(s));let r=Object.keys(this.$__.selected),n=null;if(r.length===1&&r[0]==="_id")return this.$__.selected._id===0;for(let s of r)if(s!=="_id"&&fG(this.$__.selected[s])){n=!!this.$__.selected[s];break}if(n===null)return!0;if(e in this.$__.selected)return n;let i=e+".";for(let s of r)if(s!=="_id"){if(s.startsWith(i))return n||s!==i;if(i.startsWith(s+"."))return n}return!n};R.prototype.$__isSelected=R.prototype.isSelected;R.prototype.isDirectSelected=function(e){if(this.$__.selected==null)return!0;if(e==="_id")return this.$__.selected._id!==0;if(e.indexOf(" ")!==-1&&(e=e.split(" ")),Array.isArray(e))return e.some(i=>this.isDirectSelected(i));let r=Object.keys(this.$__.selected),n=null;if(r.length===1&&r[0]==="_id")return this.$__.selected._id===0;for(let i of r)if(i!=="_id"&&fG(this.$__.selected[i])){n=!!this.$__.selected[i];break}return n===null?!0:Object.hasOwn(this.$__.selected,e)?n:!n};R.prototype.validate=async function(e,r){if(typeof e=="function"||typeof r=="function"||typeof arguments[2]=="function")throw new ni("Document.prototype.validate() no longer accepts a callback");if(this.$op="validate",arguments.length===1&&typeof arguments[0]=="object"&&!Array.isArray(arguments[0])&&(r=arguments[0],e=null),r&&typeof r.pathsToSkip=="string"){let i=r.pathsToSkip.indexOf(" ")===-1;r.pathsToSkip=i?[r.pathsToSkip]:r.pathsToSkip.split(" ")}let n=r&&r._skipParallelValidateCheck;if(this.$isSubdocument==null){if(this.$__.validating&&!n)throw new S9e(this);n||(this.$__.validating=!0)}try{await this.$__validate(e,r)}finally{this.$op=null,this.$__.validating=null}};R.prototype.$validate=R.prototype.validate;function Y9e(t){let e=Object.keys(t.$__.activePaths.getStatePaths("require")),r=0,n=e.length;for(r=0;r<n;++r){let i=e[r],s=t.$__schema.path(i);if(s!=null&&typeof s.originalRequiredValue=="function"){t.$__.cachedRequired=t.$__.cachedRequired||{};try{t.$__.cachedRequired[i]=s.originalRequiredValue.call(t,t)}catch(o){t.invalidate(i,o)}}}}function bG(t,e,r,n){let i={};Y9e(t);let s=new Set(Object.keys(t.$__.activePaths.getStatePaths("require")).filter(function(u){return!t.$__isSelected(u)&&!t.$isModified(u)||u.endsWith(".$*")?!1:t.$__.cachedRequired!=null&&u in t.$__.cachedRequired?t.$__.cachedRequired[u]:!0}));Object.keys(t.$__.activePaths.getStatePaths("init")).forEach(o),Object.keys(t.$__.activePaths.getStatePaths("modify")).forEach(o),Object.keys(t.$__.activePaths.getStatePaths("default")).forEach(o);function o(u){u.endsWith(".$*")||s.add(u)}if(!n){let u=[];for(let l of Object.keys(t.$__schema.paths)){let p=t.$__schema.path(l);if(p.$isSingleNested){let f=t.$get(l);f&&u.push(f)}else if(p.$isMongooseDocumentArray){let f=t.$get(l);if(f&&f.length)for(let d of f)d&&u.push(d)}}let c=t.modifiedPaths();for(let l of u)if(l.$basePath){let p=l.$__pathRelativeToParent();for(let d of l.modifiedPaths())s.delete(p+"."+d);let f=l.$parent();if(f==null)throw new Error("Cannot validate subdocument that does not have a parent");t.$isModified(p,null,c)&&!Object.hasOwn(f.$__.activePaths.getStatePaths("modify"),p)&&!f.$isDefault(p)&&(s.add(p),t.$__.pathsToScopes==null&&(t.$__.pathsToScopes={}),t.$__.pathsToScopes[p]=l.$isDocumentArrayElement?l.__parentArray:l.$parent(),i[p]={skipSchemaValidators:!0},l.$isDocumentArrayElement&&l.__index!=null&&(i[p].index=l.__index))}}for(let u of s){let c=t.$__schema.path(u);if(c){if(c.$isMongooseDocumentArray)for(let l of s)(l==null||l.startsWith(c.path+"."))&&s.delete(l);(!c.schema&&!c.embeddedSchemaType&&c.validators.length===0&&!c.$parentSchemaDocArray||c.$isMongooseArray&&!c.$isMongooseDocumentArray&&!c.embeddedSchemaType.$isMongooseArray&&c.validators.length===0&&c.embeddedSchemaType.validators.length===0)&&s.delete(u)}}Array.isArray(e)?s=Q9e(s,e):Array.isArray(r)&&(s=Z9e(s,r)),J9e(t,s);let a={skipArrays:!0};for(let u of s)if(t.$__schema.nested[u]){let c=t.$__getValue(u);$9e(c)&&(c=c.toObject({transform:!1}));let l=D9e(c,u,a,t.$__schema),p=t.$__schema.singleNestedPaths;for(let f of Object.keys(l))Object.hasOwn(p,f)||o(f)}for(let u of s){let c=t.$__schema.path(u);if(!c||(c.$parentSchemaDocArray&&typeof c.$parentSchemaDocArray.path=="string"&&s.add(c.$parentSchemaDocArray.path),!c.$isSchemaMap))continue;let l=t.$__getValue(u);if(l!=null)for(let p of l.keys())s.add(u+"."+p)}return s=Array.from(s),[s,i]}function J9e(t,e){for(let r of e){let n=t.$__schema.path(r);if(!n||!n.$isMongooseArray||!Array.isArray(n)&&n.$isMongooseDocumentArray&&!(n&&n.schemaOptions&&n.schemaOptions.required)||n.$isMongooseArray&&!n.$isMongooseDocumentArray&&!n.embeddedSchemaType.$isMongooseArray&&n.embeddedSchemaType.validators.length===0)continue;let i=t.$__getValue(r);_E(i,e,r)}}function _E(t,e,r){if(t!=null){let n=t.length;for(let i=0;i<n;++i)Array.isArray(t[i])?_E(t[i],e,r+"."+i):e.add(r+"."+i)}}R.prototype._execDocumentPreHooks=async function(e,...r){return this.$__middleware.execPre(e,this,[...r])};R.prototype._execDocumentPostHooks=async function(e,r){return this.$__middleware.execPost(e,this,[this],{error:r})};R.prototype.$__validate=async function(e,r){try{[r]=await this._execDocumentPreHooks("validate",r)}catch(g){await this._execDocumentPostHooks("validate",g);return}this.$__.saveOptions&&this.$__.saveOptions.pathsToSave&&!e&&(e=[...this.$__.saveOptions.pathsToSave]);let n=r&&typeof r=="object"&&"validateModifiedOnly"in r,i=r&&r.pathsToSkip||null,s;n?s=!!r.validateModifiedOnly:s=this.$__schema.options.validateModifiedOnly;let o=r&&r.validateAllPaths;if(o){if(i)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToSkip`");if(e)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToValidate`");if(n&&s)throw new TypeError("Cannot set both `validateAllPaths` and `validateModifiedOnly`")}let a=this,u=()=>{let g=this.$__.validationError;if(this.$__.validationError=null,this.$__.validating=null,s&&g!=null){let b=Object.keys(g.errors);for(let _ of b)this.$isModified(_)||delete g.errors[_];Object.keys(g.errors).length===0&&(g=void 0)}if(this.$__.cachedRequired={},this.$emit("validate",a),this.constructor.emit("validate",a),g){for(let b in g.errors)!this[q9e]&&g.errors[b]instanceof ni.CastError&&this.invalidate(b,g.errors[b]);return g}},c,l;if(o){c=new Set(Object.keys(this.$__schema.paths));for(let g of c){let b=this.$__schema.path(g);if(!b||!b.$isMongooseArray)continue;let _=this.$__getValue(g);_&&_E(_,c,g)}c=[...c],l={}}else{let g=bG(this,e,i,r&&r._nestedValidate);c=s?g[0].filter(b=>this.$isModified(b)):g[0],l=g[1]}if(typeof e=="string"&&(e=e.split(" ")),c.length===0){let g=u();await this._execDocumentPostHooks("validate",g);return}let p={},f=this.$__.saveOptions?.pathsToSave,d=[];if(Array.isArray(f)){f=new Set(f);for(let g of c)f.has(g)&&d.push(m(g))}else for(let g of c)d.push(m(g));await Promise.all(d);let h=u();await this._execDocumentPostHooks("validate",h);async function m(g){if(g==null||p[g])return;p[g]=!0;let b=a.$__schema.path(g);if(!b||!a.$isValid(g)||b[W9e]!=null&&g!==b.path)return;let _=a.$__getValue(g),w;(w=a.$populated(g))?_=w:_!=null&&_.$__!=null&&_.$__.wasPopulated&&(_=_._doc._id);let E=a.$__.pathsToScopes!=null&&g in a.$__.pathsToScopes?a.$__.pathsToScopes[g]:a,A={...l[g],path:g,validateAllPaths:o,_nestedValidate:!0};try{await b.doValidate(_,E,A)}catch(O){if((b.$isSingleNested||b.$isArraySubdocument||b.$isMongooseDocumentArray)&&O instanceof EE)return;a.invalidate(g,O,void 0,!0)}}};function Q9e(t,e){let r=new Set(e),n=new Map([]);for(let s of e){if(s.indexOf(".")===-1)continue;let o=s.split("."),a=o[0];for(let u=1;u<o.length;++u)n.set(a,s),a=a+"."+o[u]}let i=new Set;for(let s of t)r.has(s)?i.add(s):n.has(s)&&i.add(n.get(s));return i}function Z9e(t,e){return e=new Set(e),t=Array.from(t).filter(r=>!e.has(r)),new Set(t)}R.prototype.validateSync=function(t,e){let r=this;arguments.length===1&&typeof arguments[0]=="object"&&!Array.isArray(arguments[0])&&(e=arguments[0],t=null);let n=e&&typeof e=="object"&&"validateModifiedOnly"in e,i;n?i=!!e.validateModifiedOnly:i=this.$__schema.options.validateModifiedOnly;let s=e&&e.pathsToSkip,o=e&&e.validateAllPaths;if(o){if(s)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToSkip`");if(t)throw new TypeError("Cannot set both `validateAllPaths` and `pathsToValidate`")}typeof t=="string"?t=t.indexOf(" ")===-1?[t]:t.split(" "):typeof s=="string"&&s.indexOf(" ")!==-1&&(s=s.split(" "));let a,u;if(o){a=new Set(Object.keys(this.$__schema.paths));for(let p of a){let f=this.$__schema.path(p);if(!f||!f.$isMongooseArray)continue;let d=this.$__getValue(p);d&&_E(d,a,p)}a=[...a],u={}}else{let p=bG(this,t,s);a=i?p[0].filter(f=>this.$isModified(f)):p[0],u=p[1]}let c={};for(let p=0,f=a.length;p<f;++p){let d=a[p];if(c[d])continue;c[d]=!0;let h=r.$__schema.path(d);if(!h||!r.$isValid(d))continue;let m=r.$__getValue(d),g=h.doValidateSync(m,r,{skipSchemaValidators:u[d],path:d,validateModifiedOnly:i,validateAllPaths:o});if(g){if((h.$isSingleNested||h.$isArraySubdocument||h.$isMongooseDocumentArray)&&g instanceof EE)continue;r.invalidate(d,g,void 0,!0)}}let l=r.$__.validationError;if(r.$__.validationError=void 0,r.$emit("validate",r),r.constructor.emit("validate",r),l)for(let p in l.errors)l.errors[p]instanceof ni.CastError&&r.invalidate(p,l.errors[p]);return l};R.prototype.invalidate=function(t,e,r,n){if(this.$__.validationError||(this.$__.validationError=new EE(this)),!this.$__.validationError.errors[t])return(!e||typeof e=="string")&&(e=new lG({path:t,message:e,type:n||"user defined",value:r})),this.$__.validationError===e?this.$__.validationError:(this.$__.validationError.addError(t,e),this.$__.validationError)};R.prototype.$markValid=function(t){!this.$__.validationError||!this.$__.validationError.errors[t]||(delete this.$__.validationError.errors[t],Object.keys(this.$__.validationError.errors).length===0&&(this.$__.validationError=null))};function X9e(t,e){if(!t.$__.validationError)return;let r=Object.keys(t.$__.validationError.errors);for(let n of r)n.startsWith(e+".")&&delete t.$__.validationError.errors[n];Object.keys(t.$__.validationError.errors).length===0&&(t.$__.validationError=null)}function eOe(t,e,r){let n=e.schema;if(n!=null)for(let i of Object.keys(n.paths)){let s=n.paths[i];if(s.$immutableSetter==null)continue;let o=r?.$__getValue(i);s.$immutableSetter.call(t,o)}}R.prototype.$isValid=function(t){return this.$__.validationError==null||Object.keys(this.$__.validationError.errors).length===0?!0:t==null?!1:(t.indexOf(" ")!==-1&&(t=t.split(" ")),Array.isArray(t)?t.some(e=>this.$__.validationError.errors[e]==null):this.$__.validationError.errors[t]==null)};R.prototype.$__reset=function(){let e=this,r=this.$isSubdocument?null:this.$getAllSubdocs({useCache:!0});if(r&&r.length>0)for(let n of r)n.$__reset();return this.$__dirty().forEach(function(n){let i=n.value;i&&i[Rn]&&(i[qh]=i[Rn],i[Rn]={})}),this.$__.backup={},this.$__.backup.activePaths={modify:Object.assign({},this.$__.activePaths.getStatePaths("modify")),default:Object.assign({},this.$__.activePaths.getStatePaths("default"))},this.$__.backup.validationError=this.$__.validationError,this.$__.backup.errors=this.$errors,this.$__.activePaths.clear("modify"),this.$__.activePaths.clear("default"),this.$__.validationError=void 0,this.$errors=void 0,e=this,this.$__schema.requiredPaths().forEach(function(n){e.$__.activePaths.require(n)}),this};R.prototype.$__undoReset=function(){if(!(this.$__.backup==null||this.$__.backup.activePaths==null)){this.$__.activePaths.states.modify=this.$__.backup.activePaths.modify,this.$__.activePaths.states.default=this.$__.backup.activePaths.default,this.$__.validationError=this.$__.backup.validationError,this.$errors=this.$__.backup.errors;for(let e of this.$__dirty()){let r=e.value;r&&r[Rn]&&r[qh]&&(r[Rn]=r[qh])}if(!this.$isSubdocument)for(let e of this.$getAllSubdocs())e.$__undoReset()}};R.prototype.$__dirty=function(){let t=this,e=this.$__.activePaths.map("modify",function(i){return{path:i,value:t.$__getValue(i),schema:t.$__path(i)}});e=e.concat(this.$__.activePaths.map("default",function(i){if(!(i==="_id"||t.$__getValue(i)==null))return{path:i,value:t.$__getValue(i),schema:t.$__path(i)}}));let r=new Map(e.filter(i=>i!=null).map(i=>[i.path,i.value])),n=[];return e.forEach(function(i){if(!i)return;let s=null,o=Ex(i.path);for(let a=0;a<o.length-1;a++)if(r.has(o[a])){s=r.get(o[a]);break}s==null?n.push(i):s!=null&&s[Rn]!=null&&s.hasAtomics()&&(s[Rn]={},s[Rn].$set=s)}),n};R.prototype.$__setSchema=function(t){x9e(t.tree,this,void 0,t.options);for(let e of Object.keys(t.virtuals))t.virtuals[e]._applyDefaultGetters();t.path("schema")==null&&(this.schema=t),this.$__schema=t,this.$__middleware=t._getDocumentMiddleware(),this[L9e]=t};R.prototype.$__getArrayPathsToValidate=function(){return bE||(bE=Fc()),this.$__.activePaths.map("init","modify",function(t){return this.$__getValue(t)}.bind(this)).filter(function(t){return t&&Array.isArray(t)&&Ae.isMongooseDocumentArray(t)&&t.length}).reduce(function(t,e){return t.concat(e)},[]).filter(function(t){return t})};R.prototype.$getAllSubdocs=function(t){if(t?.useCache&&this.$__.saveOptions?.__subdocs)return this.$__.saveOptions.__subdocs;bE||(bE=Fc()),$h=$h||Af();let e=[];function r(n){let i=[];for(let{model:s}of n.$__schema.childSchemas){let o=n.$__getValue(s.path);if(o!=null){if(o.$__&&i.push(o),Array.isArray(o))for(let a of o)a!=null&&a.$__&&i.push(a);if(o instanceof Map)for(let a of o.values())a!=null&&a.$__&&i.push(a)}}for(let s of i)r(s);e.push(...i)}return r(this),this.$__.saveOptions&&(this.$__.saveOptions.__subdocs=e),e};function tOe(t){let e=t.$__schema&&t.$__schema.callQueue;if(e.length)for(let r of e)r[0]!=="pre"&&r[0]!=="post"&&r[0]!=="on"&&t[r[0]].apply(t,r[1])}R.prototype.$__handleReject=function(e){this.$listeners("error").length?this.$emit("error",e):this.constructor.listeners&&this.constructor.listeners("error").length&&this.constructor.emit("error",e)};R.prototype.$toObject=function(t,e){let r=this.$__schema._defaultToObjectOptions(e),n=this.$__hasOnlyPrimitiveValues();t=Ae.isPOJO(t)?{...t}:{},t._calledWithOptions=t._calledWithOptions||{...t};let i;t._calledWithOptions.minimize!=null?i=t.minimize:this.$__schemaTypeOptions?.minimize!=null?i=this.$__schemaTypeOptions.minimize:r!=null&&r.minimize!=null?i=r.minimize:i=this.$__schema.options.minimize,t.minimize=i,n||(t._seen=t._seen||new Map);let s=t._calledWithOptions.depopulate??r?.depopulate??t.depopulate??!1;if(s&&t._isNested&&this.$__.wasPopulated)return Ns(this.$__.wasPopulated.value||this._doc._id,t);if(s&&(t.depopulate=!0),r!=null)for(let d of Object.keys(r))t[d]==null&&(t[d]=r[d]);t._isNested=!0,t.json=e,t.minimize=i;let o=t._parentOptions;t._parentOptions=this.$isSubdocument?t:null;let a=t._calledWithOptions.schemaFieldsOnly??t.schemaFieldsOnly??r.schemaFieldsOnly??!1,u;if(n&&!t.flattenObjectIds)u=this.$__toObjectShallow(a);else if(a){u={};for(let d of Object.keys(this.$__schema.paths)){let h=this.$__getValue(d);if(h===void 0)continue;let m=d,g=u;if(d.indexOf(".")!==-1){let b=d.split(".");m=b[b.length-1];for(let _=0;_<b.length-1;++_)g[b[_]]=g[b[_]]??{},g=g[b[_]]}if(h===null){g[m]=null;continue}g[m]=Ns(h,t)}}else u=Ns(this._doc,t)||{};let c=t._calledWithOptions.getters??t.getters??r.getters??!1;c&&(rOe(this,u),t.minimize&&(u=F9e(u)||{}));let l=t._calledWithOptions.virtuals??r.virtuals??o?.virtuals??void 0;(l||c&&l!==!1)&&_x(this,u,t,t),t.versionKey===!1&&this.$__schema.options.versionKey&&delete u[this.$__schema.options.versionKey];let p=t._calledWithOptions.transform??!0,f;if(p===!0?f=r.transform:typeof p=="function"&&(f=p),p&&nOe(this,u),t.useProjection&&iOe(this,u),typeof f=="function"){let d=f(this,u,t);typeof d<"u"&&(u=d)}return u};R.prototype.$__toObjectShallow=function(e){let r={};if(this._doc!=null){let n=Object.keys(e?this.$__schema.paths:this._doc);for(let i of n){let s=this._doc[i];s instanceof Date?r[i]=new Date(s):s!==void 0&&(r[i]=s)}}return r};R.prototype.toObject=function(t){return this.$toObject(t)};function _x(t,e,r,n){let i=t.$__schema,s=i.virtuals,o=Object.keys(s),a=o.length,u=a,c,l,p=t._doc,f,d=typeof(n&&n.aliases)=="boolean"?n.aliases:!0;r=r||{};let h=null;if(Array.isArray(r.virtuals))h=new Set(r.virtuals);else if(r.virtuals&&r.virtuals.pathsToSkip){h=new Set(o);for(let m=0;m<r.virtuals.pathsToSkip.length;m++)h.has(r.virtuals.pathsToSkip[m])&&h.delete(r.virtuals.pathsToSkip[m])}if(!p)return e;for(a=0;a<u;++a){if(c=o[a],h!=null&&!h.has(c)||!d&&Object.hasOwn(i.aliases,c))continue;if(l=c,r.path!=null){if(!c.startsWith(r.path+"."))continue;l=c.substring(r.path.length+1)}if(l.indexOf(".")===-1&&l===c){if(f=s[c].applyGetters(void 0,t),f===void 0)continue;f=Ns(f,r),e[l]=f;continue}let m=l.split(".");if(f=Ns(t.get(c),r),f===void 0)continue;let g=m.length;p=e;for(let b=0;b<g-1;++b)p[m[b]]=p[m[b]]||{},p=p[m[b]];p[m[g-1]]=f}return e}function rOe(t,e){let r=t.$__schema,n=Object.keys(r.paths),i=n.length,s,o=t._doc,a;if(!o)return e;for(;i--;){s=n[i];let u=s.split("."),c=u.length,l=c-1,p=e,f;if(o=t._doc,!!t.$__isSelected(s))for(let d=0;d<c&&(f=u[d],a=o[f],!(p!=null&&typeof p!="object"));++d){if(d===l){if(p[f]=r.paths[s].applyGetters(p[f],t),Array.isArray(p[f])&&r.paths[s].embeddedSchemaType)for(let h=0;h<p[f].length;++h)p[f][h]=r.paths[s].embeddedSchemaType.applyGetters(p[f][h],t)}else if(a==null){f in o&&(p[f]=a);break}else p=p[f]||(p[f]={});o=a}}return e}function nOe(t,e){let r=t.$__schema,n=Object.keys(r.paths||{});if(!t._doc)return e;for(let s of n){let o=r.paths[s],a=o.options.transform??o.constructor?.defaultOptions?.transform,u=o.embeddedSchemaType?.options?.transform??o.embeddedSchemaType?.constructor?.defaultOptions?.transform;if(typeof a=="function"){let c=t.$get(s);if(c===void 0)continue;let l=a.call(t,c);uG(s,l),Ae.setValue(s,l,e)}else if(typeof u=="function"){let c=t.$get(s);if(c===void 0)continue;let l=[].concat(c);for(let p=0;p<l.length;++p){let f=u.call(t,l[p]);l[p]=f,uG(s,f)}e[s]=l}}return e}function uG(t,e){if(R9e(e))throw new Error("`transform` function must be synchronous, but the transform on path `"+t+"` returned a promise.")}function iOe(t,e){let r=t.$__schema,n=Object.keys(r.paths||{});if(!t._doc)return e;let s=t.$__.selected;if(s===void 0&&(s={},N9e.applyPaths(s,r)),s==null||Object.keys(s).length===0)return e;for(let o of n)s[o]!=null&&!s[o]&&delete e[o];return e}R.prototype.toJSON=function(t){return this.$toObject(t,!0)};R.prototype.ownerDocument=function(){return this};R.prototype.parent=function(){return this.$isSubdocument||this.$__.wasPopulated?this.$__.parent:this};R.prototype.$parent=R.prototype.parent;R.prototype.inspect=function(t){let e=Ae.isPOJO(t),r;e&&(r=t,r.minimize=!1);let n=arguments.length>0?this.toObject(r):this.toObject();return n??"MongooseDocument { "+n+" }"};gx.custom&&(R.prototype[gx.custom]=R.prototype.inspect);R.prototype.toString=function(){let t=this.inspect();return typeof t=="string"?t:gx(t)};R.prototype.equals=function(t){if(!t)return!1;let e=this.$__getValue("_id"),r=t.$__!=null?t.$__getValue("_id"):t;return!e&&!r?gE(this,t):e&&e.equals?e.equals(r):e===r};R.prototype.populate=async function(){let e={},r=[...arguments];if(typeof r[r.length-1]=="function")throw new ni("Document.prototype.populate() no longer accepts a callback");if(r.length!==0){let s=Ae.populate.apply(null,r);for(let o of s)e[o.path]=o}let n=Ae.object.vals(e),i=this.constructor;if(this.$__isNested){i=this.$__[V9e].constructor;let s=this.$__.nestedPath;n.forEach(function(o){o.path=s+"."+o.path})}if(this.$session()!=null){let s=this.$session();n.forEach(o=>{if(o.options==null){o.options={session:s};return}"session"in o.options||(o.options.session=s)})}return n.forEach(s=>{s._localModel=i}),i.populate(this,n)};R.prototype.$getPopulatedDocs=function(){let e=[];this.$__.populated!=null&&(e=e.concat(Object.keys(this.$__.populated)));let r=[];for(let n of e){let i=this.$get(n);Array.isArray(i)?r=r.concat(i):i instanceof R&&r.push(i)}return r};R.prototype.populated=function(t,e,r){if(e==null||e===!0){if(!this.$__.populated||typeof t!="string")return;let i=t.endsWith(".$*")?t.replace(/\.\$\*$/,""):t,s=this.$__.populated[i];return s?e===!0?s:s.value:void 0}this.$__.populated||(this.$__.populated={}),this.$__.populated[t]={value:e,options:r};let n=t.split(".");for(let i=0;i<n.length-1;++i){let s=n.slice(0,i+1).join("."),o=this.$get(s);if(o!=null&&o.$__!=null&&this.$populated(s)){let a=n.slice(i+1).join(".");o.$populated(a,e,r);break}}return e};R.prototype.$populated=R.prototype.populated;R.prototype.$assertPopulated=function(e,r){if(Array.isArray(e))return e.forEach(n=>this.$assertPopulated(n,r)),this;if(arguments.length>1&&this.$set(r),!this.$populated(e))throw new ni(`Expected path "${e}" to be populated`);return this};R.prototype.depopulate=function(t){typeof t=="string"&&(t=t.indexOf(" ")===-1?[t]:t.split(" "));let e,r=this.$$populatedVirtuals?Object.keys(this.$$populatedVirtuals):[],n=this.$__&&this.$__.populated||{};if(arguments.length===0){for(let s of r)delete this.$$populatedVirtuals[s],delete this._doc[s],delete n[s];let i=Object.keys(n);for(let s of i)if(e=this.$populated(s),!!e)if(delete n[s],Array.isArray(e)){let o=Ae.getValue(s,this._doc);if(o.isMongooseArray){let a=o.__array;for(let u=0;u<a.length;++u){let c=a[u];c!=null&&(a[u]=c instanceof R?c._doc._id:c._id)}}else Ae.setValue(s,e,this._doc)}else Ae.setValue(s,e,this._doc);return this}for(let i of t)if(e=this.$populated(i),delete n[i],r.indexOf(i)!==-1)delete this.$$populatedVirtuals[i],delete this._doc[i];else if(e)if(Array.isArray(e)){let s=Ae.getValue(i,this._doc);if(s.isMongooseArray){let o=s.__array;for(let a=0;a<o.length;++a){let u=o[a];u!=null&&(o[a]=u instanceof R?u._doc._id:u._id)}}else Ae.setValue(i,e,this._doc)}else Ae.setValue(i,e,this._doc);return this};R.prototype.$__fullPath=function(t){return t||""};R.prototype.getChanges=function(){let t=this.$__delta();return t?t[1]:{}};R.prototype.$__delta=function(){let e=this.$__dirty(),r=this.$__schema.options.optimisticConcurrency;if(r)if(Array.isArray(r)){let u=new Set(r);this.modifiedPaths().find(l=>u.has(l))&&(this.$__.version=e.length?Jo:jh)}else this.$__.version=e.length?Jo:jh;if(!e.length&&Jo!==this.$__.version)return;let n={},i={},s=e.length,o=[],a=0;for(n._id=this._doc._id,(n&&n._id&&n._id.$__||null)!=null&&(n._id=n._id.toObject({transform:!1,depopulate:!0}));a<s;++a){let u=e[a],c=u.value,l=sOe(this,u.path,c);if(l){o.push(l);continue}if(!this.$populated(u.path,!0)&&this.$__.selected){let f=u.path.split("."),d=f[0];if(this.$__.selected[d]&&this.$__.selected[d].$elemMatch)if(f.length>1&&f[1]==0&&typeof n[d]>"u")n[d]=this.$__.selected[d],f[1]="$",u.path=f.join(".");else{o.push(u.path);continue}}if(!(this.$isDefault(u.path)&&this.$__.selected&&(u.path.indexOf(".")===-1&&sG(this.$__.selected,u.path)||Ex(u.path).find(d=>sG(this.$__.isSelected,d))))&&!o.length)if(c===void 0)cu(this,n,i,u,1,"$unset");else if(c===null)cu(this,n,i,u,null);else if(Ae.isMongooseArray(c)&&c.$path()&&c[Rn])oOe(this,n,i,u,c);else if(c[w9e.pathSymbol]&&Buffer.isBuffer(c))c=c.toObject(),cu(this,n,i,u,c);else if(this.$__.primitiveAtomics&&this.$__.primitiveAtomics[u.path]!=null){let f=this.$__.primitiveAtomics[u.path],d=T9e(f);cu(this,n,i,u,f[d],d)}else c=Ns(c,{depopulate:!0,transform:!1,virtuals:!1,getters:!1,omitUndefined:!0,_isNested:!0}),cu(this,n,i,u,c)}if(o.length)throw new _9e(o);return this.$__.version&&this.$__version(n,i),Object.keys(i).length===0?[n,null]:[n,i]};function sOe(t,e,r){let n=t.$populated(e,!0);if(!n&&t.$__.selected){let s=e.split(".")[0];if(t.$__.selected[s+".$"])return s}if(!(n&&Ae.isMongooseArray(r)))return;if(n.options.match||n.options.options&&Object.hasOwn(n.options.options,"limit")||n.options.options&&n.options.options.skip||n.options.select&&(n.options.select._id===0||/\s?-_id\s?/.test(n.options.select))){let s=r[Rn];if(Object.keys(s).length===0||s.$set||s.$pop)return e}}function cu(t,e,r,n,i,s){if(s||(s="$set"),r[s]||(r[s]={}),r[s][n.path]=i,t.$__schema.options.versionKey!==!1&&!aOe(t,n.path)&&Jo!==(Jo&t.$__.version)&&!t.$__schema.options.optimisticConcurrency){switch(s){case"$set":case"$unset":case"$pop":case"$pull":case"$pullAll":case"$push":case"$addToSet":case"$inc":break;default:return}s==="$push"||s==="$addToSet"||s==="$pullAll"||s==="$pull"?/\.\d+\.|\.\d+$/.test(n.path)?t.$__.version=Jo:t.$__.version|=Ic:/^\$p/.test(s)||Array.isArray(i)?t.$__.version=Jo:/\.\d+\.|\.\d+$/.test(n.path)&&(t.$__.version|=jh)}}function oOe(t,e,r,n,i){if(r.$set&&r.$set[n.path])return;if(typeof i.$__getAtomics=="function"){i.$__getAtomics().forEach(function(p){let f=p[0],d=p[1];cu(t,e,r,n,d,f)});return}let s=i[Rn],o=Object.keys(s),a=o.length,u,c;if(a===0)return Ae.isMongooseObject(i)?i=i.toObject({depopulate:1,_isNested:!0}):i.valueOf&&(i=i.valueOf()),cu(t,e,r,n,i);function l(p){return Ae.isMongooseObject(p)?p.toObject({depopulate:1,_isNested:!0}):p}for(;a--;)c=o[a],u=s[c],Ae.isMongooseObject(u)?u=u.toObject({depopulate:!0,transform:!1,_isNested:!0}):Array.isArray(u)?u=u.map(l):u.valueOf&&(u=u.valueOf()),c==="$addToSet"&&(u={$each:u}),cu(t,e,r,n,u,c)}function aOe(t,e){let r=t.$__schema.options.skipVersioning;return r?(e=e.replace(/\.\d+\./,"."),r[e]):!1}R.prototype.$clone=function(){let t=this.constructor,e=new t;if(e.$isNew=this.$isNew,this._doc&&(e._doc=Ns(this._doc,{retainDocuments:!0})),this.$__){let r=this.$__.constructor,n=new r;for(let i of Object.getOwnPropertyNames(this.$__))i!=="activePaths"&&(n[i]=Ns(this.$__[i]));Object.assign(n.activePaths,Ns({...this.$__.activePaths})),e.$__=n}return e};R.prototype.$createModifiedPathsSnapshot=function(){let e=new WeakMap;if(!this.$isSubdocument){let r=this.$getAllSubdocs();for(let n of r)e.set(n,n.$__.activePaths.clone())}return new A9e(e,this.$__.activePaths.clone(),this.$__.version)};R.prototype.$restoreModifiedPathsSnapshot=function(e){if(this.$__.activePaths=e.activePaths.clone(),this.$__.version=e.version,!this.$isSubdocument){let r=this.$getAllSubdocs();for(let n of r)e.subdocSnapshot.has(n)&&(n.$__.activePaths=e.subdocSnapshot.get(n))}return this};R.prototype.$clearModifiedPaths=function(){if(this.$__.activePaths.clear("modify"),this.$__.activePaths.clear("init"),this.$__.version=0,!this.$isSubdocument){let e=this.$getAllSubdocs();for(let r of e)r.$clearModifiedPaths()}return this};R.prototype.$__hasOnlyPrimitiveValues=function(){return!this.$__.populated&&!this.$__.wasPopulated&&(this._doc==null||Object.values(this._doc).every(e=>e==null||typeof e!="object"||Ae.isNativeObject(e)&&!Array.isArray(e)||iG(e,"ObjectId")||iG(e,"Decimal128")))};R.prototype._applyVersionIncrement=function(){if(!this.$__.version)return;let e=Ic===(Ic&this.$__.version);if(this.$__.version=void 0,e){let r=this.$__schema.options.versionKey,n=this.$__getValue(r)||0;this.$__setValue(r,n+1)}};R.prototype._applyVersionIncrement=function(){if(!this.$__.version)return;let e=Ic===(Ic&this.$__.version);if(this.$__.version=void 0,e){let r=this.$__schema.options.versionKey,n=this.$__getValue(r)||0;this.$__setValue(r,n+1)}};R.VERSION_WHERE=jh;R.VERSION_INC=Ic;R.VERSION_ALL=Jo;R.ValidationError=EE;_G.exports=EG=R});var ge=y(ee=>{"use strict";var uOe=ye().UUID,cOe=R0(),wG=Ti(),lOe=su(),AG=UO(),wx=zt(),pOe=Ia(),fOe=xc(),SG=Db(),OG=SW(),lu=Zr(),dOe=hf(),hOe=yO(),Lh=Bh(),mOe=Wb(),Uh=Oc(),{trustedSymbol:Sf}=mf(),vx;ee.specialProperties=Uh;ee.isMongooseArray=SG.isMongooseArray;ee.isMongooseDocumentArray=OG.isMongooseDocumentArray;ee.registerMongooseArray=SG.registerMongooseArray;ee.registerMongooseDocumentArray=OG.registerMongooseDocumentArray;var Ax=/\s/,Sx=/\s+/;ee.toCollectionName=function(t,e){if(t==="system.profile"||t==="system.indexes")return t;if(typeof e=="function"){if(typeof t!="string")throw new TypeError("Collection name must be a string");if(t.length===0)throw new TypeError("Collection name cannot be empty");return e(t)}return t};ee.deepEqual=function t(e,r){if(e===r)return!0;if(typeof e!="object"||typeof r!="object")return e===r;if(e instanceof Date&&r instanceof Date)return e.getTime()===r.getTime();if(lu(e,"ObjectId")&&lu(r,"ObjectId")||lu(e,"Decimal128")&&lu(r,"Decimal128"))return e.toString()===r.toString();if(e instanceof RegExp&&r instanceof RegExp)return e.source===r.source&&e.ignoreCase===r.ignoreCase&&e.multiline===r.multiline&&e.global===r.global&&e.dotAll===r.dotAll&&e.unicode===r.unicode&&e.sticky===r.sticky&&e.hasIndices===r.hasIndices;if(e==null||r==null||e.prototype!==r.prototype)return!1;if(e instanceof Map||r instanceof Map)return!(e instanceof Map)||!(r instanceof Map)?!1:t(Array.from(e.keys()),Array.from(r.keys()))&&t(Array.from(e.values()),Array.from(r.values()));if(e instanceof Number&&r instanceof Number)return e.valueOf()===r.valueOf();if(Buffer.isBuffer(e))return ee.buffer.areEqual(e,r);if(Array.isArray(e)||Array.isArray(r)){if(!Array.isArray(e)||!Array.isArray(r))return!1;let o=e.length;if(o!==r.length)return!1;for(let a=0;a<o;++a)if(!t(e[a],r[a]))return!1;return!0}e.$__!=null?e=e._doc:Lh(e)&&(e=e.toObject()),r.$__!=null?r=r._doc:Lh(r)&&(r=r.toObject());let n=Object.keys(e),i=Object.keys(r),s=n.length;if(s!==i.length)return!1;for(let o=s-1;o>=0;o--)if(n[o]!==i[o])return!1;for(let o of n)if(!t(e[o],r[o]))return!1;return!0};ee.last=function(t){if(t!=null&&t.length>0)return t[t.length-1]};ee.cloneArrays=function(e){return Array.isArray(e)?e.map(r=>ee.cloneArrays(r)):e};ee.omit=function(e,r){if(r==null)return Object.assign({},e);Array.isArray(r)||(r=[r]);let n=Object.assign({},e);for(let i of r)delete n[i];return n};ee.clonePOJOsAndArrays=function(e){if(e==null||e.$__!=null)return e;if(dOe(e)){e={...e};for(let r of Object.keys(e))e[r]=ee.clonePOJOsAndArrays(e[r]);return e}if(Array.isArray(e)){e=[...e];for(let r=0;r<e.length;++r)e[r]=ee.clonePOJOsAndArrays(e[r]);return e}return e};ee.merge=function t(e,r,n,i){if(n=n||{},r==null)return e;let s=Object.keys(r),o=0,a=s.length,u;r[Sf]&&(e[Sf]=r[Sf]),i=i||"";let c=n.omitNested||{};for(;o<a;)if(u=s[o++],!(n.omit&&n.omit[u])&&!c[i]&&!Uh.has(u))if(e[u]==null)e[u]=ee.clonePOJOsAndArrays(r[u]);else if(ee.isObject(r[u])){if(ee.isObject(e[u])||(e[u]={}),r[u]!=null){if(n.isDiscriminatorSchemaMerge&&r[u].$isSingleNested&&e[u].$isMongooseDocumentArray||r[u].$isMongooseDocumentArray&&e[u].$isSingleNested)continue;if(r[u].instanceOfSchema){e[u].instanceOfSchema?mOe(e[u],r[u].clone(),n.isDiscriminatorSchemaMerge):e[u]=r[u].clone();continue}else if(lu(r[u],"ObjectId")){e[u]=new lOe(r[u]);continue}}t(e[u],r[u],n,i?i+"."+u:u)}else n.overwrite&&(e[u]=r[u]);return e};ee.toObject=function t(e){vx||(vx=po());let r;if(e==null)return e;if(e instanceof vx)return e.toObject();if(Array.isArray(e)){r=[];for(let n of e)r.push(t(n));return r}if(ee.isPOJO(e)){r={},e[Sf]&&(r[Sf]=e[Sf]);for(let n of Object.keys(e))Uh.has(n)||(r[n]=t(e[n]));return r}return e};ee.isObject=fOe;ee.isPOJO=hf();ee.isNonBuiltinObject=function(e){return typeof e=="object"&&!ee.isNativeObject(e)&&!ee.isMongooseType(e)&&!(e instanceof uOe)&&e!=null};ee.isNativeObject=function(t){return Array.isArray(t)||t instanceof Date||t instanceof Boolean||t instanceof Number||t instanceof String};ee.isEmptyObject=function(t){return t!=null&&typeof t=="object"&&Object.keys(t).length===0};ee.hasKey=function(e,r){let n=Object.keys(e);for(let i of n)if(i===r||ee.isPOJO(e[i])&&ee.hasKey(e[i],r))return!0;return!1};ee.tick=function(e){if(typeof e=="function")return function(){try{e.apply(this,arguments)}catch(r){pOe(function(){throw r})}}};ee.isMongooseType=function(t){return lu(t,"ObjectId")||lu(t,"Decimal128")||t instanceof Buffer};ee.isMongooseObject=Lh;ee.expires=function(e){e&&e.constructor.name==="Object"&&"expires"in e&&(e.expireAfterSeconds=typeof e.expires!="string"?e.expires:Math.round(cOe(e.expires)/1e3),delete e.expires)};ee.populate=function(e,r,n,i,s,o,a,u){let c=null;if(arguments.length===1){if(e instanceof AG)return e._docs={},e._childDocs=[],[e];if(Array.isArray(e))return l(e).map(f=>ee.populate(f)[0]);ee.isObject(e)?c=Object.assign({},e):c={path:e}}else typeof n=="object"?c={path:e,select:r,match:n,options:i}:c={path:e,select:r,model:n,match:i,options:s,populate:o,justOne:a,count:u};if(typeof c.path!="string"&&!(Array.isArray(c.path)&&c.path.every(p=>typeof p=="string")))throw new TypeError("utils.populate: invalid path. Expected string or array of strings. Got typeof `"+typeof e+"`");return yOe(c);function l(p){let f=[];return p.forEach(function(d){Ax.test(d.path)?d.path.split(Sx).forEach(function(m){let g=Object.assign({},d);g.path=m,f.push(g)}):f.push(d)}),f}};function yOe(t){if(Array.isArray(t.populate)){let n=[];t.populate.forEach(function(i){if(Ax.test(i.path)){let s=Object.assign({},i);s.path.split(Sx).forEach(function(a){s.path=a,n.push(ee.populate(s)[0])})}else n.push(ee.populate(i)[0])}),t.populate=ee.populate(n)}else t.populate!=null&&typeof t.populate=="object"&&(t.populate=ee.populate(t.populate));let e=[],r=Ax.test(t.path)?t.path.split(Sx):Array.isArray(t.path)?t.path:[t.path];t.options!=null&&(t.options=wx(t.options));for(let n of r)e.push(new AG(Object.assign({},t,{path:n})));return e}ee.getValue=function(t,e,r){return wG.get(t,e,bOe,r)};var gOe=Object.freeze({getters:!1});function bOe(t,e){if(e==="$*"&&t instanceof Map)return t;let r=t?._doc||t;return r!=null&&r.isMongooseArrayProxy&&(r=r.__array),r instanceof Map?r.get(e,gOe):r[e]}ee.setValue=function(t,e,r,n,i){wG.set(t,e,r,"_doc",n,i)};ee.object={};ee.object.vals=function(e){if(e==null)return[];let r=Object.keys(e),n=r.length,i=[];for(;n--;)i.push(e[r[n]]);return i};ee.isNullOrUndefined=function(t){return t==null};ee.array={};ee.array.flatten=function t(e,r,n){return n||(n=[]),e.forEach(function(i){Array.isArray(i)?t(i,r,n):(!r||r(i))&&n.push(i)}),n};ee.hasUserDefinedProperty=function(t,e){if(t==null)return!1;if(Array.isArray(e)){for(let r of e)if(ee.hasUserDefinedProperty(t,r))return!0;return!1}if(Object.hasOwn(t,e))return!0;if(typeof t=="object"&&e in t){let r=t[e];return r!==Object.prototype[e]&&r!==Array.prototype[e]}return!1};var vG=Math.pow(2,32)-1;ee.isArrayIndex=function(t){return typeof t=="number"?t>=0&&t<=vG:typeof t=="string"&&/^\d+$/.test(t)?(t=+t,t>=0&&t<=vG):!1};ee.array.unique=function(t){let e=new Set,r=new Set,n=[];for(let i of t)if(typeof i=="number"||typeof i=="string"||i==null){if(e.has(i))continue;n.push(i),e.add(i)}else if(lu(i,"ObjectId")){if(r.has(i.toString()))continue;n.push(i),r.add(i.toString())}else n.push(i);return n};ee.buffer={};ee.buffer.areEqual=function(t,e){return!Buffer.isBuffer(t)||!Buffer.isBuffer(e)?!1:t.equals(e)};ee.getFunctionName=hOe;ee.decorate=function(t,e){for(let r in e)Uh.has(r)||(t[r]=e[r])};ee.mergeClone=function(t,e){Lh(e)&&(e=e.toObject({transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1}));let r=Object.keys(e),n=r.length,i=0,s;for(;i<n;)if(s=r[i++],!Uh.has(s))if(typeof t[s]>"u")t[s]=wx(e[s],{transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1});else{let o=e[s];if(o!=null&&o.valueOf&&!(o instanceof Date)&&(o=o.valueOf()),ee.isObject(o)){let a=o;Lh(o)&&!o.isMongooseBuffer&&(a=a.toObject({transform:!1,virtuals:!1,depopulate:!0,getters:!1,flattenDecimals:!1})),o.isMongooseBuffer&&(a=Buffer.from(a)),ee.mergeClone(t[s],a)}else t[s]=wx(o,{flattenDecimals:!1})}};ee.each=function(t,e){for(let r of t)e(r)};ee.renameObjKey=function(t,e,r){return Object.keys(t).reduce((i,s)=>(s===e?i[r]=t[e]:i[s]=t[s],i),{})};ee.getOption=function(t){let e=Array.prototype.slice.call(arguments,1);for(let r of e)if(r!=null&&r[t]!=null)return r[t];return null};ee.noop=function(){};ee.errorToPOJO=function(e){if(!(e instanceof Error))throw new Error("`error` must be `instanceof Error`.");let n={};for(let i of Object.getOwnPropertyNames(e))n[i]=e[i];return n};ee.warn=function(e){return process.emitWarning(e,{code:"MONGOOSE"})};ee.injectTimestampsOption=function(e,r){r!=null&&(e.timestamps=r)}});var Zt=y((wE,PG)=>{"use strict";var Vh=xi(),MG=ti(),EOe=Vb(),_Oe=jO(),vE=zt(),Ox=cW(),vOe=pW(),xx=dW(),wOe=oe().schemaTypeSymbol,Rc=ge(),zh=oe().validatorErrorSymbol,AOe=oe().documentIsModified,xG=oe().populateModelSymbol,Cx=Vh.CastError,Of=Vh.ValidatorError,SOe={_skipMarkModified:!0};function _e(t,e,r,n){this[wOe]=!0,this.path=t,this.instance=r,this.schemaName=this.constructor.schemaName,this.validators=[],this.getters=Object.hasOwn(this.constructor,"getters")?this.constructor.getters.slice():[],this.setters=Object.hasOwn(this.constructor,"setters")?this.constructor.setters.slice():[],this.splitPath(),e=e||{};let i=this.constructor.defaultOptions||{},s=Object.keys(i);for(let u of s)u==="validate"?this.validate(i.validate):Object.hasOwn(i,u)&&!Object.hasOwn(e,u)&&(e[u]=i[u]);e.select==null&&delete e.select;let o=this.OptionsConstructor||MG;this.options=new o(e),this.parentSchema=n,this._index=null,Rc.hasUserDefinedProperty(this.options,"immutable")&&(this.$immutable=this.options.immutable,Ox(this));let a=Object.keys(this.options);for(let u of a){if(u==="cast"){Array.isArray(this.options[u])?this.castFunction.apply(this,this.options[u]):this.castFunction(this.options[u]);continue}if(Rc.hasUserDefinedProperty(this.options,u)&&typeof this[u]=="function"){if(u==="index"&&this._index){if(e.index===!1){let p=this._index;if(typeof p=="object"&&p!=null){if(p.unique)throw new Error('Path "'+this.path+'" may not have `index` set to false and `unique` set to true');if(p.sparse)throw new Error('Path "'+this.path+'" may not have `index` set to false and `sparse` set to true')}this._index=!1}continue}let c=e[u];if(u==="default"){this.default(c);continue}let l=Array.isArray(c)?c:[c];this[u].apply(this,l)}}Object.defineProperty(this,"$$context",{enumerable:!1,configurable:!1,writable:!0,value:null})}_e.prototype.OptionsConstructor=MG;_e.prototype.path;_e.prototype.toJSON=function(){let e={...this};return delete e.parentSchema,e};_e.prototype.validators;_e.prototype.isRequired;_e.prototype.splitPath=function(){if(this._presplitPath!=null)return this._presplitPath;if(this.path!=null)return this._presplitPath=this.path.indexOf(".")===-1?[this.path]:this.path.split("."),this._presplitPath};_e.cast=function(e){return arguments.length===0?this._cast:(e===!1&&(e=r=>r),this._cast=e,this._cast)};_e.prototype.castFunction=function(e,r){return arguments.length===0?this._castFunction:(e===!1&&(e=this.constructor._defaultCaster||(n=>n)),typeof e=="string"?(this._castErrorMessage=e,this._castFunction):(e!=null&&(this._castFunction=e),r!=null&&(this._castErrorMessage=r),this._castFunction))};_e.prototype.cast=function(){throw new Error("Base SchemaType class does not implement a `cast()` function")};_e.set=function(e,r){Object.hasOwn(this,"defaultOptions")||(this.defaultOptions=Object.assign({},this.defaultOptions)),this.defaultOptions[e]=r};_e.get=function(t){this.getters=Object.hasOwn(this,"getters")?this.getters:[],this.getters.push(t)};_e.prototype.default=function(t){if(arguments.length===1){if(t===void 0){this.defaultValue=void 0;return}if(t!=null&&t.instanceOfSchema)throw new Vh("Cannot set default value of path `"+this.path+"` to a mongoose Schema instance.");return this.defaultValue=t,this.defaultValue}else arguments.length>1&&(this.defaultValue=[...arguments]);return this.defaultValue};_e.prototype.index=function(t){return this._index=t,Rc.expires(this._index),this};_e.prototype.unique=function(e,r){if(this._index===!1){if(!e)return;throw new Error('Path "'+this.path+'" may not have `index` set to false and `unique` set to true')}return!Object.hasOwn(this.options,"index")&&e===!1?this:(this._index==null||this._index===!0?this._index={}:typeof this._index=="string"&&(this._index={type:this._index}),this._index.unique=!!e,typeof r=="string"&&(this._duplicateKeyErrorMessage=r),this)};_e.prototype.text=function(t){if(this._index===!1){if(!t)return this;throw new Error('Path "'+this.path+'" may not have `index` set to false and `text` set to true')}return!Object.hasOwn(this.options,"index")&&t===!1?this:(this._index===null||this._index===void 0||typeof this._index=="boolean"?this._index={}:typeof this._index=="string"&&(this._index={type:this._index}),this._index.text=t,this)};_e.prototype.sparse=function(t){if(this._index===!1){if(!t)return this;throw new Error('Path "'+this.path+'" may not have `index` set to false and `sparse` set to true')}return!Object.hasOwn(this.options,"index")&&t===!1?this:(this._index==null||typeof this._index=="boolean"?this._index={}:typeof this._index=="string"&&(this._index={type:this._index}),this._index.sparse=t,this)};_e.prototype.immutable=function(t){return this.$immutable=t,Ox(this),this};_e.prototype.transform=function(t){return this.options.transform=t,this};_e.prototype.set=function(t){if(typeof t!="function")throw new TypeError("A setter must be a function.");return this.setters.push(t),this};_e.prototype.get=function(t){if(typeof t!="function")throw new TypeError("A getter must be a function.");return this.getters.push(t),this};_e.prototype.validateAll=function(t){for(let e=0;e<t.length;e++)this.validate(t[e]);return this};_e.prototype.validate=function(t,e,r){if(typeof t=="function"||t&&Rc.getFunctionName(t.constructor)==="RegExp"){let o;return typeof e=="function"?(o={validator:t,message:e},o.type=r||"user defined"):e instanceof Object&&!r?(o=xx(e)?Object.assign({},e):vE(e),o.message||(o.message=o.msg),o.validator=t,o.type=o.type||"user defined"):(e==null&&(e=Vh.messages.general.default),r||(r="user defined"),o={message:e,type:r,validator:t}),this.validators.push(o),this}let n,i,s;for(n=0,i=arguments.length;n<i;n++){if(s=arguments[n],!Rc.isPOJO(s)){let o="Invalid validator. Received ("+typeof s+") "+s+". See https://mongoosejs.com/docs/api/schematype.html#SchemaType.prototype.validate()";throw new Error(o)}this.validate(s.validator,s)}return this};_e.prototype.required=function(t,e){let r={};if(arguments.length>0&&t==null)return this.validators=this.validators.filter(function(s){return s.validator!==this.requiredValidator},this),this.isRequired=!1,delete this.originalRequiredValue,this;if(typeof t=="object"&&(r=t,e=r.message||e,t=t.isRequired),t===!1)return this.validators=this.validators.filter(function(s){return s.validator!==this.requiredValidator},this),this.isRequired=!1,delete this.originalRequiredValue,this;let n=this;this.isRequired=!0,this.requiredValidator=function(s){let o=this&&this.$__&&this.$__.cachedRequired;if(o!=null&&!this.$__isSelected(n.path)&&!this[AOe](n.path))return!0;if(o!=null&&n.path in o){let a=o[n.path]?n.checkRequired(s,this):!0;return delete o[n.path],a}else if(typeof t=="function")return t.apply(this)?n.checkRequired(s,this):!0;return n.checkRequired(s,this)},this.originalRequiredValue=t,typeof t=="string"&&(e=t,t=void 0);let i=e||Vh.messages.general.required;return this.validators.unshift(Object.assign({},r,{validator:this.requiredValidator,message:i,type:"required"})),this};_e.prototype.ref=function(t){return this.options.ref=t,this};_e.prototype.getDefault=function(t,e,r){let n;if(this.defaultValue==null)return this.defaultValue;if(typeof this.defaultValue=="function"?this.defaultValue===Date.now||this.defaultValue===Array||this.defaultValue.name.toLowerCase()==="objectid"?n=this.defaultValue.call(t):n=this.defaultValue.call(t,t):n=this.defaultValue,n!=null){if(typeof n=="object"&&(!this.options||!this.options.shared)&&(n=vE(n)),r&&r.skipCast)return this._applySetters(n,t);let i=this.applySetters(n,t,e,void 0,SOe);return i&&!Array.isArray(i)&&i.$isSingleNested&&(i.$__parent=t),i}return n};_e.prototype._applySetters=function(t,e,r,n,i){let s=t;if(r)return s;let o=this.setters;for(let a=o.length-1;a>=0;a--)s=o[a].call(e,s,n,this,i);return s};_e.prototype._castNullish=function(e){return e};_e.prototype.applySetters=function(t,e,r,n,i){let s=this._applySetters(t,e,r,n,i);return s==null?this._castNullish(s):(s=this.cast(s,e,r,n,i),s)};_e.prototype.applyGetters=function(t,e){let r=t,n=this.getters,i=n.length;if(i===0)return r;for(let s=0;s<i;++s)r=n[s].call(e,r,this);return r};_e.prototype.select=function(e){return this.selected=!!e,this};_e.prototype.doValidate=async function(e,r,n){let i=!1,s=this.path,o=this.validators.filter(u=>typeof u=="object"&&u!==null);if(!o.length)return;let a=[];for(let u=0,c=o.length;u<c;++u){let l=o[u],p=l.validator,f,d=xx(l)?Object.assign({},l):vE(l);if(d.path=n&&n.path?n.path:s,d.fullPath=this.$fullPath,d.value=e,typeof e=="string"&&(d.length=e.length,d.value.length>30&&(d.value=d.value.slice(0,30)+"...")),!(e===void 0&&p!==this.requiredValidator)){if(p instanceof RegExp){if(f=p.test(e),f===!1){let h=d.ErrorConstructor||Of;throw i=new h(d,r),i[zh]=!0,i}continue}else if(typeof p!="function")continue;try{d.propsParameter?f=p.call(r,e,d):f=p.call(r,e)}catch(h){f=!1,d.reason=h,h.message&&(d.message=h.message)}if(f!=null&&typeof f.then=="function")a.push(f.then(function(h){if(h===!1){let m=d.ErrorConstructor||Of;throw i=new m(d,r),i[zh]=!0,i}},function(h){d.reason=h,d.message=h.message,f=!1;let m=d.ErrorConstructor||Of;throw i=new m(d,r),i[zh]=!0,i}));else if(f!==void 0&&!f){let h=d.ErrorConstructor||Of;throw i=new h(d,r),i[zh]=!0,i}}}await Promise.all(a)};function CG(t,e){if(t!==void 0&&!t){let r=e.ErrorConstructor||Of,n=new r(e);return n[zh]=!0,n}}_e.prototype.doValidateSync=function(t,e,r){let n=this.path;if(!this.validators.length)return null;let s=this.validators;if(t===void 0)if(this.validators.length!==0&&this.validators[0].type==="required")s=[this.validators[0]];else return null;let o=null,a=0,u=s.length;for(a=0;a<u;++a){let c=s[a];if(c===null||typeof c!="object")continue;let l=c.validator,p=xx(c)?Object.assign({},c):vE(c);p.path=r&&r.path?r.path:n,p.fullPath=this.$fullPath,p.value=t,typeof t=="string"&&(p.length=t.length,p.value.length>30&&(p.value=p.value.slice(0,30)+"..."));let f=!1;if(!vOe(l)){if(l instanceof RegExp){o=CG(l.test(t),p);continue}if(typeof l=="function"){try{p.propsParameter?f=l.call(e,t,p):f=l.call(e,t)}catch(d){f=!1,p.reason=d}if(!(f!=null&&typeof f.then=="function")&&(o=CG(f,p),o))break}}}return o};_e._isRef=function(t,e,r,n){let i=n&&t.options&&(t.options.ref||t.options.refPath);if(!i&&r&&r.$__!=null){let s=r.$__fullPath(t.path,!0),o=r.ownerDocument();i=s!=null&&o.$populated(s)||r.$populated(t.path)}return i?e==null||!Buffer.isBuffer(e)&&e._bsontype!=="Binary"&&Rc.isObject(e)?!0:n:!1};_e.prototype._castRef=function(e,r,n,i){if(e==null)return e;if(e.$__!=null)return e.$__.wasPopulated=e.$__.wasPopulated||{value:e._doc._id},e;if(Buffer.isBuffer(e)||!Rc.isObject(e)){if(n)return e;throw new Cx(this.instance,e,this.path,null,this)}let s=r.$__fullPath(this.path,!0),a=r.ownerDocument().$populated(s,!0),u=e;if(!r.$__.populated||!r.$__.populated[s]||!r.$__.populated[s].options||!r.$__.populated[s].options.options||!r.$__.populated[s].options.options.lean){let c=a?a.options[xG]:r.constructor.db.model(this.options.ref);u=c.hydrate(e,null,i),u.$__.wasPopulated={value:u._doc._id,options:{[xG]:c}}}return u};function TG(t,e){return this.castForQuery(null,t,e)}function OOe(t,e){let r=this;return Array.isArray(t)?t.map(function(n){return r.castForQuery(null,n,e)}):[this.castForQuery(null,t,e)]}function DG(t,e){let r=this;return Array.isArray(t)?t.map(function(n){return Array.isArray(n)&&n.length===0?n:r.castForQuery(null,n,e)}):[this.castForQuery(null,t,e)]}_e.prototype.$conditionalHandlers={$all:OOe,$eq:TG,$in:DG,$ne:TG,$nin:DG,$exists:EOe,$type:_Oe};_e.prototype.cas
Need better ways to work with logs? Try theRender CLI, Render MCP Server, or se